{"config":{"lang":["en","ja"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"]},"docs":[{"location":"","title":"\u6b22\u8fce\u6765\u5230FoggyWhale\u7684\u4e2a\u4eba\u7a7a\u95f4\ud83d\udc4f","text":"<p>\u4e3b\u9875\u6b63\u5728\u65bd\u5de5\u4e2d...</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/","title":"Lab 3: RV64 \u865a\u62df\u5185\u5b58\u7ba1\u7406","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#1","title":"1 \u5b9e\u9a8c\u76ee\u7684","text":"<p>\u7ed3\u5408\u8bfe\u5802\u5b66\u4e60\u7684\u9875\u5f0f\u5185\u5b58\u7ba1\u7406\u4ee5\u53ca\u865a\u62df\u5185\u5b58\u7684\u76f8\u5173\u77e5\u8bc6\uff0c\u5c1d\u8bd5\u5728\u5df2\u6709\u7684\u7a0b\u5e8f\u4e0a\u5f00\u542f MMU \u5e76\u5b9e\u73b0\u9875\u6620\u5c04\uff0c\u4fdd\u8bc1\u4e4b\u524d\u7684\u8fdb\u7a0b\u8c03\u5ea6\u80fd\u5728\u865a\u62df\u5185\u5b58\u4e0b\u6b63\u5e38\u8fd0\u884c\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#2","title":"2 \u5b9e\u9a8c\u5185\u5bb9\u53ca\u8981\u6c42","text":"<ul> <li>\u5b9e\u73b0 Sv39 \u5206\u914d\u65b9\u6848\u4e0b\u7684\u4e09\u7ea7\u9875\u8868\u6620\u5c04</li> <li>\u4e86\u89e3\u9875\u8868\u6620\u5c04\u7684\u6743\u9650\u673a\u5236\uff0c\u8bbe\u7f6e\u4e0d\u540c\u7684\u9875\u8868\u6620\u5c04\u6743\u9650\uff0c\u5b8c\u6210\u5bf9 section \u7684\u4fdd\u62a4\u53ca\u76f8\u5e94\u7684\u5f02\u5e38\u5904\u7406</li> <li>\u7406\u89e3\u5728\u9677\u5165\u548c\u8fdb\u7a0b\u5207\u6362\u8fc7\u7a0b\u4e2d\uff0c\u9875\u8868\u5207\u6362\u4e0e\u6808\u5207\u6362\u7684\u6d41\u7a0b</li> </ul> <p>\u8bf7\u5404\u5c0f\u7ec4\u72ec\u7acb\u5b8c\u6210\u5b9e\u9a8c\uff0c\u4efb\u4f55\u6284\u88ad\u884c\u4e3a\u90fd\u5c06\u4f7f\u672c\u6b21\u5b9e\u9a8c\u5224\u4e3a0\u5206\u3002</p> <p>\u8bf7\u8ddf\u968f\u5b9e\u9a8c\u6b65\u9aa4\u5b8c\u6210\u5b9e\u9a8c\u5e76\u6839\u636e\u6587\u6863\u4e2d\u7684\u8981\u6c42\u8bb0\u5f55\u5b9e\u9a8c\u8fc7\u7a0b\uff0c\u6700\u540e\u5220\u9664\u6587\u6863\u672b\u5c3e\u7684\u9644\u5f55\u90e8\u5206\uff0c\u5e76\u547d\u540d\u4e3a\u201c\u5b66\u53f71_\u59d3\u540d1_\u5b66\u53f72_\u59d3\u540d2_lab3.pdf\"\uff0c\u4f60\u7684\u4ee3\u7801\u8bf7\u6253\u5305\u5e76\u547d\u540d\u4e3a\u201c\u5b66\u53f71_\u59d3\u540d1_*\u5b66\u53f72_*\u59d3\u540d2_lab3\"\uff0c\u6587\u4ef6\u4e0a\u4f20\u81f3\u5b66\u5728\u6d59\u5927\u5e73\u53f0\u3002</p> <p>\u672c\u5b9e\u9a8c\u4ee5\u53cc\u4eba\u7ec4\u961f\u7684\u65b9\u5f0f\u8fdb\u884c\uff0c\u4ec5\u9700\u4e00\u4eba\u63d0\u4ea4\u5b9e\u9a8c\uff0c\u9ed8\u8ba4\u5e73\u5747\u5206\u914d\u4e24\u4eba\u7684\u5f97\u5206\uff08\u82e5\u539f\u59cb\u6253\u5206\u4e3aX\uff0c\u5219\u53ef\u5206\u914d\u5206\u6570\u4e3a2X\uff0c\u5e73\u5747\u5206\u914d\u540e\u6bcf\u4eba\u5f97\u5230X\u5206\uff09\u3002\u5982\u679c\u6709\u7279\u6b8a\u60c5\u51b5\u8bf7\u5355\u72ec\u5411\u52a9\u6559\u53cd\u5e94\uff0c\u51fa\u793a\u4e24\u4eba\u5bf9\u4e8e\u5206\u6570\u7684\u9489\u9489\u804a\u5929\u8bb0\u5f55\u622a\u56fe\u3002\u5355\u4eba\u5b8c\u6210\u5b9e\u9a8c\u8005\u7684\u5f97\u5206\u4e3a\u539f\u59cb\u6253\u5206\u3002</p> \u59d3\u540d \u5b66\u53f7 \u5206\u5de5 \u5206\u914d\u5206\u6570 50% 50%"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#3","title":"3 \u5b9e\u9a8c\u6b65\u9aa4","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#31","title":"3.1 \u5b9e\u9a8c\u80cc\u666f","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#311","title":"3.1.1 \u5efa\u7acb\u6620\u5c04","text":"<p>\u4f60\u53ef\u4ee5\u590d\u7528\u4e0a\u4e00\u6b21\u5b9e\u9a8c\u4e2d\u6620\u5c04\u597d\u7684\u6587\u4ef6\u5939\uff0c\u4e5f\u53ef\u4ee5\u91cd\u65b0\u521b\u5efa\u4e00\u4e2a\u5bb9\u5668\u505a\u6620\u5c04\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#312","title":"3.1.2 \u7ec4\u7ec7\u6587\u4ef6\u7ed3\u6784","text":"<p>\u4f60\u53ef\u4ee5\u4ece \ud83d\udccelab3.zip \u4e0b\u8f7d\u672c\u5b9e\u9a8c\u63d0\u4f9b\u597d\u7684\u4ee3\u7801\u3002</p> <pre><code>Lab3\n\u251c\u2500\u2500 Makefile\n\u251c\u2500\u2500 arch\n\u2502   \u2514\u2500\u2500 riscv\n\u2502       \u251c\u2500\u2500 Makefile\n\u2502       \u2514\u2500\u2500 kernel\n\u2502           \u251c\u2500\u2500 Makefile\n\u2502           \u251c\u2500\u2500 entry.S\n\u2502           \u251c\u2500\u2500 head.S\n\u2502           \u251c\u2500\u2500 main.c\n\u2502           \u251c\u2500\u2500 print.c\n\u2502           \u251c\u2500\u2500 sched.c\n\u2502           \u251c\u2500\u2500 test.c\n\u2502           \u251c\u2500\u2500 trap.c\n\u2502           \u251c\u2500\u2500 vm.c\n\u2502           \u2514\u2500\u2500 vmlinux.lds\n\u2514\u2500\u2500 include\n    \u251c\u2500\u2500 defs.h\n    \u251c\u2500\u2500 riscv.h\n    \u251c\u2500\u2500 sched.h\n    \u251c\u2500\u2500 stddef.h\n    \u251c\u2500\u2500 stdio.h\n    \u251c\u2500\u2500 test.h\n    \u2514\u2500\u2500 vm.h\n</code></pre>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#32","title":"3.2 \u5b9e\u9a8c\u4ee3\u7801\u6267\u884c\u6d41\u7a0b","text":"<p>\u4e3a\u4e86\u907f\u514d\u6211\u4eec\u7684\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\u4e0e OpenSBI \u51b2\u7a81\uff0c\u540e\u7eed\u7684\u5b9e\u9a8c\u4e2d\uff0c\u6211\u4eec\u4e0d\u518d\u4f7f\u7528 OpenSBI \u6765\u7ba1\u7406 M \u6001\uff0c\u800c\u662f\u624b\u52a8\u5b9e\u73b0 M \u6001\u7684\u7ba1\u7406\u3002</p> <p>\u672c\u6b21\u5b9e\u9a8c\u4e2d\u9996\u5148\u624b\u52a8\u5b9e\u73b0 OpenSBI \u7684\u90e8\u5206\u529f\u80fd\uff0c\u5b8c\u6210\u521d\u59cb\u5316\u540e\u8fdb\u5165\u5185\u6838\uff0c\u7136\u540e\u5c06\u8bbe\u7f6e satp \u5bc4\u5b58\u5668\u5f00\u542f Sv39 \u5185\u5b58\u5206\u914d\u65b9\u6848\uff0c\u968f\u540e\u8bbe\u7f6e\u7269\u7406\u5730\u5740\u4e0e\u865a\u62df\u5730\u5740\u7684\u6620\u5c04\uff0c\u6700\u540e\u4e3a\u4e0d\u540c section \u8bbe\u7f6e\u4e0d\u540c\u7684\u6620\u5c04\u6743\u9650\uff0c\u5e76\u5b9e\u73b0\u76f8\u5e94\u7684\u5f02\u5e38\u5904\u7406\u3002\u4e3a\u4e86\u5b9e\u73b0\u6620\u5c04\uff0c\u540c\u5b66\u4eec\u9700\u8981\u5206\u914d\u5185\u5b58\u7a7a\u95f4\u7ed9\u9875\u8868\uff0c\u5e76\u5bf9\u9875\u8868\u9879\u8fdb\u884c\u76f8\u5e94\u7684\u8bbe\u7f6e\u3002\u7531\u4e8e\u5f00\u542f\u4e86 MMU\uff0c\u8fd8\u9700\u8981\u5bf9\u8fdb\u7a0b\u8c03\u5ea6\u7684\u76f8\u5173\u4ee3\u7801\u8fdb\u884c\u4e00\u5b9a\u7684\u4fee\u6539\u3002</p> <p>\u7cfb\u7edf\u7684\u8fd0\u884c\u6d41\u7a0b\u5927\u81f4\u5982\u4e0b\uff1a</p> <ol> <li>\u7531\u4e8e\u4e0d\u4f7f\u7528 OpenSBI\uff0c\u673a\u5668\u5c06\u4ee5 M \u6a21\u5f0f\uff0c\u4ece <code>head.S: _start</code> \u51fd\u6570\u5f00\u59cb\u6267\u884c\u3002</li> <li> <p><code>_start</code> \u51fd\u6570\u5f00\u59cb\u6267\u884c\u3002</p> </li> <li> <p>\u9996\u5148\u5173\u95ed\u6240\u6709\u4e2d\u65ad\u9632\u6b62\u521d\u59cb\u5316\u8fc7\u7a0b\u53d7\u5230\u5e72\u6270\u3002</p> </li> <li>\u8bbe\u7f6e M \u6a21\u5f0f\u7684\u5f02\u5e38\u5904\u7406\u51fd\u6570\u5730\u5740</li> <li>\u5c06\u65f6\u949f\u4e2d\u65ad\uff0cpage fault \u5f02\u5e38\u59d4\u6258\u7ed9 S \u6a21\u5f0f</li> <li>\u5229\u7528 mscratch \u5b58\u50a8 M \u6a21\u5f0f\u4e0b\u7684\u6808\u6307\u9488</li> <li>\u6e05\u7a7a bss \u6bb5</li> <li>\u6253\u5f00\u4e2d\u65ad\u4f7f\u80fd</li> <li> <p>\u5207\u6362\u5230 S \u6a21\u5f0f\uff0c\u8fdb\u5165 S \u6a21\u5f0f\u521d\u59cb\u5316\u51fd\u6570</p> </li> <li> <p>S \u6a21\u5f0f\u4e0b\uff0c\u8fdb\u5165 <code>_supervisor</code> \u51fd\u6570</p> </li> <li> <p>\u5173\u95ed MMU</p> </li> <li>\u521d\u59cb\u5316\u9875\u8868</li> <li>\u5f00\u542f MMU</li> <li>\u8bbe\u7f6e S \u6a21\u5f0f\u4e0b\u7684\u4e2d\u65ad\u5904\u7406\u51fd\u6570 \uff08\u56e0\u4e3a M \u6a21\u5f0f\u5df2\u7ecf\u628a\u4e00\u4e9b\u4e2d\u65ad\u59d4\u6258\u7ed9 S \u6a21\u5f0f\u4e86\uff09</li> <li> <p>\u8df3\u8f6c\u5230\u865a\u62df\u7a7a\u95f4\u5730\u5740\u4e0b\u7684 <code>start_kernel</code> \u51fd\u6570</p> </li> <li> <p><code>start_kernel</code> \u51fd\u6570</p> </li> <li> <p>\u5229\u7528 ecall \u4e2d\u65ad\u8bbe\u7f6e\u7b2c\u4e00\u6b21\u65f6\u949f\u4e2d\u65ad</p> </li> <li>\u8c03\u7528 <code>task_init</code> \uff0c\u521b\u5efa\u8fdb\u7a0b\uff0c\u5206\u914d\u7a7a\u95f4\u548c\u76f8\u5173\u5143\u4fe1\u606f</li> <li><code>call_first_process</code> \u8fdb\u5165\u7b2c\u4e00\u4e2a\u7528\u6237\u7a0b\u5e8f</li> <li>\u53d1\u751f\u65f6\u949f\u4e2d\u65ad</li> </ol>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#33","title":"3.3 \u865a\u62df\u5185\u5b58\u7ba1\u7406","text":"<p>\u865a\u62df\u5185\u5b58\u662f\u8ba1\u7b97\u673a\u7cfb\u7edf\u5185\u5b58\u7ba1\u7406\u7684\u4e00\u79cd\u6280\u672f\u3002\u5b83\u4f7f\u5f97\u5e94\u7528\u7a0b\u5e8f\u8ba4\u4e3a\u5b83\u62e5\u6709\u8fde\u7eed\u7684\u53ef\u7528\u7684\u5185\u5b58\uff08\u4e00\u4e2a\u8fde\u7eed\u5b8c\u6574\u7684\u5730\u5740\u7a7a\u95f4\uff09\uff0c\u800c\u5b9e\u9645\u4e0a\uff0c\u5b83\u901a\u5e38\u662f\u88ab\u5206\u9694\u6210\u591a\u4e2a\u7269\u7406\u5185\u5b58\u788e\u7247\uff0c\u8fd8\u6709\u90e8\u5206\u6682\u65f6\u5b58\u50a8\u5728\u5916\u90e8\u78c1\u76d8\u5b58\u50a8\u5668\u4e0a\uff0c\u5728\u9700\u8981\u65f6\u8fdb\u884c\u6570\u636e\u4ea4\u6362\u3002</p> <p>\u901a\u8fc7\u5185\u5b58\u5730\u5740\u865a\u62df\u5316\uff0c\u53ef\u4ee5\u4f7f\u5f97\u8f6f\u4ef6\u5728\u6ca1\u6709\u8bbf\u95ee\u67d0\u865a\u62df\u5185\u5b58\u5730\u5740\u65f6\u4e0d\u5206\u914d\u5177\u4f53\u7684\u7269\u7406\u5185\u5b58\uff0c\u800c\u53ea\u6709\u5728\u5b9e\u9645\u8bbf\u95ee\u67d0\u865a\u62df\u5185\u5b58\u5730\u5740\u65f6\uff0c\u64cd\u4f5c\u7cfb\u7edf\u518d\u52a8\u6001\u5730\u5206\u914d\u7269\u7406\u5185\u5b58\uff0c\u5efa\u7acb\u865a\u62df\u5185\u5b58\u5230\u7269\u7406\u5185\u5b58\u7684\u9875\u6620\u5c04\u5173\u7cfb\uff0c\u8fd9\u79cd\u6280\u672f\u79f0\u4e3a\u6309\u9700\u5206\u9875\uff08demand paging\uff09\u3002\u628a\u4e0d\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u6240\u5360\u7684\u5185\u5b58\u7a7a\u95f4\u4e34\u65f6\u5199\u5230\u786c\u76d8\u4e0a\uff0c\u8fd9\u6837\u53ef\u4ee5\u817e\u51fa\u66f4\u591a\u7684\u7a7a\u95f2\u5185\u5b58\u7a7a\u95f4\u7ed9\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\uff1b\u5f53CPU\u8bbf\u95ee\u5230\u4e0d\u7ecf\u5e38\u8bbf\u95ee\u7684\u6570\u636e\u65f6\uff0c\u518d\u628a\u8fd9\u4e9b\u6570\u636e\u4ece\u786c\u76d8\u8bfb\u5165\u5230\u5185\u5b58\u4e2d\uff0c\u8fd9\u79cd\u6280\u672f\u79f0\u4e3a\u9875\u6362\u5165\u6362\u51fa\uff08page swap in/out\uff09\u3002\u8fd9\u79cd\u5185\u5b58\u7ba1\u7406\u6280\u672f\u7ed9\u4e86\u7a0b\u5e8f\u5458\u66f4\u5927\u7684\u5185\u5b58\u201c\u7a7a\u95f4\u201d\uff0c\u4ece\u800c\u53ef\u4ee5\u8ba9\u66f4\u591a\u7684\u7a0b\u5e8f\u5728\u5185\u5b58\u4e2d\u5e76\u53d1\u8fd0\u884c\u3002</p> <p>\u53e6\u5916\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u90fd\u62e5\u6709\u5c5e\u4e8e\u7684\u865a\u62df\u5185\u5b58\uff08\u9875\u8868\uff09\uff0c\u8fd9\u6837\u5404\u8fdb\u7a0b\u4e4b\u95f4\u7684\u5185\u5b58\u8bbf\u95ee\u8fd8\u53ef\u4ee5\u76f8\u4e92\u72ec\u7acb\uff0c\u4e92\u4e0d\u5f71\u54cd\u3002</p> <p>\u603b\u7ed3\u6765\u770b\uff0c\u865a\u62df\u5185\u5b58\u9700\u8981\u6709\u5982\u4e0b\u51e0\u4e2a\u7279\u70b9\uff1a</p> <ul> <li>\u900f\u660e \uff1a\u5e94\u7528\u5f00\u53d1\u8005\u53ef\u4ee5\u4e0d\u5fc5\u4e86\u89e3\u5e95\u5c42\u771f\u5b9e\u7269\u7406\u5185\u5b58\u7684\u786c\u4ef6\u7ec6\u8282\uff0c\u4e14\u5728\u975e\u5fc5\u8981\u65f6\u4e5f\u4e0d\u5fc5\u5173\u5fc3\u5185\u6838\u7684\u5b9e\u73b0\u7b56\u7565\uff0c \u6700\u5c0f\u5316\u4ed6\u4eec\u7684\u5fc3\u667a\u8d1f\u62c5\uff1b</li> <li>\u9ad8\u6548 \uff1a\u8fd9\u5c42\u62bd\u8c61\u81f3\u5c11\u5728\u5927\u591a\u6570\u60c5\u51b5\u4e0b\u4e0d\u5e94\u5e26\u6765\u8fc7\u5927\u7684\u989d\u5916\u5f00\u9500\uff1b</li> <li>\u5b89\u5168 \uff1a\u8fd9\u5c42\u62bd\u8c61\u5e94\u8be5\u6709\u6548\u68c0\u6d4b\u5e76\u963b\u6b62\u5e94\u7528\u8bfb\u5199\u5176\u4ed6\u5e94\u7528\u6216\u5185\u6838\u7684\u4ee3\u7801\u3001\u6570\u636e\u7b49\u4e00\u7cfb\u5217\u6076\u610f\u884c\u4e3a\u3002</li> </ul> <p>\u6211\u4eec\u56de\u987e\u4e00\u4e0b \u8ba1\u7b97\u673a\u7ec4\u6210\u539f\u7406 \u8bfe\uff0c\u5f53 CPU \u53d6\u6307\u4ee4\u6216\u8005\u6267\u884c\u4e00\u6761\u8bbf\u5b58\u6307\u4ee4\u7684\u65f6\u5019\uff0c\u5b83\u90fd\u662f\u57fa\u4e8e\u865a\u62df\u5730\u5740\u8bbf\u95ee\u5c5e\u4e8e\u5f53\u524d\u6b63\u5728\u8fd0\u884c\u7684\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u3002\u6b64\u65f6\uff0cCPU \u4e2d\u7684 \u5185\u5b58\u7ba1\u7406\u5355\u5143 (MMU, Memory Management Unit) \u81ea\u52a8\u5c06\u8fd9\u4e2a\u865a\u62df\u5730\u5740\u8fdb\u884c \u5730\u5740\u8f6c\u6362 (Address Translation) \u53d8\u4e3a\u4e00\u4e2a\u7269\u7406\u5730\u5740\uff0c\u5373\u8fd9\u4e2a\u5e94\u7528\u7684\u6570\u636e/\u6307\u4ee4\u7684\u7269\u7406\u5185\u5b58\u4f4d\u7f6e\u3002\u4e5f\u5c31\u662f\u8bf4\uff0c\u5728 MMU \u7684\u5e2e\u52a9\u4e0b\uff0c\u5e94\u7528\u5bf9\u81ea\u5df1\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u8bfb\u5199\u624d\u80fd\u88ab\u5b9e\u9645\u8f6c\u5316\u4e3a\u5bf9\u4e8e\u7269\u7406\u5185\u5b58\u7684\u8bbf\u95ee\u3002</p> <p>\u4e8b\u5b9e\u4e0a\uff0c\u6bcf\u4e2a\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u90fd\u5b58\u5728\u4e00\u4e2a\u4ece\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u5173\u7cfb\u3002\u53ef\u4ee5\u60f3\u8c61\u5bf9\u4e8e\u4e0d\u540c\u7684\u5e94\u7528\u6765\u8bf4\uff0c\u8be5\u6620\u5c04\u53ef\u80fd\u662f\u4e0d\u540c\u7684\uff0c\u5373 MMU \u53ef\u80fd\u4f1a\u5c06\u6765\u81ea\u4e0d\u540c\u4e24\u4e2a\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u7684\u76f8\u540c\u865a\u62df\u5730\u5740\u8f6c\u6362\u6210\u4e0d\u540c\u7684\u7269\u7406\u5730\u5740\u3002\u8981\u505a\u5230\u8fd9\u4e00\u70b9\uff0c\u5c31\u9700\u8981\u786c\u4ef6\u63d0\u4f9b\u4e00\u4e9b\u5bc4\u5b58\u5668\uff08\u5982satp\uff09\uff0c\u8f6f\u4ef6\u53ef\u4ee5\u5bf9\u5b83\u8fdb\u884c\u8bbe\u7f6e\u6765\u63a7\u5236 MMU \u6309\u7167\u54ea\u4e2a\u5e94\u7528\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\u8fdb\u884c\u5730\u5740\u8f6c\u6362\u3002\u4e8e\u662f\uff0c\u5c06\u5e94\u7528\u7684\u4ee3\u7801/\u6570\u636e\u653e\u5230\u7269\u7406\u5185\u5b58\u5e76\u8fdb\u884c\u7ba1\u7406\uff0c\u5efa\u7acb\u597d\u5e94\u7528\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\uff0c\u5728\u4efb\u52a1\u5207\u6362\u65f6\u63a7\u5236 MMU \u9009\u7528\u5e94\u7528\u7684\u5730\u5740\u6620\u5c04\u5173\u7cfb\uff0c\u5219\u662f\u4f5c\u4e3a\u8f6f\u4ef6\u90e8\u5206\u7684\u5185\u6838\u9700\u8981\u5b8c\u6210\u7684\u91cd\u8981\u5de5\u4f5c\u3002</p> <p>\u6211\u4eec\u628a\u4e00\u4e2a\u8fdb\u7a0b\u80fd\u591f\u8bbf\u95ee\u7684\u865a\u62df\u5185\u5b58\u533a\u57df\uff0c\u79f0\u4e3a\u5730\u5740\u7a7a\u95f4\u3002\u5730\u5740\u7a7a\u95f4\u53ea\u662f\u4e00\u5c42\u62bd\u8c61\u63a5\u53e3\uff0c\u5177\u4f53\u7684\u5b9e\u73b0\u5305\u62ec\u5982\u4f55\u5206\u914d\u4e0e\u7ba1\u7406\u7269\u7406\u5185\u5b58\u548c\u5982\u4f55\u521b\u5efa\u7269\u7406\u5185\u5b58\u4e0e\u865a\u62df\u5185\u5b58\u7684\u6620\u5c04\u4e24\u65b9\u9762\u3002\u8fd9\u4e24\u65b9\u9762\u53c8\u6709\u4e0d\u540c\u7684\u5b9e\u73b0\u7b56\u7565\uff0c\u4e0b\u9762\u6211\u4eec\u6765\u7b80\u5355\u4ecb\u7ecd\u4e00\u4e0b\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#331","title":"3.3.1 \u5982\u4f55\u5206\u914d\u4e0e\u7ba1\u7406\u7269\u7406\u5185\u5b58","text":"<p>\uff08\u4e0b\u6587\u53c2\u8003\u4e86rcore-tutorial-book-v3\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u81ea\u884c\u4e86\u89e3\uff09</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#3311","title":"3.3.1.1 \u5206\u6bb5\u5185\u5b58\u7ba1\u7406","text":"<p>\u66fe\u7ecf\u7684\u4e00\u79cd\u505a\u6cd5\u5982\u4e0a\u56fe\u6240\u793a\uff1a\u6bcf\u4e2a\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u5927\u5c0f\u9650\u5236\u4e3a\u4e00\u4e2a\u56fa\u5b9a\u7684\u5e38\u6570 <code>bound</code> \uff0c\u4e5f\u5373\u6bcf\u4e2a\u5e94\u7528\u7684\u53ef\u7528\u865a\u62df\u5730\u5740\u533a\u95f4\u5747\u4e3a<code>[0, bound)</code>\u3002\u968f\u540e\uff0c\u5c31\u53ef\u4ee5\u4ee5\u8fd9\u4e2a\u5927\u5c0f\u4e3a\u5355\u4f4d\uff0c\u5c06\u7269\u7406\u5185\u5b58\u9664\u4e86\u5185\u6838\u9884\u7559\u7a7a\u95f4\u4e4b\u5916\u7684\u90e8\u5206\u5212\u5206\u4e3a\u82e5\u5e72\u4e2a\u5927\u5c0f\u76f8\u540c\u7684 \u63d2\u69fd (Slot) \uff0c\u6bcf\u4e2a\u5e94\u7528\u7684\u6240\u6709\u6570\u636e\u90fd\u88ab\u5185\u6838\u653e\u7f6e\u5728\u5176\u4e2d\u4e00\u4e2a\u63d2\u69fd\u4e2d\uff0c\u5bf9\u5e94\u4e8e\u7269\u7406\u5185\u5b58\u4e0a\u7684\u4e00\u6bb5\u8fde\u7eed\u7269\u7406\u5730\u5740\u533a\u95f4\uff0c\u5047\u8bbe\u5176\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a <code>base</code>\uff0c\u5219\u7531\u4e8e\u4e8c\u8005\u5927\u5c0f\u76f8\u540c\uff0c\u8fd9\u4e2a\u533a\u95f4\u5b9e\u9645\u4e3a<code>[base, base+bound)</code>\u3002\u56e0\u6b64\u5730\u5740\u8f6c\u6362\u5f88\u5bb9\u6613\u5b8c\u6210\uff0c\u53ea\u9700\u68c0\u67e5\u4e00\u4e0b\u865a\u62df\u5730\u5740\u4e0d\u8d85\u8fc7\u5730\u5740\u7a7a\u95f4\u7684\u5927\u5c0f\u9650\u5236\uff08\u6b64\u65f6\u9700\u8981\u501f\u52a9\u7279\u6743\u7ea7\u673a\u5236\u901a\u8fc7\u5f02\u5e38\u6765\u8fdb\u884c\u5904\u7406\uff09\uff0c\u7136\u540e\u505a\u4e00\u4e2a\u7ebf\u6027\u6620\u5c04\uff0c\u5c06\u865a\u62df\u5730\u5740\u52a0\u4e0a <code>base</code> \u5c31\u5f97\u5230\u4e86\u6570\u636e\u5b9e\u9645\u6240\u5728\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>\u53ef\u4ee5\u770b\u51fa\uff0c\u8fd9\u79cd\u5b9e\u73b0\u6781\u5176\u7b80\u5355\uff1aMMU \u53ea\u9700\u8981 <code>base</code> \u548c <code>bound</code> \u4e24\u4e2a\u5bc4\u5b58\u5668\uff0c\u5728\u5730\u5740\u8f6c\u6362\u8fdb\u884c\u6bd4\u8f83\u6216\u52a0\u6cd5\u8fd0\u7b97\u5373\u53ef\uff1b\u800c\u5185\u6838\u53ea\u9700\u8981\u5728\u4efb\u52a1\u5207\u6362\u65f6\u5b8c\u6210\u5207\u6362 <code>base</code> \u5bc4\u5b58\u5668\u3002\u5728\u5bf9 Slot \u7ba1\u7406\u65b9\u9762\uff0c\u53ef\u4ee5\u7528\u4e00\u4e2a \u4f4d\u56fe (Bitmap) \u6765\u8868\u793a\uff0c\u968f\u7740\u5e94\u7528\u7684\u65b0\u589e\u548c\u9000\u51fa\u5bf9\u5e94\u7f6e\u4f4d\u6216\u6e05\u7a7a\u3002</p> <p>\u7136\u800c\uff0c\u5b83\u7684\u95ee\u9898\u5728\u4e8e\uff1a\u53ef\u80fd\u6d6a\u8d39\u7684\u5185\u5b58\u8d44\u6e90\u8fc7\u591a\u3002\u6ce8\u610f\u5230\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u9884\u7559\u4e86\u4e00\u90e8\u5206\uff0c\u5b83\u662f\u7528\u6765\u8ba9\u6808\u5f97\u4ee5\u5411\u4f4e\u5730\u5740\u589e\u957f\uff0c\u540c\u65f6\u5141\u8bb8\u5806\u5f80\u9ad8\u5730\u5740\u589e\u957f\uff08\u652f\u6301\u5e94\u7528\u8fd0\u884c\u65f6\u8fdb\u884c\u52a8\u6001\u5185\u5b58\u5206\u914d\uff09\u3002\u6bcf\u4e2a\u5e94\u7528\u5bf9\u5185\u5b58\u7684\u9700\u6c42\u90fd\u4e0d\u540c\uff0c\u5185\u6838\u53ea\u80fd\u6309\u7167\u5728\u5b83\u80fd\u529b\u8303\u56f4\u4e4b\u5185\u7684\u6d88\u8017\u5185\u5b58\u6700\u591a\u7684\u5e94\u7528\u7684\u6807\u51c6\u6765\u7edf\u4e00\u6307\u5b9a\u5730\u5740\u7a7a\u95f4\u7684\u5927\u5c0f\uff0c\u800c\u5176\u4ed6\u5185\u5b58\u9700\u6c42\u8f83\u4f4e\u7684\u5e94\u7528\u6839\u672c\u65e0\u6cd5\u5145\u5206\u5229\u7528\u5185\u6838\u7ed9\u4ed6\u4eec\u5206\u914d\u7684\u8fd9\u90e8\u5206\u7a7a\u95f4\u3002\u4f46\u8fd9\u90e8\u5206\u7a7a\u95f4\u53c8\u662f\u4e00\u4e2a\u5b8c\u6574\u7684\u63d2\u69fd\u7684\u4e00\u90e8\u5206\uff0c\u4e5f\u4e0d\u80fd\u518d\u4ea4\u7ed9\u5176\u4ed6\u5e94\u7528\u4f7f\u7528\u3002\u8fd9\u79cd\u5728\u5df2\u5206\u914d/\u4f7f\u7528\u7684\u5730\u5740\u7a7a\u95f4\u5185\u90e8\u65e0\u6cd5\u88ab\u5145\u5206\u5229\u7528\u7684\u7a7a\u95f4\u5c31\u662f\u5185\u788e\u7247 (Internal Fragment) \uff0c\u5b83\u9650\u5236\u4e86\u7cfb\u7edf\u540c\u65f6\u5171\u5b58\u7684\u5e94\u7528\u6570\u76ee\u3002\u5982\u679c\u5e94\u7528\u7684\u9700\u6c42\u8db3\u591f\u591a\u6837\u5316\uff0c\u90a3\u4e48\u5185\u6838\u65e0\u8bba\u5982\u4f55\u8bbe\u7f6e\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u7684\u5927\u5c0f\u9650\u5236\u4e5f\u4e0d\u80fd\u5f97\u5230\u6ee1\u610f\u7684\u7ed3\u679c\u3002\u8fd9\u5c31\u662f\u56fa\u5b9a\u53c2\u6570\u7684\u5f0a\u7aef\uff1a\u867d\u7136\u5b9e\u73b0\u7b80\u5355\uff0c\u4f46\u4e0d\u591f\u7075\u6d3b\u3002</p> <p>\u4e3a\u4e86\u89e3\u51b3\u8fd9\u4e2a\u95ee\u9898\uff0c\u4e00\u79cd\u5206\u6bb5\u7ba1\u7406\u7684\u7b56\u7565\u5f00\u59cb\u88ab\u4f7f\u7528\uff0c\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <p></p> <p>\u6ce8\u610f\u5230\u5185\u6838\u5f00\u59cb\u4ee5\u66f4\u7ec6\u7684\u7c92\u5ea6\uff0c\u4e5f\u5c31\u662f\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u4e00\u4e2a\u903b\u8f91\u6bb5\u4f5c\u4e3a\u5355\u4f4d\u6765\u5b89\u6392\u5e94\u7528\u7684\u6570\u636e\u5728\u7269\u7406\u5185\u5b58\u4e2d\u7684\u5e03\u5c40\u3002\u5bf9\u4e8e\u6bcf\u4e2a\u6bb5\u6765\u8bf4\uff0c\u4ece\u5b83\u5728\u67d0\u4e2a\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u865a\u62df\u5730\u5740\u5230\u5b83\u88ab\u5b9e\u9645\u5b58\u653e\u5728\u5185\u5b58\u4e2d\u7684\u7269\u7406\u5730\u5740\u4e2d\u95f4\u90fd\u8981\u7ecf\u8fc7\u4e00\u4e2a\u4e0d\u540c\u7684\u7ebf\u6027\u6620\u5c04\uff0c\u4e8e\u662f MMU \u9700\u8981\u7528\u4e00\u5bf9\u4e0d\u540c\u7684 <code>base, bound</code> \u8fdb\u884c\u533a\u5206\u3002\u8fd9\u91cc\u7531\u4e8e\u6bcf\u4e2a\u6bb5\u7684\u5927\u5c0f\u90fd\u662f\u4e0d\u540c\u7684\uff0c\u6211\u4eec\u4e5f\u4e0d\u518d\u80fd\u4ec5\u4ec5\u4f7f\u7528\u4e00\u4e2a <code>bound</code> \u8fdb\u884c\u7b80\u5316\u3002\u5f53\u4efb\u52a1\u5207\u6362\u7684\u65f6\u5019\uff0c\u8fd9\u4e9b <code>base, bound</code> \u5bf9\u5bc4\u5b58\u5668\u4e5f\u9700\u8981\u88ab\u5207\u6362\u3002</p> <p>\u7b80\u5355\u8d77\u89c1\uff0c\u6211\u4eec\u8fd9\u91cc\u5ffd\u7565\u4e00\u4e9b\u4e0d\u5fc5\u8981\u7684\u7ec6\u8282\u3002\u6bd4\u5982\u5e94\u7528\u5728\u4ee5\u865a\u62df\u5730\u5740\u4e3a\u7d22\u5f15\u8bbf\u95ee\u5730\u5740\u7a7a\u95f4\u7684\u65f6\u5019\uff0c\u5b83\u5982\u4f55\u77e5\u9053\u8be5\u5730\u5740\u5c5e\u4e8e\u54ea\u4e2a\u6bb5\uff0c\u4ece\u800c\u786c\u4ef6\u53ef\u4ee5\u4f7f\u7528\u6b63\u786e\u7684\u4e00\u5bf9 <code>base, bound</code> \u5bc4\u5b58\u5668\u8fdb\u884c\u5408\u6cd5\u6027\u68c0\u67e5\u548c\u5b8c\u6210\u5b9e\u9645\u7684\u5730\u5740\u8f6c\u6362\u3002\u8fd9\u91cc\u53ea\u5173\u6ce8\u5206\u6bb5\u7ba1\u7406\u662f\u5426\u89e3\u51b3\u4e86\u5185\u788e\u7247\u5e26\u6765\u7684\u5185\u5b58\u6d6a\u8d39\u95ee\u9898\u3002\u6ce8\u610f\u5230\u6bcf\u4e2a\u6bb5\u90fd\u53ea\u4f1a\u5728\u5185\u5b58\u4e2d\u5360\u636e\u4e00\u5757\u4e0e\u5b83\u5b9e\u9645\u6240\u7528\u5230\u7684\u5927\u5c0f\u76f8\u7b49\u7684\u7a7a\u95f4\u3002\u5806\u7684\u60c5\u51b5\u53ef\u80fd\u6bd4\u8f83\u7279\u6b8a\uff0c\u5b83\u7684\u5927\u5c0f\u53ef\u80fd\u4f1a\u5728\u8fd0\u884c\u65f6\u589e\u957f\uff0c\u4f46\u662f\u90a3\u9700\u8981\u5e94\u7528\u901a\u8fc7\u7cfb\u7edf\u8c03\u7528\u5411\u5185\u6838\u8bf7\u6c42\u3002\u4e5f\u5c31\u662f\u8bf4\u8fd9\u662f\u4e00\u79cd\u6309\u9700\u5206\u914d\uff0c\u800c\u4e0d\u518d\u662f\u5185\u6838\u5728\u5f00\u59cb\u65f6\u5c31\u7ed9\u6bcf\u4e2a\u5e94\u7528\u5206\u914d\u4e00\u5927\u5757\u5f88\u53ef\u80fd\u7528\u4e0d\u5b8c\u7684\u5185\u5b58\u3002\u7531\u6b64\uff0c\u6211\u4eec\u7684\u5185\u5b58\u4e2d\u4e0d\u518d\u6709\u5185\u788e\u7247\u4e86\u3002</p> <p>\u5c3d\u7ba1\u5185\u788e\u7247\u88ab\u6d88\u9664\u4e86\uff0c\u4f46\u5185\u5b58\u6d6a\u8d39\u95ee\u9898\u5e76\u6ca1\u6709\u5b8c\u5168\u89e3\u51b3\u3002\u8fd9\u662f\u56e0\u4e3a\u6bcf\u4e2a\u6bb5\u7684\u5927\u5c0f\u90fd\u662f\u4e0d\u540c\u7684\uff08\u5b83\u4eec\u53ef\u80fd\u6765\u81ea\u4e0d\u540c\u7684\u5e94\u7528\uff0c\u529f\u80fd\u4e5f\u4e0d\u540c\uff09\uff0c\u5185\u6838\u5c31\u9700\u8981\u4f7f\u7528\u66f4\u52a0\u901a\u7528\u3001\u4e5f\u66f4\u52a0\u590d\u6742\u7684\u8fde\u7eed\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u6765\u8fdb\u884c\u5185\u5b58\u7ba1\u7406\uff0c\u800c\u4e0d\u80fd\u50cf\u4e4b\u524d\u7684\u63d2\u69fd\u90a3\u6837\u4ee5\u4e00\u4e2a\u6bd4\u7279\u4e3a\u5355\u4f4d\u3002\u987e\u540d\u601d\u4e49\uff0c\u8fde\u7eed\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u5c31\u662f\u6bcf\u6b21\u9700\u8981\u5206\u914d\u4e00\u5757\u8fde\u7eed\u5185\u5b58\u6765\u5b58\u653e\u4e00\u4e2a\u6bb5\u7684\u6570\u636e\u3002\u968f\u7740\u4e00\u6bb5\u65f6\u95f4\u7684\u5206\u914d\u548c\u56de\u6536\uff0c\u7269\u7406\u5185\u5b58\u8fd8\u5269\u4e0b\u4e00\u4e9b\u76f8\u4e92\u4e0d\u8fde\u7eed\u7684\u8f83\u5c0f\u7684\u53ef\u7528\u8fde\u7eed\u5757\uff0c\u5176\u4e2d\u6709\u4e00\u4e9b\u53ea\u662f\u4e24\u4e2a\u5df2\u5206\u914d\u5185\u5b58\u5757\u4e4b\u95f4\u7684\u5f88\u5c0f\u7684\u95f4\u9699\uff0c\u5b83\u4eec\u81ea\u5df1\u53ef\u80fd\u7531\u4e8e\u7a7a\u95f4\u8f83\u5c0f\uff0c\u5df2\u7ecf\u65e0\u6cd5\u88ab\u7528\u4e8e\u5206\u914d\uff0c\u8fd9\u5c31\u662f\u5916\u788e\u7247 (External Fragment) \u3002</p> <p>\u5982\u679c\u8fd9\u65f6\u518d\u60f3\u5206\u914d\u4e00\u4e2a\u6bd4\u8f83\u5927\u7684\u5757\uff0c\u5c31\u9700\u8981\u5c06\u8fd9\u4e9b\u4e0d\u8fde\u7eed\u7684\u5916\u788e\u7247\u201c\u62fc\u8d77\u6765\u201d\uff0c\u5f62\u6210\u4e00\u4e2a\u5927\u7684\u8fde\u7eed\u5757\u3002\u7136\u800c\u8fd9\u662f\u4e00\u4ef6\u5f00\u9500\u5f88\u5927\u7684\u4e8b\u60c5\uff0c\u6d89\u53ca\u5230\u6781\u5927\u7684\u5185\u5b58\u8bfb\u5199\u5f00\u9500\u3002\u5177\u4f53\u800c\u8a00\uff0c\u8fd9\u9700\u8981\u79fb\u52a8\u548c\u8c03\u6574\u4e00\u4e9b\u5df2\u5206\u914d\u5185\u5b58\u5757\u5728\u7269\u7406\u5185\u5b58\u4e0a\u7684\u4f4d\u7f6e\uff0c\u624d\u80fd\u8ba9\u90a3\u4e9b\u5c0f\u7684\u5916\u788e\u7247\u80fd\u591f\u5408\u5728\u4e00\u8d77\uff0c\u5f62\u6210\u4e00\u4e2a\u5927\u7684\u7a7a\u95f2\u5757\u3002\u5982\u679c\u8fde\u7eed\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u9009\u53d6\u5f97\u5f53\uff0c\u53ef\u4ee5\u5c3d\u53ef\u80fd\u51cf\u5c11\u8fd9\u79cd\u64cd\u4f5c\u3002\u64cd\u4f5c\u7cfb\u7edf\u8bfe\u4e0a\u6240\u8bb2\u5230\u7684\u90a3\u4e9b\u7b97\u6cd5\uff0c\u5305\u62ec <code>first-fit/worst-fit/best-fit</code> \u6216\u662f <code>buddy system</code>\uff0c\u5176\u5177\u4f53\u8868\u73b0\u53d6\u51b3\u4e8e\u5b9e\u9645\u7684\u5e94\u7528\u9700\u6c42\uff0c\u5404\u6709\u4f18\u52a3\u3002</p> <p>\u90a3\u4e48\uff0c\u5206\u6bb5\u5185\u5b58\u7ba1\u7406\u5e26\u6765\u7684\u5916\u788e\u7247\u548c\u8fde\u7eed\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u6bd4\u8f83\u590d\u6742\u7684\u95ee\u9898\u53ef\u5426\u88ab\u89e3\u51b3\u5462\uff1f</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#3312","title":"3.3.1.2 \u5206\u9875\u5185\u5b58\u7ba1\u7406","text":"<p>\u4ed4\u7ec6\u5206\u6790\u4e00\u4e0b\u53ef\u4ee5\u53d1\u73b0\uff0c\u6bb5\u7684\u5927\u5c0f\u4e0d\u4e00\u662f\u5916\u788e\u7247\u4ea7\u751f\u7684\u6839\u672c\u539f\u56e0\u3002\u4f7f\u7528 Slot \u8fdb\u884c\u5185\u5b58\u7ba1\u7406\uff0c\u53ea\u9700\u5229\u7528\u7c7b\u4f3c\u4f4d\u56fe\u7684\u6570\u636e\u7ed3\u6784\u7ef4\u62a4\u4e00\u7ec4\u63d2\u69fd\u7684\u5360\u7528\u72b6\u6001\uff0c\u4ece\u903b\u8f91\u4e0a\u5206\u914d\u548c\u56de\u6536\u90fd\u662f\u4ee5\u4e00\u4e2a\u56fa\u5b9a\u7684\u5927\u5c0f\u4e3a\u5355\u4f4d\uff0c\u81ea\u7136\u4e5f\u5c31\u4e0d\u4f1a\u5b58\u5728\u5916\u788e\u7247\u4e86\u3002\u4f46\u662f\u8fd9\u6837\u7c92\u5ea6\u8fc7\u5927\uff0c\u4e0d\u591f\u7075\u6d3b\uff0c\u53c8\u5728\u5730\u5740\u7a7a\u95f4\u5185\u90e8\u4ea7\u751f\u4e86\u5185\u788e\u7247\u3002</p> <p>\u82e5\u8981\u7ed3\u5408\u4e8c\u8005\u7684\u4f18\u70b9\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u5185\u6838\u59cb\u7ec8\u4ee5\u4e00\u4e2a\u540c\u6837\u5927\u5c0f\u7684\u5355\u4f4d\u6765\u5728\u7269\u7406\u5185\u5b58\u4e0a\u653e\u7f6e\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u6570\u636e\uff0c\u8fd9\u6837\u5185\u6838\u5c31\u53ef\u4ee5\u4f7f\u7528\u7b80\u5355\u7684\u63d2\u69fd\u5f0f\u5185\u5b58\u7ba1\u7406\uff0c\u4f7f\u5f97\u5185\u5b58\u5206\u914d\u7b97\u6cd5\u6bd4\u8f83\u7b80\u5355\u4e14\u4e0d\u4f1a\u4ea7\u751f\u5916\u788e\u7247\uff1b\u540c\u65f6\uff0c\u8fd9\u4e2a\u5355\u4f4d\u7684\u5927\u5c0f\u8981\u8db3\u591f\u5c0f\uff0c\u4ece\u800c\u5176\u5185\u90e8\u6ca1\u6709\u88ab\u7528\u5230\u7684\u5185\u788e\u7247\u7684\u5927\u5c0f\u4e5f\u8db3\u591f\u5c0f\uff0c\u5c3d\u53ef\u80fd\u63d0\u9ad8\u5185\u5b58\u5229\u7528\u7387\u3002\u8fd9\u4fbf\u662f\u6211\u4eec\u5c06\u8981\u4ecb\u7ecd\u7684\u5206\u9875\u5185\u5b58\u7ba1\u7406\u3002</p> <p></p> <p>\u5982\u4e0a\u56fe\u6240\u793a\uff0c\u5185\u6838\u4ee5\u9875\u4e3a\u5355\u4f4d\u8fdb\u884c\u7269\u7406\u5185\u5b58\u7ba1\u7406\u3002\u6bcf\u4e2a\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u53ef\u4ee5\u88ab\u5206\u6210\u82e5\u5e72\u4e2a(\u865a\u62df)\u9875\u9762 (Page) \uff0c\u800c\u53ef\u7528\u7684\u7269\u7406\u5185\u5b58\u4e5f\u540c\u6837\u53ef\u4ee5\u88ab\u5206\u6210\u82e5\u5e72\u4e2a(\u7269\u7406)\u9875\u5e27 (Frame) \uff0c\u865a\u62df\u9875\u9762\u548c\u7269\u7406\u9875\u5e27\u7684\u5927\u5c0f\u76f8\u540c\u3002\u6bcf\u4e2a\u865a\u62df\u9875\u9762\u4e2d\u7684\u6570\u636e\u5b9e\u9645\u4e0a\u90fd\u5b58\u50a8\u5728\u67d0\u4e2a\u7269\u7406\u9875\u5e27\u4e0a\u3002\u76f8\u6bd4\u5206\u6bb5\u5185\u5b58\u7ba1\u7406\uff0c\u5206\u9875\u5185\u5b58\u7ba1\u7406\u7684\u7c92\u5ea6\u66f4\u5c0f\u4e14\u5927\u5c0f\u56fa\u5b9a\uff0c\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u903b\u8f91\u6bb5\u90fd\u7531\u591a\u4e2a\u865a\u62df\u9875\u9762\u7ec4\u6210\u3002\u800c\u4e14\u6bcf\u4e2a\u865a\u62df\u9875\u9762\u5728\u5730\u5740\u8f6c\u6362\u7684\u8fc7\u7a0b\u4e2d\u90fd\u4f7f\u7528\u4e0e\u8fd0\u884c\u7684\u5e94\u7528\u7ed1\u5b9a\u7684\u4e0d\u540c\u7684\u7ebf\u6027\u6620\u5c04\uff0c\u800c\u4e0d\u50cf\u5206\u6bb5\u5185\u5b58\u7ba1\u7406\u90a3\u6837\u6bcf\u4e2a\u903b\u8f91\u6bb5\u90fd\u4f7f\u7528\u4e00\u4e2a\u76f8\u540c\u7684\u7ebf\u6027\u6620\u5c04\u3002</p> <p>\u4e3a\u4e86\u65b9\u4fbf\u5b9e\u73b0\u865a\u62df\u9875\u9762\u5230\u7269\u7406\u9875\u5e27\u7684\u5730\u5740\u8f6c\u6362\uff0c\u6211\u4eec\u7ed9\u6bcf\u4e2a\u865a\u62df\u9875\u9762\u548c\u7269\u7406\u9875\u5e27\u4e00\u4e2a\u7f16\u53f7\uff0c\u5206\u522b\u79f0\u4e3a\u865a\u62df\u9875\u53f7 (VPN, Virtual Page Number) \u548c\u7269\u7406\u9875\u53f7 (PPN, Physical Page Number) \u3002\u6bcf\u4e2a\u5e94\u7528\u90fd\u6709\u4e00\u4e2a\u8868\u793a\u5730\u5740\u6620\u5c04\u5173\u7cfb\u7684\u9875\u8868 (Page Table) \uff0c\u91cc\u9762\u8bb0\u5f55\u4e86\u8be5\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u6bcf\u4e2a\u865a\u62df\u9875\u9762\u6620\u5c04\u5230\u7269\u7406\u5185\u5b58\u4e2d\u7684\u54ea\u4e2a\u7269\u7406\u9875\u5e27\uff0c\u5373\u6570\u636e\u5b9e\u9645\u88ab\u5185\u6838\u653e\u5728\u54ea\u91cc\u3002\u6211\u4eec\u53ef\u4ee5\u7528\u9875\u53f7\u6765\u4ee3\u8868\u4e8c\u8005\uff0c\u56e0\u6b64\u5982\u679c\u5c06\u9875\u8868\u770b\u6210\u4e00\u4e2a\u952e\u503c\u5bf9\uff0c\u5176\u952e\u7684\u7c7b\u578b\u4e3a\u865a\u62df\u9875\u53f7\uff0c\u503c\u7684\u7c7b\u578b\u5219\u4e3a\u7269\u7406\u9875\u53f7\u3002\u5f53 MMU \u8fdb\u884c\u5730\u5740\u8f6c\u6362\u7684\u65f6\u5019\uff0c\u865a\u62df\u5730\u5740\u4f1a\u5206\u4e3a\u4e24\u90e8\u5206\uff08\u865a\u62df\u9875\u53f7\uff0c\u9875\u5185\u504f\u79fb\uff09\uff0cMMU \u9996\u5148\u627e\u5230\u865a\u62df\u5730\u5740\u6240\u5728\u865a\u62df\u9875\u9762\u7684\u9875\u53f7\uff0c\u7136\u540e\u67e5\u5f53\u524d\u5e94\u7528\u7684\u9875\u8868\uff0c\u6839\u636e\u865a\u62df\u9875\u53f7\u627e\u5230\u7269\u7406\u9875\u53f7\uff1b\u6700\u540e\u6309\u7167\u865a\u62df\u5730\u5740\u7684\u9875\u5185\u504f\u79fb\uff0c\u7ed9\u7269\u7406\u9875\u53f7\u5bf9\u5e94\u7684\u7269\u7406\u9875\u5e27\u7684\u8d77\u59cb\u5730\u5740\u52a0\u4e0a\u4e00\u4e2a\u504f\u79fb\u91cf\uff0c\u8fd9\u5c31\u5f97\u5230\u4e86\u5b9e\u9645\u8bbf\u95ee\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>\u5728\u9875\u8868\u4e2d\uff0c\u8fd8\u9488\u5bf9\u865a\u62df\u9875\u53f7\u8bbe\u7f6e\u4e86\u4e00\u7ec4\u4fdd\u62a4\u4f4d\uff0c\u5b83\u9650\u5236\u4e86\u5e94\u7528\u5bf9\u8f6c\u6362\u5f97\u5230\u7684\u7269\u7406\u5730\u5740\u5bf9\u5e94\u7684\u5185\u5b58\u7684\u4f7f\u7528\u65b9\u5f0f\u3002\u6700\u5178\u578b\u7684\u5982 <code>rwx</code> \uff0c <code>r</code> \u8868\u793a\u5f53\u524d\u5e94\u7528\u53ef\u4ee5\u8bfb\u8be5\u5185\u5b58\uff1b <code>w</code> \u8868\u793a\u5f53\u524d\u5e94\u7528\u53ef\u4ee5\u5199\u8be5\u5185\u5b58\uff1b <code>x</code> \u5219\u8868\u793a\u5f53\u524d\u5e94\u7528\u53ef\u4ee5\u4ece\u8be5\u5185\u5b58\u53d6\u6307\u4ee4\u7528\u6765\u6267\u884c\u3002\u4e00\u65e6\u8fdd\u53cd\u4e86\u8fd9\u79cd\u9650\u5236\u5219\u4f1a\u89e6\u53d1\u5f02\u5e38\uff0c\u5e76\u88ab\u5185\u6838\u6355\u83b7\u5230\u3002\u901a\u8fc7\u9002\u5f53\u7684\u8bbe\u7f6e\uff0c\u53ef\u4ee5\u68c0\u67e5\u4e00\u4e9b\u5e94\u7528\u5728\u8fd0\u884c\u65f6\u7684\u660e\u663e\u9519\u8bef\uff1a\u6bd4\u5982\u5e94\u7528\u4fee\u6539\u53ea\u8bfb\u7684\u4ee3\u7801\u6bb5\uff0c\u6216\u8005\u4ece\u6570\u636e\u6bb5\u53d6\u6307\u4ee4\u6765\u6267\u884c\u3002</p> <p>\u5f53\u4e00\u4e2a\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u6bd4\u8f83\u5927\u7684\u65f6\u5019\uff0c\u9875\u8868\u4e2d\u7684\u9879\u6570\u4f1a\u5f88\u591a\uff08\u4e8b\u5b9e\u4e0a\u6bcf\u4e2a\u865a\u62df\u9875\u9762\u90fd\u5e94\u8be5\u5bf9\u5e94\u9875\u8868\u4e2d\u7684\u4e00\u9879\uff0c\u4e0a\u56fe\u4e2d\u6211\u4eec\u5df2\u7ecf\u7701\u7565\u6389\u4e86\u90a3\u4e9b\u672a\u88ab\u4f7f\u7528\u7684\u865a\u62df\u9875\u9762\uff09\uff0c\u5bfc\u81f4\u5b83\u7684\u5bb9\u91cf\u6781\u901f\u81a8\u80c0\uff0c\u5df2\u7ecf\u4e0d\u518d\u662f\u50cf\u4e4b\u524d\u90a3\u6837\u6570\u4e2a\u5bc4\u5b58\u5668\u4fbf\u53ef\u5b58\u4e0b\u6765\u7684\u4e86\uff0cCPU \u5185\u4e5f\u6ca1\u6709\u8db3\u591f\u7684\u786c\u4ef6\u8d44\u6e90\u80fd\u591f\u5c06\u5b83\u5b58\u4e0b\u6765\u3002\u56e0\u6b64\u5b83\u53ea\u80fd\u4f5c\u4e3a\u4e00\u79cd\u88ab\u5185\u6838\u7ba1\u7406\u7684\u6570\u636e\u7ed3\u6784\u653e\u5728\u5185\u5b58\u4e2d\uff0c\u7531\u5185\u6838\u7ba1\u7406\u3002\u56e0\u6b64\u5185\u6838\u4e0e\u786c\u4ef6\u5fc5\u987b\u4e25\u683c\u9075\u5b88\u9875\u8868\u7684\u5185\u5b58\u5e03\u5c40\u89c4\u8303\uff0c\u624d\u80fd\u6b63\u786e\u7684\u4f7f\u7528\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\u3002</p> <p>\u7531\u4e8e\u5206\u9875\u5185\u5b58\u7ba1\u7406\u65e2\u7b80\u5355\u53c8\u7075\u6d3b\uff0c\u5b83\u9010\u6e10\u6210\u4e3a\u4e86\u4e3b\u6d41\u7684\u5185\u5b58\u7ba1\u7406\u673a\u5236\uff0cRISC-V \u67b6\u6784\u4e5f\u4f7f\u7528\u4e86\u8fd9\u79cd\u673a\u5236\u3002\u540e\u9762\u6211\u4eec\u4f1a\u57fa\u4e8e\u8fd9\u79cd\u673a\u5236\uff0c\u81ea\u5df1\u52a8\u624b\u4ece\u7269\u7406\u5185\u5b58\u62bd\u8c61\u51fa\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u6765\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#332","title":"3.3.2 \u5982\u4f55\u521b\u5efa\u7269\u7406\u5185\u5b58\u4e0e\u865a\u62df\u5185\u5b58\u7684\u6620\u5c04","text":"<p>\u4e0a\u6587\u6211\u4eec\u7b80\u5355\u4ecb\u7ecd\u4e86\u5982\u4f55\u4ece\u865a\u62df\u5730\u5740\u8f6c\u6362\u6210\u7269\u7406\u5730\u5740\uff1a\u57fa\u4e8e\u865a\u62df\u9875\u9762\u5230\u7269\u7406\u9875\u5e27\u7684\u6620\u5c04\uff0c\u52a0\u4e0a\u504f\u79fb\u91cf\u3002\u4e0b\u9762\u6211\u4eec\u5c06\u8be6\u7ec6\u4ecb\u7ecd\u5728\u672c\u6b21\u8bd5\u9a8c\u4e2d\u6211\u4eec\u4f7f\u7528\u7684\u865a\u62df\u5730\u5740\u89c4\u8303 Sv39\uff0c\u8bf7\u540c\u5b66\u4eec\u7ed3\u5408\u3010RISC-V \u4e2d\u6587\u624b\u518c 10.6 \u8282\u57fa\u4e8e\u9875\u9762\u7684\u865a\u62df\u5185\u5b58\u3011\u5b66\u4e60\uff08 riscv\u7279\u6743\u624b\u518c \u4e2d\u8be6\u7ec6\u4ecb\u7ecd\u4e86 Sv39 \u7684\u5b9e\u73b0\u6807\u51c6\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u81ea\u884c\u9605\u8bfb\uff09\u3002</p> <p>Sv39 \u4f7f\u75284KB\u5927\u7684\u57fa\u9875\uff0c\u9875\u8868\u9879\u7684\u5927\u5c0f\u662f 8 \u4e2a\u5b57\u8282\uff0c\u4f7f\u7528\u6811\u5f62\u7684\u4e09\u7ea7\u9875\u8868\uff0c\u79f0\u4f5c\u4e00\u7ea7\u9875\u8868\uff08\u6839\u9875\u8868\uff09\u3001\u4e8c\u7ea7\u9875\u8868\u548c\u4e09\u7ea7\u9875\u8868\u3002\u4e00\u7ea7\u9875\u8868\u7684\u9875\u8868\u9879\u6307\u5411\u4e00\u5f20\u4e8c\u7ea7\u9875\u8868\uff0c\u4e8c\u7ea7\u9875\u8868\u7684\u9875\u8868\u9879\u6307\u5411\u4e00\u5f20\u4e09\u7ea7\u9875\u8868\uff0c\u4e09\u7ea7\u9875\u8868\u7684\u9875\u8868\u9879\u4e3a\u76ee\u6807\u7269\u7406\u9875\u5e27\u5730\u5740\u3002\u6ce8\u610f\u9875\u8868\u662f\u7531\u786c\u4ef6\uff08MMU\uff09\u4f7f\u7528\u7684\uff0c\u56e0\u6b64\u6bcf\u4e2a\u9875\u8868\u9879\u90fd\u662f\u7269\u7406\u5730\u5740\uff01\u5728\u5b9e\u73b0\u9875\u8868\u529f\u80fd\u65f6\u8981\u6ce8\u610f\u3002</p> <p>\u6bcf\u5f20\u9875\u8868\u5360\u636e\u4e00\u4e2a\u9875\uff08\u8fd9\u91cc\u7684\u201c\u9875\u8868\u201d\u6307\u67d0\u4e2a\u4e00/\u4e8c/\u4e09\u7ea7\u9875\u8868\uff0c\u800c\u901a\u5e38\u6211\u4eec\u63d0\u5230 \u201c\u67d0\u4e2a\u8fdb\u7a0b\u7684\u9875\u8868\u201d \u65f6\uff0c\u6307\u7684\u662f\u5305\u542b\u5168\u90e8\u4e09\u7ea7\u9875\u8868\u7684\u6574\u4f53\uff09\uff0c\u6240\u4ee5\u6bcf\u4e2a\u9875\u8868\u5185\u53ef\u4ee5\u5b58\u653e 512 \u4e2a\u9875\u8868\u9879\uff0c\u5168\u90e8\u7684\u4e09\u7ea7\u9875\u8868\u53ef\u4ee5\u8868\u793a\u7684\u865a\u62df\u7a7a\u95f4\u5927\u5c0f\u4e3a512512512*4 KB\uff0c\u5373 512GB\u3002</p> <p>Sv39\u6807\u51c6\u4e0b\u7684\u865a\u62df\u5730\u5740\u548c\u7269\u7406\u5730\u5740\u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>     38        30 29        21 20        12 11                           0\n    -----------------------------------------------------------------------\n    |   VPN[2]   |   VPN[1]   |   VPN[0]   |          page offset         |\n    -----------------------------------------------------------------------\n                            Sv39 virtual address\n</code></pre> <pre><code> 55                30 29        21 20        12 11                           0\n------------------------------------------------------------------------------\n|                      PPN                    |          page offset         |\n------------------------------------------------------------------------------\n                            Sv39 physical address\n</code></pre> <p>Sv39 \u6a21\u5f0f\u5b9a\u4e49\u7269\u7406\u5730\u5740\u6709 56 \u4f4d\uff0c\u865a\u62df\u5730\u5740\u6709 64 \u4f4d\u3002\u4f46\u662f\uff0c\u865a\u62df\u5730\u5740\u7684 64 \u4f4d\u53ea\u6709 39 \u4f4d\u6709\u6548\uff0c63-39\u4f4d\u5728\u672c\u6b21\u5b9e\u9a8c\u4e2d\uff08\u9ad8\u5730\u5740\u6620\u5c04\uff09\u9700\u8981\u4e3a 1 \u4fdd\u8bc1\u5730\u5740\u6709\u6548\u3002Sv39 \u652f\u6301\u4e09\u7ea7\u9875\u8868\u7ed3\u6784\uff0c<code>VPN</code> \u4ee3\u8868\u865a\u62df\u9875\u53f7\uff0c\u5728\u865a\u62df\u5730\u5740\u8f6c\u6362\u8fc7\u7a0b\u4e2d\uff0c\u5c06 <code>VPN</code> \u5206\u4e3a\u4e09\u90e8\u5206\uff0c\u5206\u522b\u5bf9\u5e94\u6bcf\u4e00\u7ea7\u9875\u8868\u9879\u7684 id\uff08\u8be6\u89c1\u4e0b\u6587\uff09\uff0c<code>PPN</code> \u4ee3\u8868\u7269\u7406\u9875\u53f7\u3002\u7269\u7406\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u7684\u4f4e 12 \u4f4d\u8868\u793a\u9875\u5185\u504f\u79fb\uff08page offset\uff09\u3002\u3010\u9700\u8981\u8bf4\u660e\u7684\u662f\uff0c\u6309\u7167\u7279\u6743\u67b6\u6784\u8bf4\u660e\u4e66\uff0c\u5bf9\u4e8e Sv39 \u6765\u8bf4\uff0c\u9700\u8981 63-39 \u4f4d\u90fd\u7b49\u4e8e 38 \u4f4d\uff0c\u624d\u4e0d\u4f1a\u53d1\u751f\u7f3a\u9875\u5f02\u5e38\uff0c\u800c\u4e00\u822c\u89c4\u5b9a\u4e0b\uff0c\u8fd9\u4e9b\u4f4d\u5168\u4e3a 1 \u65f6\u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u7ed9\u5185\u6838\u4f7f\u7528\uff0c\u5168\u4e3a 0 \u7684\u865a\u62df\u5185\u5b58\u7a7a\u95f4\u7ed9\u7528\u6237\u6001\u4f7f\u7528\u3011</p> <p>\u865a\u62df\u5730\u5740\u7ffb\u8bd1\u4e3a\u7269\u7406\u5730\u5740\u7684\u5b8c\u6574\u8fc7\u7a0b\u8bf7\u53c2\u8003 Virtual Address Translation Process\uff0c\u5efa\u8bae\u4ed4\u7ec6\u9605\u8bfb\uff0c\u7b80\u5316\u7248\u5185\u5bb9\u5982\u4e0b\uff1a</p> <ol> <li>\u4ece satp \u7684 <code>PPN</code> \u4e2d\u83b7\u53d6\u6839\u9875\u8868\u7684\u7269\u7406\u5730\u5740\uff0c\u5373 <code>PPN &lt;&lt; 12</code> \u3002    satp\uff08Supervisor Address Translation and Protection\uff0c\u76d1\u7ba1\u8005\u5730\u5740\u8f6c\u6362\u548c\u4fdd\u62a4\uff09\u662f\u4e00\u4e2a S \u6a21\u5f0f\u63a7\u5236\u72b6\u6001\u5bc4\u5b58\u5668\uff0c\u63a7\u5236\u4e86\u5206\u9875\u7cfb\u7edf\uff0c\u5176\u5185\u5bb9\u5982\u4e0b\u6240\u793a\uff1a</li> </ol> <pre><code> 63      60 59                  44 43                                0\n ---------------------------------------------------------------------\n|   MODE   |         ASID         |                PPN                |\n ---------------------------------------------------------------------\n</code></pre> <ul> <li>MODE\uff1a\u53ef\u4ee5\u5f00\u542f\u5206\u9875\u5e76\u9009\u62e9\u9875\u8868\u7ea7\u6570\uff0c8 \u8868\u793a Sv39 \u5206\u914d\u65b9\u6848\uff0c0 \u8868\u793a\u7981\u7528\u865a\u62df\u5730\u5740\u6620\u5c04\u3002</li> <li>ASID (Address Space Identifier) \uff1a \u7528\u6765\u533a\u5206\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u7528\u4e8e\u786c\u4ef6\u68c0\u6d4bTLB\u662f\u5426\u8fc7\u671f\u3002</li> <li> <p>PPN (Physical Page Number) \uff1a\u4fdd\u5b58\u4e86\u6839\u9875\u8868\u7684\u7269\u7406\u5730\u5740\uff0c\u6ce8\u610f <code>PPN = physical address &gt;&gt; 12</code>\u3002M \u6a21\u5f0f\u7684\u7a0b\u5e8f\u5728\u7b2c\u4e00\u6b21\u8fdb\u5165 S \u6a21\u5f0f\u4e4b\u524d\u4f1a\u628a\u96f6\u5199\u5165 satp \u4ee5\u7981\u7528\u5206\u9875\uff0c\u7136\u540e S \u6a21\u5f0f\u7684\u7a0b\u5e8f\u5728\u521d\u59cb\u5316\u9875\u8868\u4ee5\u540e\u4f1a\u521d\u59cb\u5316 <code>satp</code> \u4ee5\u5f00\u542f\u9875\u8868\u3002</p> </li> <li> <p>\u8bbf\u95ee\u6839\u9875\u8868\u4e2d\u7684\u7b2c <code>VPN[i]</code> \u9875\u8868\u9879\uff08\u521d\u59cb<code>i=2</code>\uff09\uff0c\u83b7\u53d6 PTE\u3002</p> </li> <li>\u68c0\u67e5PTE\u7684 <code>V bit</code>\uff0c\u5982\u679c\u4e0d\u5408\u6cd5\uff0c\u5e94\u8be5\u4ea7\u751f page fault \u5f02\u5e38\u3002</li> <li>\u68c0\u67e5PTE\u7684 <code>RWX</code> bits\uff0c\u5982\u679c\u5168\u90e8\u4e3a 0\uff0c\u5219\u4ece PTE \u4e2d\u7684 PPN \u5f97\u5230\u7684\u662f\u4e0b\u4e00\u7ea7\u9875\u8868\u7684 PPN \uff08\u5de6\u79fb 12 \u4f4d\u5f97\u5230\u7269\u7406\u9875\u5e27\u5730\u5740\uff09\uff0c\u7136\u540e\u56de\u5230\u7b2c\u4e8c\u6b65\uff0c\u7528 <code>VPN[i-1]</code> \u6765\u8bbf\u95ee\u9875\u8868\u9879\u3002\u5426\u5219\u5f53\u524d\u4e3a\u6700\u540e\u4e00\u7ea7\u9875\u8868\uff0cPPN \u5f97\u5230\u7684\u662f\u6700\u7ec8\u7269\u7406\u9875\u7684\u5730\u5740\u3002</li> <li>\u5c06\u5f97\u5230\u6700\u7ec8\u7684\u7269\u7406\u9875\u5e27\u5730\u5740\uff0c\u4e0e\u504f\u79fb\u5730\u5740\u76f8\u52a0\uff0c\u5f97\u5230\u6700\u7ec8\u7684\u7269\u7406\u5730\u5740\u3002</li> </ul> <p>SV39 \u5730\u5740\u8f6c\u6362\u7684\u5168\u8fc7\u7a0b\u56fe\u793a\u5982\u4e0b\uff08\u6765\u6e90\u4e8e MIT 6.828 \u8bfe\u7a0b\uff09\uff1a</p> <p></p> <p>\u53ef\u4ee5\u81ea\u884c\u5c1d\u8bd5\u4e00\u904d\u4ee5\u4e0b\u4e24\u4e2a\u8fc7\u7a0b\uff0c\u786e\u4fdd\u81ea\u5df1\u5df2\u7406\u89e3\u3002</p> <ul> <li>\u3010MMU\u7684\u81ea\u52a8\u8f6c\u6362\u3011\uff1a\u6839\u636e\u6839\u9875\u8868\u9996\u5730\u5740\u53ca\u865a\u62df\u5730\u5740\u627e\u5230\u9875\u8868\u9879\u7684\u5730\u5740\uff0c\u6839\u636e\u9875\u8868\u9879\u7684\u503c\u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\u3002\u5373\u5df2\u77e5 satp\uff0cva\uff0c\u6c42\u76f8\u5e94\u7684\u9875\u8868\u9879\u5730\u5740\uff0c\u5e76\u6839\u636e\u9875\u8868\u9879\u7684\u503c\u5f97\u5230\u7269\u7406\u5730\u5740\u3002</li> <li>\u3010\u5b9e\u9a8c\u5185\u5bb9\u3011\uff1a\u6839\u636e\u6839\u9875\u8868\u57fa\u5730\u5740\u4ee5\u53ca\u865a\u62df\u5730\u5740\u627e\u5230\u76f8\u5e94\u9875\u8868\u9879\u7684\u5730\u5740\uff0c\u6839\u636e\u7269\u7406\u5730\u5740\u53ca\u6620\u5c04\u7684\u6743\u9650\u8bbe\u7f6e\u9875\u8868\u9879\u5177\u4f53\u7684\u503c\u3002\u5373\u5df2\u77e5 satp\uff0cva\uff0cpa, \u6c42\u76f8\u5e94\u7684\u9875\u8868\u9879\u5730\u5740\uff0c\u5e76\u6839\u636e\u7269\u7406\u5730\u5740\u8bbe\u7f6e\u9875\u8868\u9879\u5177\u4f53\u7684\u503c\u3002</li> </ul> <p>\u591a\u7ea7\u9875\u8868\uff1a</p> <p>\u4e3a\u4ec0\u4e48\u6211\u4eec\u8981\u628a\u9875\u8868\u5206\u4e3a\u4e09\u7ea7\u7136\u540e\u4f7f\u7528\u6811\u7684\u683c\u5f0f\u6765\u7ec4\u7ec7\u9875\u8868\uff0c\u800c\u4e0d\u662f\u76f4\u63a5\u4f7f\u7528\u7ebf\u6027\u8868\u5462\uff1f\u5982\u679c\u6211\u4eec\u4f7f\u7528\u7ebf\u6027\u8868\uff0c\u90a3\u4e48\u6211\u4eec\u53ef\u4ee5\u628a\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\u76f4\u63a5\u4fdd\u5b58\u5728 Virtual_Addr + Offset \u7684\u5185\u5b58\u4e2d\u3002\u4f46\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5982\u679c\u6211\u4eec\u60f3\u8868\u793a\u540c\u6837\u5927\u5c0f\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5c31\u9700\u8981\u9884\u7559\u51fa 512512512*8 Byte \u7684\u7a7a\u95f4\u6765\u4fdd\u5b58\u9875\u8868\uff0c\u8fd9\u662f 1GB\uff01\u53ef\u4ee5\u7c7b\u6bd4\u5728C++\u4e2d\u63d0\u524d\u58f0\u660e\u4e00\u4e2a\u8d85\u5927\u7684\u6570\u7ec4\uff0c\u867d\u7136\u8bfb\u5199\u7684\u65f6\u95f4\u5f00\u9500\u90fd\u662f O(1)\uff0c\u4f46\u662f\u7a7a\u95f4\u5f00\u9500\u6781\u5927\u3002\u6709\u540c\u5b66\u53ef\u80fd\u4f1a\u60f3\uff0c\u90a3\u4e3a\u4ec0\u4e48\u4e0d\u7528 vector \u7684\u7b56\u7565\u5462\uff1f\u56e0\u4e3a\u8fd9\u6837\u4f1a\u4e25\u91cd\u5f71\u54cd\u865a\u62df\u5730\u5740\u8f6c\u6362\u7684\u6548\u7387\uff08\u6bcf\u6b21\u8f6c\u6362\u9700\u8981 O(n) \u7684\u67e5\u627e\u65f6\u95f4\uff09\uff0c\u4e0e\u6211\u4eec\u201c\u9ad8\u6548\u201d\u7684\u521d\u8877\u76f8\u6096\u3002\u6240\u4ee5\u6211\u4eec\u4f7f\u7528\u6811\u5f62\u7684\u591a\u7ea7\u9875\u8868\uff0c\u5373\u6ee1\u8db3\u4e86\u6309\u9700\u5206\u914d\uff0c\u53c8\u5f97\u5230\u4e86\u201c\u4e0d\u5dee\u201d\u7684\u8bfb\u5199\u6548\u7387\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#333","title":"3.3.3 \u672c\u5b9e\u9a8c\u4e2d\u7684\u865a\u62df\u5185\u5b58\u5e03\u5c40","text":"<p>\u5728\u672c\u5b9e\u9a8c\u4e2d\uff0c\u5927\u5bb6\u9700\u8981\u5efa\u7acb\u5982\u4e0b\u5185\u5bb9\u7684\u9875\u8868\uff08\u5177\u4f53\u7684\u4ee3\u7801\u6307\u5bfc\u5728\u540e\u6587\uff0c\u8fd9\u91cc\u53ea\u662f\u7ed9\u51fa\u8bf4\u660e\uff09\uff1a</p> <ol> <li> <p>\u5728\u5f00\u542f\u9875\u8868\u540e\uff0c\u8fdb\u5165\u7528\u6237\u8fdb\u7a0b\u4e4b\u524d\uff0c\u4f7f\u7528\u4e00\u4efd\u4e34\u65f6\u9875\u8868\uff0c\u7528\u4e8e\u652f\u6301\u5185\u6838\u5b8c\u6210\u521d\u59cb\u5316\uff1a</p> </li> <li> <p>\u5c06 <code>0xffffffc000000000</code> \u5f00\u59cb\u7684 16 MB \u865a\u62df\u5730\u5740\u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a <code>0x80000000</code> \u7684 16MB \u7269\u7406\u5730\u5740\u7a7a\u95f4\uff0c\u7528\u4e8e\u652f\u6301\u5185\u6838\u5728\u865a\u62df\u7a7a\u95f4\u4e0b\u8fd0\u884c\uff1b</p> </li> <li>\u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 <code>0x80000000</code> \u7684 16MB \u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 <code>0x80000000</code> \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a <code>0x80000000</code> \u7684 16MB \u7a7a\u95f4\uff09\uff0c\u7528\u4e8e\u652f\u6301\u5185\u6838\u5bf9\u7269\u7406\u5730\u5740\u8fdb\u884c\u8bfb\u5199\uff08\u4e3b\u8981\u7528\u4e8e\u8bbf\u95ee\u9875\u8868\uff09\u3002\u540c\u65f6\u8fd9\u4e00\u90e8\u5206\u6620\u5c04\u8fd8\u652f\u6301\u4e86\u5728\u5f00\u542f\u9875\u8868\u540e\uff0c\u8fdb\u5165<code>0xffffffc000000000</code> \u5f00\u59cb\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u524d\u6307\u4ee4\u7684\u6b63\u5e38\u8fd0\u884c\uff0c\u8bf7\u540c\u5b66\u4eec\u601d\u8003\uff1a\u8fd9\u662f\u6307\u54ea\u4e00\u90e8\u5206\u6307\u4ee4\uff1f\u5982\u679c\u6ca1\u6709\u5efa\u7acb\u7b49\u503c\u6620\u5c04\uff0c\u6267\u884c\u8fd9\u4e9b\u6307\u4ee4\u65f6\u4f1a\u53d1\u751f\u4ec0\u4e48\uff1f</li> <li> <p>\u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\u8fdb\u884c\u6620\u5c04\u3002</p> </li> <li> <p>\u5728\u8fdb\u7a0b\u521d\u59cb\u5316\u65f6\uff0c\u4e3a\u8fdb\u7a0b\u521b\u5efa\u9875\u8868\uff0c\u7136\u540e\u5728\u8fdb\u5165\u7528\u6237\u8fdb\u7a0b\u65f6\u5207\u6362\u5230\u7528\u6237\u9875\u8868\uff0c\u4ee5\u540e\u5c31\u5728\u4e0d\u540c\u7684\u7528\u6237\u8fdb\u7a0b\u9875\u8868\u4e4b\u95f4\u5207\u6362\uff1a</p> </li> <li> <p>\u5c06 <code>0x1001000</code> \u5f00\u59cb\u7684 <code>4KB</code> \u6620\u5c04\u5230\u5b9e\u9645\u7684\u7528\u6237\u6808\u7269\u7406\u5730\u5740\uff08\u7528\u6237\u6808\u7684\u5b9a\u4e49\u4e0e\u5206\u914d\u89c1\u4e0b\u6587\uff09\u3002</p> </li> <li>\u5c06 <code>0x1000000</code> \u5f00\u59cb\u7684 <code>4KB</code> \u6620\u5c04\u5230\u5b9e\u9645\u7684\u7528\u6237\u5e94\u7528\u7a0b\u5e8f\u7269\u7406\u5730\u5740\u3002</li> <li>\u521b\u5efa 1. \u4e2d\u7684\u5185\u6838\u6620\u5c04\u3002</li> </ol> <p>\u5185\u6838\u4e0e\u5e94\u7528\u5730\u5740\u7a7a\u95f4\u7684\u9694\u79bb</p> <p>\u76ee\u524d\u6211\u4eec\u7684\u8bbe\u8ba1\u601d\u8def A \u662f\uff1a\u8ba9\u6bcf\u4e2a\u5e94\u7528\u90fd\u6709\u4e00\u4e2a\u5305\u542b\u5e94\u7528\u548c\u5185\u6838\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u5e76\u5c06\u5176\u4e2d\u7684\u903b\u8f91\u6bb5\u5206\u4e3a\u5185\u6838\u548c\u7528\u6237\u4e24\u90e8\u5206\uff0c\u5206\u522b\u6620\u5c04\u5230\u5185\u6838/\u7528\u6237\u7684\u6570\u636e\u548c\u4ee3\u7801\uff0c\u4e14\u5206\u522b\u5728 CPU \u5904\u4e8e S/U \u7279\u6743\u7ea7\u65f6\u8bbf\u95ee\u3002\u6b64\u8bbe\u8ba1\u4e2d\u5e76\u4e0d\u5b58\u5728\u4e00\u4e2a\u5355\u72ec\u7684\u5185\u6838\u5730\u5740\u7a7a\u95f4\u3002</p> <p>\u53e6\u5916\u7684\u4e00\u79cd\u8bbe\u8ba1\u601d\u8def B \u662f\uff1a\u5bf9\u5185\u6838\u5efa\u7acb\u552f\u4e00\u7684\u5185\u6838\u5730\u5740\u7a7a\u95f4\u5b58\u653e\u5185\u6838\u7684\u4ee3\u7801\u3001\u6570\u636e\uff0c\u540c\u65f6\u5bf9\u4e8e\u6bcf\u4e2a\u5e94\u7528\u7ef4\u62a4\u4e00\u4e2a\u5b83\u4eec\u81ea\u5df1\u7684\u7528\u6237\u5730\u5740\u7a7a\u95f4\uff0c\u56e0\u6b64\u5728 Trap \u7684\u65f6\u5019\u5c31\u9700\u8981\u8fdb\u884c\u5730\u5740\u7a7a\u95f4\u5207\u6362\uff08\u56e0\u4e3a\u63a7\u5236\u6d41\u4ece\u7528\u6237\u8fdb\u7a0b\u5230\u4e86\u5185\u6838\uff09\uff0c\u800c\u5728\u4efb\u52a1\u5207\u6362\u7684\u65f6\u5019\u65e0\u9700\u8fdb\u884c\uff08\u56e0\u4e3a\u8fd9\u4e2a\u8fc7\u7a0b\u5168\u7a0b\u5728\u5185\u6838\u5185\u5b8c\u6210\uff09\u3002</p> <p>\u8bbe\u8ba1\u65b9\u5f0f A \u7684\u4f18\u70b9\u5728\u4e8e\uff1a Trap \u7684\u65f6\u5019\u65e0\u9700\u5207\u6362\u5730\u5740\u7a7a\u95f4\uff0c\u800c\u5728\u4efb\u52a1\u5207\u6362\u7684\u65f6\u5019\u624d\u9700\u8981\u5207\u6362\u5730\u5740\u7a7a\u95f4\u3002\u76f8\u5bf9\u800c\u8a00\uff0c\u8bbe\u8ba1\u65b9\u5f0fA\u6bd4\u8bbe\u8ba1\u65b9\u5f0fB\u66f4\u5bb9\u6613\u5b9e\u73b0\uff0c\u5728\u5e94\u7528\u9ad8\u9891\u8fdb\u884c\u7cfb\u7edf\u8c03\u7528\u7684\u65f6\u5019\uff0c\u91c7\u7528\u8bbe\u8ba1\u65b9\u5f0fA\u80fd\u591f\u907f\u514d\u9891\u7e41\u5730\u5740\u7a7a\u95f4\u5207\u6362\u7684\u5f00\u9500\uff0c\u8fd9\u901a\u5e38\u6e90\u4e8e\u5feb\u8868\u6216 cache \u7684\u5931\u6548\u95ee\u9898\u3002</p> <p>\u4f46\u662f\u8bbe\u8ba1\u65b9\u5f0fA\u4e5f\u6709\u7f3a\u70b9\uff1a\u5373\u5185\u6838\u7684\u903b\u8f91\u6bb5\u9700\u8981\u5728\u6bcf\u4e2a\u5e94\u7528\u7684\u5730\u5740\u7a7a\u95f4\u5185\u90fd\u6620\u5c04\u4e00\u6b21\uff0c\u8fd9\u4f1a\u5e26\u6765\u4e00\u4e9b\u65e0\u6cd5\u5ffd\u7565\u7684\u5185\u5b58\u5360\u7528\u5f00\u9500\uff0c\u5e76\u663e\u8457\u9650\u5236\u4e86\u5d4c\u5165\u5f0f\u5e73\u53f0\uff08\u5982 K210 \uff09\u7684\u4efb\u52a1\u5e76\u53d1\u6570\u3002\u6b64\u5916\uff0c\u8bbe\u8ba1\u65b9\u5f0f A \u65e0\u6cd5\u9632\u5fa1\u9488\u5bf9\u5904\u7406\u5668\u7535\u8def\u8bbe\u8ba1\u7f3a\u9677\u7684\u4fa7\u4fe1\u9053\u653b\u51fb\uff08\u5982 \u7194\u65ad (Meltdown) \u6f0f\u6d1e \uff09\uff0c\u4f7f\u5f97\u6076\u610f\u5e94\u7528\u80fd\u591f\u4ee5\u67d0\u79cd\u65b9\u5f0f\u95f4\u63a5\u201c\u770b\u5230\u201d\u5185\u6838\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u6570\u636e\uff0c\u4f7f\u5f97\u7528\u6237\u9690\u79c1\u6570\u636e\u6709\u53ef\u80fd\u88ab\u6cc4\u9732\u3002\u5c06\u5185\u6838\u4e0e\u5730\u5740\u7a7a\u95f4\u9694\u79bb\u4fbf\u662f\u4fee\u590d\u6b64\u6f0f\u6d1e\u7684\u4e00\u79cd\u65b9\u6cd5\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#34-m","title":"3.4 M\u6001\u5904\u7406\u7a0b\u5e8f","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#341","title":"3.4.1 \u5f02\u5e38\u4e2d\u65ad\u59d4\u6258\u673a\u5236","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u4efb\u4f55\u7279\u6743\u7ea7\u522b\u7684\u6240\u6709 Trap \u90fd\u4f1a\u5728\u673a\u5668\u6a21\u5f0f\u4e0b\u5904\u7406\uff0c\u5f53\u7136\u673a\u5668\u6a21\u5f0f\u5904\u7406\u7a0b\u5e8f\u53ef\u4ee5\u4f7f\u7528 MRET \u6307\u4ee4\u5c06\u9677\u5165\u91cd\u5b9a\u5411\u56de\u9002\u5f53\u7684\u6a21\u5f0f\u7ea7\u522b\u3002\u4f46\u662f\u4e3a\u4e86\u63d0\u9ad8\u6027\u80fd\uff0cRISC-V \u63d0\u4f9b\u4e86\u4e00\u79cd\u786c\u4ef6\u673a\u5236\uff0c\u90a3\u5c31\u662f\u5f02\u5e38\u4e2d\u65ad\u59d4\u6258\u673a\u5236\u3002\u6709\u4e86\u8fd9\u4e2a\u673a\u5236\u540e\uff0c\u5c31\u4e0d\u518d\u9700\u8981\u8f6f\u4ef6\u7a0b\u5e8f\u4e0a\u4f7f\u7528 MRET \u6307\u4ee4\u5c06 Trap \u91cd\u5b9a\u5411\u56de\u60f3\u8981\u7684\u6a21\u5f0f\u7ea7\u522b\u3002\u8bf7\u540c\u5b66\u4eec\u4ed4\u7ec6\u9605\u8bfb riscv \u7279\u6743\u624b\u518c 3.1.8 \u8282 \u548c riscv \u4e2d\u6587\u624b\u518c 10.5 \u8282\uff0c\u4e86\u89e3 riscv \u7684\u5f02\u5e38\u4e2d\u65ad\u59d4\u6258\u673a\u5236\u3002</p> <p>\u4e0b\u9762\u6211\u4eec\u5c06\u4ee5\u65f6\u949f\u4e2d\u65ad\u5904\u7406\u4e3a\u4f8b\uff0c\u7ed3\u5408 M \u6001\u7684\u4ee3\u7801\u6765\u8fdb\u4e00\u6b65\u7406\u89e3\u4e00\u4e0b\u8fd9\u4e2a\u8fc7\u7a0b\u3002\u5728 lab1 \u7684\u9644\u5f55 B\uff1aS \u6a21\u5f0f\u4e0b\u7684\u5f02\u5e38\u4e2d\uff0c\u6211\u4eec\u4ecb\u7ecd\u4e86 S \u6a21\u5f0f\u4e0b\u65f6\u949f\u4e2d\u65ad\u7684\u5904\u7406\u6d41\u7a0b\uff0c\u63a8\u8350\u540c\u5b66\u4eec\u5728\u7406\u89e3\u4e86\u4e0b\u6587\u7684\u5185\u5bb9\u540e\uff0c\u518d\u56de\u8fc7\u5934\u53bb\u770b\u4e00\u4e0b lab1 \u7684\u9644\u5f55\u5185\u5bb9\u3002</p> <p>\u7cfb\u7edf\u542f\u52a8\u540e\uff0cqemu \u4f1a\u8df3\u8f6c\u5230 <code>head.S: _start</code> \u5904\u5f00\u59cb\u6267\u884c\uff0c\u6b64\u65f6\u7cfb\u7edf\u5904\u4e8e M \u6001\uff0c\u6211\u4eec\u9700\u8981\u5bf9 M \u6001\u7684 CSR \u5bc4\u5b58\u5668\u505a\u521d\u59cb\u5316\u3002\u5728 <code>head.S:line 40-41</code> \u5904\uff0c\u6211\u4eec\u8bbe\u7f6e mideleg \u7684\u7b2c 5 \u4f4d\uff08\u4ece0\u5f00\u59cb\uff09\u4e3a 1\uff0c\u8868\u793a\u5c06\u7f16\u7801\u4e3a 5 \u7684\u4e2d\u65ad\uff08interruption\uff09\u59d4\u6258\u7ed9 S \u6001\u6267\u884c\u3002\u5f53 mtime \u5927\u4e8e mtimecmp \u65f6\uff0c\u65f6\u949f\u4e2d\u65ad\u53d1\u751f\uff0c\u7531\u4e8e mtime \u4e0emtimecmp \u662f M \u6001\u7684\u5bc4\u5b58\u5668\uff0c\u6240\u4ee5\u89e6\u53d1\u7684\u662f\u7f16\u7801\u4e3a 7 \u7684 M \u6001\u65f6\u949f\u4e2d\u65ad\u3002\u800c\u6211\u4eec\u5e76\u6ca1\u6709\u5c06 M \u6001\u65f6\u949f\u4e2d\u65ad\u59d4\u6258\u7ed9 S\u6001\uff0c\u6240\u4ee5\u6211\u4eec\u4f1a\u8fdb\u5165M\u6001\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\uff08<code>head.S: _mtrap</code>\uff09\u3002</p> <p>\u5728M\u6001\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u4e2d\uff0c\u6211\u4eec\u9996\u5148\u5b8c\u6210\u201c\u73b0\u573a\u4fdd\u5b58\u201d\uff0c\u7136\u540e\u8fdb\u5165\u7528\u6c47\u7f16\u4ee3\u7801\u5199\u7684\u4e2d\u65ad\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\uff0c\u5982\u679c\u662f\u65f6\u949f\u4e2d\u65ad\uff08\u6ce8\u610f\u6b64\u5904\u662f\u5224\u65ad\u4e2d\u65ad\u7f16\u7801\u662f\u5426\u4e3a 7 \uff0c\u5373 M \u6001\u65f6\u949f\u4e2d\u65ad\uff09\uff0c\u5219\u8bbe\u7f6e <code>mip.stip = 1</code>\uff0c\u8fd9\u6837\uff0c\u6211\u4eec\u5728\u6267\u884c <code>mret</code>\u540e\uff0c\u786c\u4ef6\u5c31\u4f1a\u968f\u5373\u89e6\u53d1 S \u6001\u65f6\u949f\u4e2d\u65ad\uff0c\u8fdb\u800c\u89e6\u53d1\u59d4\u6258\u673a\u5236\uff0c\u8fdb\u5165 S \u6001\u5904\u7406\u3002</p> <pre><code>_mtrap:\n    # \u4ea4\u6362 mscratch \u548c sp\n    # \u76f8\u5f53\u4e8e\u4f7f\u7528 M \u6a21\u5f0f\u7684\u6808\u6307\u9488\n    csrrw sp, mscratch, sp\n\n    # \u4fdd\u5b58\u5bc4\u5b58\u5668\n    ...\n\n    # \u68c0\u67e5 mcause\uff0c\u7528\u6700\u9ad8\u4f4d\u5224\u65ad\u662f\u4e2d\u65ad\u8fd8\u662f\u5f02\u5e38\n    csrr t0, mcause\n    srai t2, t0, 63\n    bnez t2, is_int\n\n    # \u5224\u65ad\u662f\u4e0d\u662f S \u6a21\u5f0f\u4e3b\u52a8\u53d1\u51fa\u7684\u5f02\u5e38\n    li t1, 9\n    beq t0, t1, encall_from_s\n    j other_trap\n\n    # \u5224\u65ad\u662f\u4e0d\u662f machine timer interrupt\n    # \u662f --&gt; \u8df3\u8f6c\u5230 time_interupt\n    # \u5426 --&gt; \u8df3\u8f6c\u5230 other_trap\nis_int:\n    andi t0, t0, 0x7ff\n    li t1, 7\n    beq t0, t1, time_interupt\n    j other_trap\n\ntime_interupt:\n    # \u7981\u7528\u65f6\u949f\u4e2d\u65ad\n    li t1, 0x80\n    csrc mie, t1\n\n    # \u8bbe\u7f6e stip \u4e3a 1\uff0c\u8fd9\u6837\u624d\u80fd\u8fdb\u5165 S \u6a21\u5f0f\u7684\u65f6\u949f\u4e2d\u65ad\u5904\u7406\n    li t1, 0x20\n    csrs mip, t1\n\n    # \u6062\u590d\u5bc4\u5b58\u5668 mepc \u548c mstatus\n    ld t0, 248(sp)\n    ld t1, 256(sp)\n    csrw mstatus, t0\n    csrw mepc, t1\n    j exit\n\nencall_from_s:\n    ...\n    j exit\n\n\n# \u6211\u4eec\u5bf9\u5176\u4ed6\u5f02\u5e38\u4e0d\u505a\u4efb\u4f55\u5904\u7406\nother_trap:\n    ...\n\nexit:\n    #\u6062\u590d\u5bc4\u5b58\u5668\n    ...\n\n    # \u4ea4\u6362 mscratch \u548c sp\n    # \u76f8\u5f53\u4e8e\u6062\u590d\u5230\u5f02\u5e38\u524d\u7684 sp\n    csrrw sp,mscratch,sp\n    mret\n</code></pre> <p>\u5b9e\u9645\u4e0a\uff0criscv \u6807\u51c6\u4e0d\u5efa\u8bae\u628a M \u6001\u65f6\u949f\u4e2d\u65ad\u59d4\u6258\u7ed9 S \u6001\u5904\u7406\u3002\u56e0\u6b64\u89e6\u53d1\u65f6\u949f\u4e2d\u65ad\u540e\uff0c\u5148\u8fdb\u5165 M \u6001\uff0c\u518d\u8fdb\u5165 S \u6001\uff0c\u8fd9\u4e2a\u770b\u4f3c\u7b80\u5355\u7ed5\u4e86\u4e00\u5708\u7684\u5b9e\u73b0\u65b9\u5f0f\u662f\u7b26\u5408 riscv \u6807\u51c6\u7684\u3002</p> <p>\u201cBits 3, 7, and 11 of sip and sie correspond to the machine-mode software, timer, and external interrupts, respectively. Since most platforms will choose not to make these interrupts delegatable from M-mode to S-mode, they are shown as 0 in Figures 1.6 and 1.7.*\u201d</p> <p>\u2014\u2014 The RISC-V Instruction Set Manual, Volume II: Privileged Architecture</p> <p>\u5728\u6709\u4e9b riscv \u7248\u672c\u4e2d\uff0c\u4f1a\u5b58\u5728 mtimecmp \u5728\u5176\u4ed6\u7279\u6743\u7ea7\u4e0b\u7684\u7248\u672c\uff0c\u5982 stimecmp\uff0c\u56e0\u6b64\u53ef\u4ee5\u76f4\u63a5\u89e6\u53d1 S \u6001\u65f6\u949f\u4e2d\u65ad\u3002\u5728\u6211\u4eec\u4f7f\u7528\u7684 riscv \u7248\u672c\u4e2d\u4e0d\u5b58\u5728 stimecmp\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#35","title":"3.5 \u6808\u5207\u6362\u4e0e\u9875\u8868\u5207\u6362","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#351-m","title":"3.5.1 M\u6001\u6808\u5207\u6362","text":"<p>\u5728 lab2 \u4e2d\u6211\u4eec\u63d0\u5230\u8fc7\uff0c\u5c3d\u7ba1\u6211\u4eec\u5728 lab2 \u5df2\u7ecf\u5b9e\u73b0\u4e86 U \u6001\u548c S \u6001\uff0c\u4f46\u662f\u6211\u4eec\u5e76\u6ca1\u6709\u5c06\u5185\u6838\u6808\u548c\u7528\u6237\u6808\u8fdb\u884c\u5206\u79bb\uff08sp\u5bc4\u5b58\u5668\u59cb\u7ec8\u6307\u5411\u540c\u4e00\u4e2a\u6808\uff09\uff0c\u7528\u6237\u8fdb\u7a0b\u5b8c\u5168\u53ef\u4ee5\u8bbf\u95ee\u5230\u5185\u6838\u6808\u7684\u4fe1\u606f\u3002</p> <pre><code>lab2\u4e2d\u5404\u4e2a\u7528\u6237\u8fdb\u7a0b\u7684\u6808\u5206\u5e03\uff1a\n\n---------------------------------------------------------------------------\n|             |   Task0   |   Task1   |   Task2   |   Task3   |   Task4   |\n|   Kernel    |           |           |           |           |           |\n|             |   Space   |   Space   |   Space   |   Space   |   Space   |\n---------------------------------------------------------------------------\n^             ^           ^           ^           ^           ^\n0x80200000    0x80210000  0x80211000  0x80212000  0x80213000  0x80214000\n</code></pre> <p>\u73b0\u5728\u6211\u4eec\u8981\u5b9e\u73b0\u865a\u62df\u5730\u5740\uff0c\u865a\u62df\u5730\u5740\u4e3a\u4e0d\u540c\u5e94\u7528\u63d0\u4f9b\u4e86\u826f\u597d\u7684\u9694\u79bb\uff0c\u5373\u5185\u6838\u548c\u7528\u6237\u8fdb\u7a0b\u4e0d\u518d\u80fd\u591f\u8bbf\u95ee\u5f7c\u6b64\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u56e0\u6b64\u6211\u4eec\u5fc5\u987b\u4e3a\u5185\u6838\u4e0e\u7528\u6237\u8fdb\u7a0b\u5206\u914d\u4e0d\u540c\u7684\u6808\u3002\u73b0\u5728\u6211\u4eec\u6765\u5173\u6ce8\u4e00\u4e0b\u5982\u679c\u4f7f\u7528\u4e86\u4e0d\u540c\u7684\u6808\uff0c\u5982\u4f55\u5728\u5207\u6362\u5730\u5740\u7a7a\u95f4\u65f6\u8fdb\u884c\u6362\u6808\u3002\u6211\u4eec\u4ee5\u53d1\u751f\u65f6\u949f\u4e2d\u65ad\uff0c\u4ece U \u6001\u8fdb\u5165 M \u6001\u65f6\u7684\u6362\u6808\u6d41\u7a0b\u4e3a\u4f8b\uff1a</p> <p>\u9996\u5148\u6211\u4eec\u8981\u7406\u89e3\u4e3a\u4ec0\u4e48\u9700\u8981\u6808\u5207\u6362\uff1a</p> <p>\u5047\u8bbe\u6211\u4eec\u5df2\u7ecf\u5b9e\u73b0\u4e86\u865a\u62df\u5730\u5740\uff0c\u73b0\u5728\u5728 U \u6001\u6267\u884c\u7528\u6237\u7a0b\u5e8f\uff0csp \u5bc4\u5b58\u5668\u6307\u5411\u7528\u6237\u6808\uff0c\u6b64\u65f6\u53d1\u751f\u4e86\u65f6\u949f\u4e2d\u65ad\uff0c\u6211\u4eec\u9700\u8981\u8fdb\u5165 M \u6001\u4e2d\u65ad\u5f02\u5e38\u5904\u7406\u7a0b\u5e8f\u3002\u6b64\u65f6\u7684\u9875\u8868\u662f\u7528\u6237\u7a0b\u5e8f\u7684\u9875\u8868\uff08\u5373 satp \u5bc4\u5b58\u5668\u6307\u5411\u8be5\u7528\u6237\u8fdb\u7a0b\u7684\u6839\u9875\u8868\uff09\uff0c\u800c M \u6001\u6839\u672c\u4e0d\u8003\u8651\u865a\u62df\u5730\u5740\uff0c\u53ea\u4f7f\u7528\u7269\u7406\u5730\u5740\uff0c\u56e0\u6b64\u5730\u5740\u7a7a\u95f4\u53d1\u751f\u4e86\u53d8\u6362\uff0c\u5bfc\u81f4\u6211\u4eec\u7684\u7a0b\u5e8f\u65e0\u6cd5\u518d\u901a\u8fc7 sp \u5bc4\u5b58\u5668\u8bbf\u95ee\u5230\u521a\u521a\u7684\u7528\u6237\u6808\uff08\u56e0\u4e3a\u6b64\u65f6sp\u6307\u5411\u7528\u6237\u5730\u5740\u7a7a\u95f4\u7684\u67d0\u4e2a\u5730\u5740\uff0c\u800c\u8fd9\u4e2a\u5730\u5740\u5728\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740\u7a7a\u95f4\u5927\u6982\u7387\u662f\u4e0d\u5b58\u5728\u7684\uff0c\u5373\u4f7f\u53ef\u4ee5\u8bbf\u95ee\u4e5f\u6ca1\u6709\u610f\u4e49\uff09\u3002\u56e0\u6b64\u6211\u4eec\u5fc5\u987b\u6362\u6808\uff0c\u5373\u5c06 sp \u8bbe\u7f6e\u4e3a\u5728\u5f53\u524d\u5730\u5740\u7a7a\u95f4\u5185\u6709\u610f\u4e49\u7684\u5730\u5740\u3002</p> <p>\u6ce8\u610f\uff01\u4e0a\u8ff0\u539f\u56e0\u53ea\u662f\u63cf\u8ff0\u4e86\u9700\u8981\u6362\u6808\u7684\u5fc5\u8981\u6027\uff0c\u4f46\u5728 os \u7684\u8bbe\u8ba1\u7406\u5ff5\u91cc\uff0c\u4e0d\u662f\u56e0\u4e3a\u6709\u4e86\u865a\u62df\u5730\u5740\u624d\u9700\u8981\u6362\u6808\uff0c\u6070\u6070\u76f8\u53cd\uff0c\u6b63\u662f\u56e0\u4e3a\u6362\u6808\u4e0d\u8db3\u4ee5\u4fdd\u8bc1\u5b89\u5168\u6027\uff0c\u624d\u51fa\u73b0\u4e86\u865a\u62df\u5730\u5740\u6280\u672f\u3002\u6808\u5206\u79bb\u548c\u865a\u62df\u5730\u5740\u6280\u672f\u90fd\u662f\u4e3a\u4e86\u4fdd\u8bc1\u7cfb\u7edf\u7684\u5b89\u5168\u800c\u5b58\u5728\u7684\uff0c\u5e0c\u671b\u540c\u5b66\u4eec\u7406\u89e3\u8fd9\u4e2a\u903b\u8f91\u3002</p> <p>\u6808\u5207\u6362\u7528\u5230\u4e86\u4e24\u4e2a\u91cd\u8981\u7684 csr \u5bc4\u5b58\u5668\uff0c<code>mscratch/sscratch</code>\uff0c\u8fd9\u4e24\u4e2a\u5bc4\u5b58\u5668\u6ca1\u6709\u660e\u786e\u7684\u4f5c\u7528\uff0c\u800c\u662f\u4f5c\u4e3a\u4e2d\u8f6c\u5bc4\u5b58\u5668\u51fa\u73b0\u7684\u3002\u5728\u65f6\u949f\u4e2d\u65ad\u53d1\u751f\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5c06 Trap \u4e0a\u4e0b\u6587\u4fdd\u5b58\u5728 M \u6001\u7684\u6808\u4e0a\uff0c\u56e0\u6b64\u9700\u8981\u4e00\u4e2a\u5bc4\u5b58\u5668\u6682\u5b58 M \u6001\u6808\u5730\u5740\uff0c\u5e76\u4ee5\u5b83\u4f5c\u4e3a\u57fa\u5730\u5740\u6307\u9488\u6765\u4f9d\u6b21\u4fdd\u5b58 Trap \u4e0a\u4e0b\u6587\u7684\u5185\u5bb9\u3002\u4f46\u662f\u6240\u6709\u7684\u901a\u7528\u5bc4\u5b58\u5668\u90fd\u4e0d\u80fd\u591f\u7528\u4f5c\u57fa\u5730\u5740\u6307\u9488\uff0c\u56e0\u4e3a\u5b83\u4eec\u90fd\u9700\u8981\u88ab\u4fdd\u5b58\uff0c\u5982\u679c\u8986\u76d6\u6389\u5b83\u4eec\uff0c\u5c31\u4f1a\u5f71\u54cd\u540e\u7eed\u5e94\u7528\u63a7\u5236\u6d41\u7684\u6267\u884c\u3002\u4e8b\u5b9e\u4e0a\u6211\u4eec\u7f3a\u5c11\u4e86\u4e00\u4e2a\u91cd\u8981\u7684\u4e2d\u8f6c\u5bc4\u5b58\u5668\uff0c\u800c <code>mscratch/sscratch</code> CSR \u6b63\u662f\u4e3a\u6b64\u800c\u751f\u3002</p> <p>\u5728\u8fdb\u5165 <code>_start</code> \u540e\uff0c\u6211\u4eec\u5c06 stack_top \u4fdd\u5b58\u5728 mscratch \u4e2d\u3002</p> <pre><code>// head.S\n35  # \u7528 mscratch \u5b58\u50a8 M \u6a21\u5f0f\u4e0b\u7684\u6808\u6307\u9488\n36  la t1, stack_top\n37  csrw mscratch, t1\n</code></pre> <p>\u5173\u4e8estack_top\u7684\u5730\u5740\uff1a</p> <p>\u6709\u540c\u5b66\u53ef\u80fd\u4f1a\u5947\u602a\uff0c\u660e\u660e\u6211\u4eec\u5728 <code>vmlinux.lds</code> \u4e2d\u5b9a\u4e49\u57fa\u5730\u5740\u662f <code>Line 14: . = 0xffffffc000000000</code>\uff0c\u8fd9\u8bf4\u660e\u5728\u7f16\u8bd1\u8fc7\u7a0b\u4e2d\uff0c\u6240\u6709\u7684\u5730\u5740\u90fd\u5e94\u8be5\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u4e3a\u4ec0\u4e48\u5728\u8fd9\u91cc\u8bbf\u95ee <code>stack_top</code> \u5f97\u5230\u7684\u662f\u7269\u7406\u5730\u5740\u5462\uff1f\uff08\u5982\u679c\u4f60\u6ca1\u6709\u89c9\u5f97\u8fd9\u91cc\u5947\u602a\u7684\u8bdd\uff0c\u90a3\u4f60\u66f4\u5e94\u8be5\u4ed4\u7ec6\u7406\u89e3\u4e00\u4e0b\u8fd9\u6bb5\u5185\u5bb9\uff09</p> <p>\u8fd9\u662f\u56e0\u4e3a\u5728\u7f16\u8bd1\u5668\u5bf9\u4ee3\u7801\u8fdb\u884c\u7f16\u8bd1\u65f6\uff0c\u91c7\u7528\u4e86\u76f8\u5bf9\u5bfb\u5740\u7684\u5bfb\u5740\u65b9\u5f0f\uff0c\u5373\u6839\u636e\u5f53\u524d\u7684 pc \u503c\u52a0\u4e0a\u4e00\u4e2a\u504f\u79fb\u91cf\u8ba1\u7b97\u6bcf\u4e2a\u5730\u5740\u7684\u5b9e\u9645\u4f4d\u7f6e\u3002\u901a\u8fc7\u6307\u4ee4 <code>riscv64-unknown-linux-gnu-objdump -d head.o</code> \u5bf9 <code>head.o</code> \u53cd\u6c47\u7f16\u53ef\u4ee5\u770b\u51fa\uff0c\u8ba1\u7b97 <code>stack_top</code> \u7684\u5730\u5740\u65f6\uff0c\u5b9e\u9645\u4f7f\u7528\u7684\u6307\u4ee4\u662f</p> <p>20: 00000317 auipc t1,0x0</p> <p>24: 00030313 mv t1,t1</p> <p>28: 34031073 csrw mscratch,t1</p> <p>\u7531\u4e8e\u5bf9\u4e8e<code>head.o</code>\u5355\u4e2a\u6587\u4ef6\u6765\u8bf4\uff0c\u6b64\u65f6\u8fd8\u6ca1\u6709\u8fdb\u884c\u94fe\u63a5\uff0c\u6240\u4ee5\u7f16\u8bd1\u5668\u4e5f\u65e0\u6cd5\u786e\u5b9a\u9700\u8981\u504f\u79fb\u591a\u5c11\u624d\u80fd\u5f97\u5230<code>stack_top</code> \u7684\u5730\u5740\uff0c\u6240\u4ee5 <code>auipc</code> \u6307\u4ee4\u7684\u504f\u79fb\u91cf\u4e3a0\uff08\u8fd9\u662f\u7f16\u8bd1\u539f\u7406\u7684\u76f8\u5173\u5185\u5bb9\uff0c\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u81ea\u884c\u4e86\u89e3\uff09\u3002\u4f46\u662f\u6211\u4eec\u53ef\u4ee5\u4ece\u4e0a\u9762\u7684\u53cd\u6c47\u7f16\u7ed3\u679c\u770b\u51fa\uff0c\u7f16\u8bd1\u5668\u786e\u5b9e\u662f\u901a\u8fc7\u76f8\u5bf9\u5bfb\u5740\u5f97\u5230 <code>stack_top</code> \u7684\u5730\u5740\u3002</p> <p>\u90a3\u4e48\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u7b80\u5355\u7684\u68b3\u7406\u4e00\u4e0b\u4e3a\u4ec0\u4e48\u6211\u4eec\u53ef\u4ee5\u5f97\u5230 stack_top \u7684\u7269\u7406\u5730\u5740\u3002\u6ce8\u610f\u6211\u4eec\u5728 lab3 \u4e2d\u6ca1\u6709OpenSBI\uff0c\u6240\u4ee5\u6211\u4eec\u628a\u6574\u4e2aOS\uff08\u5305\u62ec M \u6001\u7ba1\u7406\u7a0b\u5e8f\uff09\u90fd\u653e\u5728\u4e86 <code>0x80000000</code> \u8d77\u59cb\u7684\u7269\u7406\u5730\u5740\u4e0a\u3002\u7f16\u8bd1\u5668\u5728\u7f16\u8bd1\u94fe\u63a5\u65f6\uff0c\u6839\u636evmlinux.lds\uff0c\u57fa\u5730\u5740\u662f<code>0xffffffc000000000</code>\uff0c\u5373\u7b2c\u4e00\u6761\u6307\u4ee4\u7684\u5730\u5740\u662f<code>0xffffffc000000000</code>\uff0c\u56e0\u6b64\u7f16\u8bd1\u5668\u901a\u8fc7\u76f8\u5bf9\u5bfb\u5740\u7684\u65b9\u5f0f\u8ba1\u7b97\u51fa\u4e86\u901a\u8fc7 <code>pc</code> \u5f97\u5230 <code>stack_top</code> \u5730\u5740\u7684\u504f\u79fb\u91cf<code>offset</code>\u3002\u7136\u800c\u5728\u5b9e\u9645\u8fd0\u884c\u65f6\uff0c\u6211\u4eec\u7684\u7b2c\u4e00\u6761\u6307\u4ee4\u5728 <code>0x80000000</code>\uff0c\u56e0\u6b64\u5f53\u5b9e\u9645\u8ba1\u7b97 <code>stack_top</code> \u7684\u5730\u5740\u65f6\uff0c\u6211\u4eec\u901a\u8fc7<code>0x8000xxxx</code>\uff08<code>auipc</code> \u6307\u4ee4\u7684\u5730\u5740\uff09+ <code>offset</code> \u5f97\u5230\u4e86 <code>stack_top</code> \u4ee5 <code>0x80000000</code> \u4e3a\u57fa\u5730\u5740\u7684\u201c\u76f8\u5bf9\u5730\u5740\u201d\uff0c\u800c\u8fd9\u201c\u6070\u597d\u201d\u5c31\u662f <code>stack_top</code> \u7684\u7269\u7406\u5730\u5740\u3002\u4e3a\u4ec0\u4e48\u5bf9\u201c\u6070\u597d\u201d\u52a0\u5f15\u53f7\u5462\uff1f\u90a3\u662f\u56e0\u4e3a\u4f7f\u7528\u76f8\u5bf9\u5bfb\u5740\u7684\u60c5\u51b5\u4e0b\uff0c\u4e0d\u8bba\u6211\u4eec\u628a\u4ee3\u7801\u52a0\u8f7d\u5230\u54ea\u5757\u5730\u5740\u4e0a\uff0c\u90fd\u53ef\u4ee5\u6b63\u786e\u8ba1\u7b97\u51fa\u6bcf\u4e2a\u7b26\u53f7\u7684\u5730\u5740\u3002</p> <p>\u53ea\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5c31\u9700\u8981\u540c\u5b66\u4eec\u6ce8\u610f\uff0c\u5728 pc \u4e0d\u540c\u7684\u60c5\u51b5\u4e0b\uff0c\u6846\u67b6\u4e2d\u7684\u7b26\u53f7\u7684\u503c\u4e5f\u4f1a\u4e0d\u540c\u3002\u6bd4\u5982\uff0c\u5728\u521b\u5efa\u9875\u8868\u5e76\u5f00\u542f\u865a\u62df\u5730\u5740\u4e4b\u524d\uff0c<code>stack_top</code>\u662f\u7269\u7406\u5730\u5740\uff0c\u4f46\u662f\u5728\u5f00\u542f\u865a\u62df\u5730\u5740\u4e4b\u540e\uff08\u66f4\u786e\u5207\u5730\u8bf4\uff0c\u662f\u8fdb\u5165\u4ee5<code>0xffffffc000000000</code> \u4e3a\u57fa\u5730\u5740\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\u540e\uff09\uff0c\u5982\u679c\u5728\u4ee3\u7801\u4e2d\u518d\u6b21\u8bbf\u95ee <code>stack_top</code>\uff0c\u5f97\u5230\u7684\u5c31\u662f\u865a\u62df\u5730\u5740\u4e86\u3002\u5982\u679c\u540c\u5b66\u5728\u5b8c\u6210 lab3 \u7684\u8fc7\u7a0b\u4e2d\u9700\u8981\u7528\u5230\u67d0\u4e9b\u9884\u5b9a\u4e49\u597d\u7684\u7b26\u53f7\uff0c\u4e00\u5b9a\u8981\u6ce8\u610f\u6b64\u65f6\u8bbf\u95ee\u8be5\u7b26\u53f7\u5f97\u5230\u7684\u662f\u7269\u7406\u5730\u5740\u8fd8\u662f\u865a\u62df\u5730\u5740\uff01</p> <p>\u901a\u8fc7 <code>_mtrap</code> \u7684\u4ee3\u7801\u53ef\u4ee5\u770b\u51fa\uff0c\u5728\u8fdb\u5165 M \u6001\u5f02\u5e38\u4e2d\u65ad\u5904\u7406\u7a0b\u5e8f\u540e\uff0c\u6211\u4eec\u9996\u5148\u4ea4\u6362 <code>sp</code> \u548c <code>mscratch</code> \u7684\u503c\u3002\u8fd9\u76f8\u5f53\u4e8e\u628a <code>sp</code> \u4ece\u7528\u6237\u6808\u6307\u5411\u4e86 M \u6001\u7684\u6808\uff0c\u800c\u628a\u539f\u6765\u7528\u6237\u6808\u7684\u6808\u9876\u5730\u5740\u4fdd\u5b58\u5728\u4e86 mscratch \u4e2d\u3002</p> <pre><code>// head.S\n128  _mtrap:\n129      # \u4ea4\u6362 mscratch \u548c sp\n130      # \u76f8\u5f53\u4e8e\u4f7f\u7528 M \u6a21\u5f0f\u7684\u6808\u6307\u9488\n131      csrrw sp, mscratch, sp\n</code></pre> <p>\u5728\u9000\u51fa <code>_mtrap</code> \u65f6\uff0c\u6211\u4eec\u518d\u6b21\u4ea4\u6362 <code>mscratch</code> \u4e0e <code>sp</code>\uff0c\u5c31\u5b8c\u6210\u4e86\u7528\u6237\u6808\u4e0eM\u6001\u6808\u7684\u5207\u6362\u3002</p> <pre><code>// head.S   \n276      # \u4ea4\u6362 mscratch \u548c sp\n277      # \u76f8\u5f53\u4e8e\u6062\u590d\u5230\u5f02\u5e38\u524d\u7684 sp\n278      csrrw sp,mscratch,sp\n279      mret\n</code></pre> <p>\u4e3a\u4ec0\u4e48\u4e0d\u7528\u786c\u7f16\u7801\u7684\u65b9\u5f0f\u4fdd\u5b58\u6bcf\u4e2a\u5e94\u7528\u7684\u6808\u5730\u5740\u4e0e\u5185\u6838\u6808\u5730\u5740\u5462\uff1f\u56e0\u4e3a\u6211\u4eec\u9700\u8981\u7684\u4e0d\u662f\u6808\u5e95\u5730\u5740\uff0c\u800c\u662f\u6808\u9876\u5730\u5740\uff0c\u800c\u6808\u9876\u5730\u5740\u662f\u53d8\u5316\u7684\u3002</p> <p>\u8bf7\u540c\u5b66\u4eec\u4ed4\u7ec6\u7406\u89e3\u8fd9\u4e00\u90e8\u5206\u5185\u5bb9\uff0c\u5982\u679c\u6709\u7591\u95ee\u53ca\u65f6\u8be2\u95ee\u6216\u8005\u548c\u540c\u5b66\u8ba8\u8bba\u3002\u641e\u6e05\u695a\u4e0a\u9762\u7684\u6808\u5207\u6362\u903b\u8f91\u4e4b\u540e\uff0c\u6211\u4eec\u5f00\u59cb\u4ecb\u7ecd\u5185\u6838\u6808\u4e0e\u7528\u6237\u6808\u7684\u5207\u6362\u8fc7\u7a0b\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#352","title":"3.5.2 \u7528\u6237\u6808\u4e0e\u5185\u6838\u6808","text":"<p>\u6211\u4eec\u4ee5\u8fdb\u7a0b\u8c03\u5ea6\u8fc7\u7a0b\u4e3a\u4f8b\uff0c\u89e3\u91ca\u5728\u5b9e\u73b0\u4e86\u5185\u6838\u6808\u4e0e\u7528\u6237\u6808\u540e\uff0c\u4ee3\u7801\u7684\u6267\u884c\u903b\u8f91\u4e0e <code>lab2</code> \u53d1\u751f\u4e86\u54ea\u4e9b\u53d8\u5316\u3002</p> <p>\u5728 lab2 \u4e2d\uff0c\u6211\u4eec\u5728\u4e0d\u540c\u7684\u7528\u6237\u8fdb\u7a0b\u4e4b\u95f4\u5207\u6362\u65f6\uff0c\u5728 <code>__swtich_to</code> \u51fd\u6570\u4e2d\u901a\u8fc7\u5207\u6362 <code>sp</code> \u5b8c\u6210\u4e86\u6808\u7684\u5207\u6362\u3002\u5b9e\u9645\u4e0a\u6211\u4eec\u6b64\u65f6\u5b8c\u6210\u7684\u662f\u201c\u5185\u6838\u6808\u201d\u7684\u5207\u6362\uff0c\u56e0\u4e3a\u5728\u4e00\u4e2a\u8fdb\u7a0b\u88ab\u8c03\u51fa\u65f6\uff0c\u63a7\u5236\u6d41\u662f\u5728\u5185\u6838\u4e2d\u7684\uff0c\u6b64\u65f6\u7684\u6808\u4e0a\u4fdd\u5b58\u7684\u662f\u8be5\u8fdb\u7a0b\u7684\u5185\u6838\u72b6\u6001\uff08\u5373 <code>__switch_to</code> \u7684\u524d\u534a\u90e8\u5206\u6240\u505a\u7684\uff09\u3002\u56e0\u6b64\u5f53\u4e00\u4e2a\u8fdb\u7a0b\u88ab\u8c03\u5165\u65f6\uff0c\u4e5f\u5e94\u8be5\u6062\u590d\u76ee\u6807\u8fdb\u7a0b\u5728\u5185\u6838\u4e2d\u7684\u63a7\u5236\u6d41\uff08\u5373<code>__switch_to</code>\u7684\u540e\u534a\u90e8\u5206\u6240\u505a\u7684\uff09\uff0c\u7136\u540e\u518d\u7531\u5185\u6838\u63a7\u5236\u6d41\u5207\u6362\u56de\u7528\u6237\u8fdb\u7a0b\u7684\u63a7\u5236\u6d41\uff08\u5373\u6267\u884c<code>sret</code>\uff09\u3002</p> <p>\u4e0d\u540c\u70b91\uff1a\u5728\u5b9e\u73b0\u4e86\u5185\u6838\u6808\u4e0e\u7528\u6237\u6808\u540e\uff0c\u4e0e\u4ece U \u6001\u8fdb\u5165 M \u6001\u9700\u8981\u6362\u6808\u4e00\u6837\uff0c\u4ece U \u6001\u8fdb\u5165 S \u6001\u4e5f\u9700\u8981\u6362\u6808\u3002\u6211\u4eec\u501f\u52a9<code>sscratch</code> \u5bc4\u5b58\u5668\u5b8c\u6210\u8fd9\u4e00\u6b65\u3002\u8fdb\u5165\u5185\u6838\u65f6\uff0c\u6211\u4eec\u4ea4\u6362 <code>sp</code> \u4e0e <code>sccratch</code>\uff0c\u4ea4\u6362\u540e <code>sp</code> \u6307\u5411\u8be5\u8fdb\u7a0b\u7684\u5185\u6838\u6808\uff0c\u800c <code>sscratch</code> \u4fdd\u5b58\u7740\u8be5\u8fdb\u7a0b\u7684\u7528\u6237\u6808\u6808\u9876\u5730\u5740\u3002\u4ece\u5185\u6838\u8fdb\u5165\u7528\u6237\u8fdb\u7a0b\u65f6\uff0c\u518d\u6b21\u4ea4\u6362\uff0c\u5c31\u5b8c\u6210\u4e86\u6808\u5207\u6362\u3002</p> <p>\u4e0d\u540c\u70b92\uff1a\u5728\u8fdb\u884c\u8fdb\u7a0b\u5207\u6362\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5728\u5207\u6362 <code>sp</code> \u7684\u540c\u65f6\u5207\u6362 <code>sscratch</code>\uff0c\u8fd9\u6837\u624d\u80fd\u5728\u4ece S \u6001\u8fdb\u5165 U \u6001\u65f6\u6b63\u786e\u6062\u590d\u76ee\u6807\u8fdb\u7a0b\u7684\u63a7\u5236\u6d41\u3002\u56e0\u6b64\u6211\u4eec\u5728 <code>task_struct</code> \u4e2d\u6dfb\u52a0\u4e86\u4e00\u9879\u4e3a<code>sscratch</code>\uff0c\u7528\u4e8e\u8fdb\u7a0b\u5207\u6362\u65f6\u4fdd\u5b58<code>sscratch</code>\u4fe1\u606f\u3002</p> <pre><code>// task_manager.h\n\n/* \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784 */\nstruct task_struct {\n  ...\n  uint64_t sscratch; // \u4fdd\u5b58 sscratch\n  ...\n\n};\n</code></pre> <p>\u501f\u7528\u4e00\u4e0b\u6570\u5b66\u4e2d\u7684\u6570\u5b66\u5f52\u7eb3\u6cd5\u7684\u601d\u60f3\uff0c\u5982\u679c\u5728\u4e00\u4e2a\u8fdb\u7a0b\u8fdb\u5165\u5185\u6838\u65f6\uff0c<code>sscratch</code> \u786e\u5b9e\u5b58\u7684\u662f\u5b83\u5bf9\u5e94\u7684\u5185\u6838\u6808\u5730\u5740\uff0c\u90a3\u4e48\u6211\u4eec\u4e0a\u9762\u7684\u63cf\u8ff0\u5c31\u90fd\u662f\u6210\u7acb\u7684\u3002\u90a3\u4e48\u5728\u8fdb\u7a0b\u7b2c\u4e00\u6b21\u542f\u52a8\u65f6\uff0c<code>sscratch</code> \u5e94\u8be5\u5b58\u7684\u662f\u4ec0\u4e48\u5462\uff1f<code>sp</code> \u5462\uff1f\u5728\u8fdb\u7a0b\u521d\u59cb\u5316\u65f6\uff0c\u6211\u4eec\u9700\u8981\u628a <code>sp</code> \u6307\u5411\u8be5\u8fdb\u7a0b\u7684\u5185\u6838\u6808\uff0c<code>sscratch</code> \u6307\u5411\u8be5\u8fdb\u7a0b\u7684\u7528\u6237\u6808\u5373\u53ef\u3002</p> <p>\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\uff0c\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u7528\u6237\u6808\u5730\u5740\u90fd\u662f\u76f8\u540c\u7684\uff0c\u5728\u6211\u4eec\u7684\u6846\u67b6\u4e2d\uff0c\u6211\u4eec\u628a\u865a\u62df\u6808\u5730\u5740\u5b9a\u4e49\u4e3a <code>0x1001000</code> \u5f00\u59cb\u7684 <code>4KB</code> \u5730\u5740\u7a7a\u95f4\u3002\u8fd9\u5c31\u662f\u865a\u62df\u5730\u5740\u7684\u4e00\u4e2a\u91cd\u8981\u4f5c\u7528\uff0c\u5bf9\u4e8e\u4efb\u4f55\u7528\u6237\u8fdb\u7a0b\uff0c\u5b83\u90fd\u597d\u50cf\u662f\u72ec\u5360\u4e86CPU\u4e00\u6837\u3002\u518d\u6b21\u5f3a\u8c03\uff0c\u6bcf\u4e2a\u7528\u6237\u6001\u8fdb\u7a0b\u90fd\u5360\u6709\u8fd9\u4e9b\u76f8\u540c\u7684\u865a\u62df\u5185\u5b58\u5730\u5740\u662f\u4e0d\u4f1a\u51b2\u7a81\u7684\uff0c\u56e0\u4e3a\u6bcf\u4e2a\u7528\u6237\u6001\u8fdb\u7a0b\u90fd\u6709\u5c5e\u4e8e\u81ea\u5df1\u7684\u9875\u8868\uff08\u5373 <code>satp</code> \u5bc4\u5b58\u5668\u5728\u4e0d\u540c\u7528\u6237\u6001\u7a0b\u5e8f\u4e0b\u662f\u4e0d\u540c\u7684\uff09\uff0c\u8fd9\u6837\u867d\u7136\u6bcf\u4e2a\u7528\u6237\u6001\u8fdb\u7a0b\u90fd\u5360\u6709\u76f8\u540c\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u4e0d\u540c\u7684\u9875\u8868\u6765\u4f7f\u5f97\u865a\u62df\u5185\u5b58\u5730\u5740\u6620\u5c04\u5230\u7684\u7269\u7406\u5185\u5b58\u5730\u5740\u4e0d\u53d1\u751f\u51b2\u7a81\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#353","title":"3.5.3 \u9875\u8868\u5207\u6362","text":"<p>\u6211\u4eec\u63d0\u5230\u8fc7\uff0c\u5728\u6211\u4eec\u7684\u865a\u62df\u5185\u5b58\u7ba1\u7406\u673a\u5236\u4e0b\uff0c\u5728 Trap \u65f6\u4e0d\u9700\u8981\u8fdb\u884c\u9875\u8868\u5207\u6362\uff0c\u56e0\u4e3a\u5185\u6838\u548c\u7528\u6237\u8fdb\u7a0b\u5b9e\u9645\u4e0a\u4f7f\u7528\u540c\u4e00\u5f20\u9875\u8868\uff0c\u800c\u5728\u8fdb\u7a0b\u8c03\u5ea6\u65f6\u9700\u8981\u4ece\u5f53\u524d\u8fdb\u7a0b\u9875\u8868\u5207\u6362\u5230\u76ee\u6807\u8fdb\u7a0b\u9875\u8868\u3002</p> <p>\u56e0\u6b64\u6211\u4eec\u9700\u8981\u5728\u8fdb\u7a0b\u5207\u6362\u7684\u8fc7\u7a0b\u4e2d\u5b8c\u6210\u9875\u8868\u7684\u5207\u6362\u3002\u548c <code>sscratch</code> \u4e00\u6837\uff0c\u6211\u4eec\u9700\u8981\u5728 <code>task_struct</code> \u4e2d\u6dfb\u52a0\u4e00\u9879<code>satp</code>\uff0c\u7528\u4e8e\u8fdb\u7a0b\u5207\u6362\u65f6\u4fdd\u5b58 <code>satp</code> \u4fe1\u606f\u3002</p> <pre><code>/* \u8fdb\u7a0b\u6570\u636e\u7ed3\u6784 */\nstruct task_struct {\n  ...\n  uint64_t satp;     // \u4fdd\u5b58 satp\n\n};\n</code></pre> <p>\u6ce8\u610f\u9875\u8868\u5207\u6362\u7684\u65f6\u673a\uff1a\u5728 <code>__switch_to</code> \u51fd\u6570\u4e2d\uff0c\u6211\u4eec\u5c31\u5df2\u7ecf\u5b8c\u6210\u4e86\u63a7\u5236\u6d41\u7684\u8f6c\u6362\uff0c\u56e0\u6b64\u9875\u8868\u5207\u6362\u9700\u8981\u5728<code>__switch_to</code> \u4e2d\u5b8c\u6210\u3002</p> <p>\u5185\u6838\u865a\u62df\u5730\u5740\u7a7a\u95f4\u7684\u201c\u5e73\u6ed1\u5207\u6362\u201d\uff1a</p> <p>\u6211\u4eec\u5728\u6bcf\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u7684\u9875\u8868\u4e2d\u90fd\u5efa\u7acb\u4e86\u76f8\u540c\u7684\u5185\u6838\u5730\u5740\u7a7a\u95f4\u6620\u5c04\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u4fdd\u8bc1\uff0c\u5728\u5207\u6362\u7528\u6237\u8fdb\u7a0b\u7684\u9875\u8868\u540e\uff0c\u80fd\u591f\u201c\u5e73\u6ed1\u201d\u5730\u7ee7\u7eed\u8fd0\u884c\u5185\u6838\u3002\u53ef\u4ee5\u60f3\u8c61\u4e00\u4e0b\uff0c\u5982\u679c\u6bcf\u4e2a\u8fdb\u7a0b\u7684\u9875\u8868\u4e2d\uff0c\u5185\u6838\u7684\u5730\u5740\u7a7a\u95f4\u6620\u5c04\u4e0d\u540c\uff0c\u90a3\u4e48\u5728\u6211\u4eec\u6267\u884c\u5b8c\u9875\u8868\u5207\u6362\u6307\u4ee4\u540e\uff0c\u56e0\u4e3a pc \u8fd8\u6307\u5411\u539f\u6765\u7684\u5730\u5740\u7a7a\u95f4\uff0c\u4e0b\u4e00\u6761\u6307\u4ee4\uff08pc+4\uff09\u5c31\u65e0\u6548\u4e86\u3002</p> <p>\u8fd9\u662f\u5728\u5185\u6838\u5b9e\u73b0\u8fc7\u7a0b\u4e2d\u5fc5\u987b\u8981\u8003\u8651\u7684\u95ee\u9898\u3002\u5982\u679c\u6211\u4eec\u91c7\u7528\u8bbe\u8ba1\u6a21\u5f0f B\uff08\u5373\u5185\u6838\u4e0e\u7528\u6237\u8fdb\u7a0b\u4f7f\u7528\u4e0d\u540c\u7684\u9875\u8868\uff09\uff0c\u90a3\u4e48\u4e5f\u9700\u8981\u5728\u5185\u6838\u548c\u7528\u6237\u8fdb\u7a0b\u9875\u8868\u4e2d\uff0c\u7559\u51fa\u4e00\u90e8\u5206\u5efa\u7acb\u76f8\u540c\u7684\u6620\u5c04\uff0c\u5728\u8fd9\u4e2a\u76f8\u540c\u7684\u5730\u5740\u7a7a\u95f4\u4e2d\u5b8c\u6210\u9875\u8868\u7684\u5207\u6362\u3002\u8fd9\u901a\u5e38\u88ab\u79f0\u4e3a\u201c\u8df3\u677f\u673a\u5236\u201d\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#36","title":"3.6 \u5185\u5b58\u5e03\u5c40","text":"<p>\u5728\u5b9e\u73b0\u4e86\u9875\u8868\u548c\u7528\u6237\u6808/\u5185\u6838\u6808\u4e4b\u540e\uff0c\u6211\u4eec\u7684\u5185\u5b58\u5e03\u5c40\u5982\u4e0b\u56fe\u6240\u793a\uff1a</p> <pre><code>lab3\u4e2d\u5404\u4e2a\u90e8\u5206**\u5728\u7269\u7406\u7a7a\u95f4\u4e2d**\u7684\u5206\u5e03\uff1a\n\n---------------------------------------------------------------------------\n|             |     User     |        |   Kernel  |   M mode  |  OS Init  |\n|   Kernel    |              |  .bss  |   Init    |           |   Page    |                     ---&gt;\n|             |    Program   |        |   Stack   |   Stack   |   Table   |\n---------------------------------------------------------------------------\n^             ^              ^                    ^           ^\n0x80000000    0x80004000     0x8000a0000          0x8000c0000 0x8000d0000\n\n\n        -------------------------------------------------------------------------------\n        |   Task0   |   Task0   |   Task0   |  Task1   |   Task1   |   Task1   |\n ---&gt;   |   Kernel  |   User    |   Page    |  Kernel  |   User    |   Page    |    ... ...\n        |   Space   |   Space   |   Table   |  Space   |   Space   |   Table   |\n        --------------------------------------------------------------------------------\n\n\n\u6ce8\uff1a\u5728\u5b9e\u9645\u7684\u64cd\u4f5c\u7cfb\u7edf\u4e2d\uff0c\u901a\u5e38\u4f1a\u5728\u53ef\u5199\u7684\u6570\u636e\u6bb5\u4e0e\u5176\u4ed6\u6bb5\u4e4b\u95f4\u52a0\u5165guard page\uff0c\u5176\u5b9e\u5c31\u662f\u4e00\u4e2a\u7a7a\u9875\uff0c\u4f46\u662f\u8fd9\u4e2a\u7a7a\u9875\u4e0d\u5728\u9875\u8868\u4e2d\uff0c\u56e0\u6b64\u4e00\u65e6\u8bbf\u95ee\u5c31\u4f1a\u89e6\u53d1\u5f02\u5e38\uff0c\u8fd9\u6837\u5c31\u5bf9\u4e0d\u540c\u7684\u6bb5\u8d77\u5230\u4e86\u4fdd\u62a4\u4f5c\u7528\u3002\n</code></pre> <p>\u4ece <code>0x80000000</code> \u5f00\u59cb\uff0c\u5230 <code>0x80004000</code> \u662f\u5185\u6838\u7684\u4ee3\u7801\u548c\u6570\u636e\u6bb5\uff0c\u5177\u4f53\u6765\u8bf4\u662f <code>.text</code>\u3001<code>.rodata</code> \u548c <code>.data</code> \u6bb5\uff0c\u5173\u4e8e\u8fd9\u51e0\u4e2a\u6bb5\u7684\u5185\u5bb9\u4e0e\u5176\u542b\u4e49\uff0c\u53ef\u4ee5\u53c2\u8003\u8fd9\u7bc7\u535a\u5ba2\uff0c\u4e0d\u8fc7\u8fd9\u5728\u6211\u4eec\u7684os\u8bfe\u4e0a\u4e0d\u91cd\u8981\uff0c\u662f\u7f16\u8bd1\u539f\u7406\u7684\u77e5\u8bc6\u3002</p> <p>\u5728 lab3 \u4e2d\uff0c\u6211\u4eec\u628a\u7528\u6237\u5e94\u7528\u7a0b\u5e8f\u7684\u4ee3\u7801\u5355\u72ec\u62ff\u51fa\u6765\uff08\u800c\u4e0d\u662f\u548c\u5185\u6838\u4ee3\u7801\u6df7\u5728\u4e00\u8d77\uff09\uff0c\u653e\u5728\u4e86 <code>0x80004000</code> \u5230<code>0x8000a000</code> \u7684 <code>20KB</code> \u7a7a\u95f4\u4e2d\uff08\u611f\u5174\u8da3\u7684\u540c\u5b66\u53ef\u4ee5\u770b\u4e00\u4e0b <code>vmlinux.lds</code> \u6587\u4ef6\u548c <code>users.S</code> \u6587\u4ef6\uff0c\u770b\u770b\u6211\u4eec\u505a\u4e86\u4ec0\u4e48\uff09\uff0c\u6bcf\u4e2a\u7528\u6237\u5e94\u7528\u7a0b\u5e8f\u5360\u7528 <code>4KB\uff080x1000 Byte)</code> \u7684\u5185\u5b58\u3002\u4e4b\u540e\u7684 <code>4KB</code> \u662f\u5185\u6838\u7684 <code>.bss</code> \u6bb5\u3002</p> <p>\u7136\u540e\u4ece <code>0x8000b000</code> \u5230 <code>0x8000c000</code> \u662f\u6211\u4eec\u4e3a\u5185\u6838\u521d\u59cb\u5316\u5206\u914d\u7684\u6808\uff0c\u5728\u4ee3\u7801\u4e2d\uff0c\u5927\u5bb6\u9700\u8981\u5728\u8fdb\u5165S\u6001\u540e\u624b\u52a8\u5c06<code>sp</code> \u6307\u5411\u8fd9\u5757\u533a\u57df\u7684\u9ad8\u5730\u5740\uff08\u6808\u5e95\u5728\u9ad8\u5730\u5740\uff0c\u6808\u9876\u5728\u4f4e\u5730\u5740\uff09\uff0c\u7528\u4e8e\u652f\u6301\u5185\u6838\u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u7684\u51fd\u6570\u8c03\u7528\u3002</p> <p>\u4ece <code>0x8000c000</code> \u5230 <code>0x8000d000</code> \u662f\u6211\u4eec\u4e3aM\u6001\u5206\u914d\u7684\u6808\u3002</p> <p><code>0x8000d000</code> \u4e4b\u540e\uff0c\u6211\u4eec\u7528\u4e86\u51e0\u4e2a\u9875\u6765\u5206\u914d os \u521d\u59cb\u5316\u8fc7\u7a0b\u4e2d\u4f7f\u7528\u7684\u9875\u8868\u3002\u4e4b\u540e\u7684\u7a7a\u95f4\u6211\u4eec\u7528\u4e8e\u5206\u914d\u7528\u6237\u5e94\u7528\u7a0b\u5e8f\u7684\u9875\u8868\u3001\u5e94\u7528\u7684\u5185\u6838\u6808\u4e0e\u7528\u6237\u6808\u3002\u8fd9\u90e8\u5206\u9700\u8981\u540c\u5b66\u4eec\u5199\u4ee3\u7801\u5b8c\u6210\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#37-heads30","title":"3.7 \u4fee\u6539 head.S\uff0830%\uff09","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#371-s","title":"3.7.1 \u4fee\u6539 S \u6a21\u5f0f\u4e0b\u7cfb\u7edf\u542f\u52a8\u90e8\u5206\u4ee3\u7801","text":"<p>\u9ed8\u8ba4\u60c5\u51b5\u4e0b MMU \u672a\u88ab\u4f7f\u80fd\uff08\u542f\u7528\uff09\uff0c\u6b64\u65f6\u65e0\u8bba CPU \u4f4d\u4e8e\u54ea\u4e2a\u7279\u6743\u7ea7\uff0c\u8bbf\u5b58\u7684\u5730\u5740\u90fd\u4f1a\u4f5c\u4e3a\u4e00\u4e2a\u7269\u7406\u5730\u5740\u4ea4\u7ed9\u5bf9\u5e94\u7684\u5185\u5b58\u63a7\u5236\u5355\u5143\u6765\u76f4\u63a5\u8bbf\u95ee\u7269\u7406\u5185\u5b58\u3002\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4fee\u6539 S \u7279\u6743\u7ea7\u7684\u4e00\u4e2a\u540d\u4e3a <code>satp</code> \u7684 CSR \u6765\u542f\u7528\u5206\u9875\u6a21\u5f0f\uff0c\u5728\u8fd9\u4e4b\u540e S \u548c U \u7279\u6743\u7ea7\u7684\u8bbf\u5b58\u5730\u5740\u4f1a\u88ab\u89c6\u4e3a\u4e00\u4e2a\u865a\u62df\u5730\u5740\uff0c\u5b83\u9700\u8981\u7ecf\u8fc7 MMU \u7684\u5730\u5740\u8f6c\u6362\u53d8\u4e3a\u4e00\u4e2a\u7269\u7406\u5730\u5740\uff0c\u518d\u901a\u8fc7\u5b83\u6765\u8bbf\u95ee\u7269\u7406\u5185\u5b58\uff1b\u800c M \u7279\u6743\u7ea7\u7684\u8bbf\u5b58\u5730\u5740\uff0c\u6211\u4eec\u53ef\u8bbe\u5b9a\u662f\u5185\u5b58\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>M \u7279\u6743\u7ea7\u7684\u8bbf\u5b58\u5730\u5740\u88ab\u89c6\u4e3a\u4e00\u4e2a\u7269\u7406\u5730\u5740\u8fd8\u662f\u4e00\u4e2a\u9700\u8981\u7ecf\u5386\u548c S/U \u7279\u6743\u7ea7\u76f8\u540c\u7684\u5730\u5740\u8f6c\u6362\u7684\u865a\u62df\u5730\u5740\u53d6\u51b3\u4e8e\u786c\u4ef6\u914d\u7f6e\uff0c\u5728\u8fd9\u91cc\u6211\u4eec\u4e0d\u4f1a\u8fdb\u4e00\u6b65\u63a2\u8ba8\u3002</p> <ul> <li>\u5728 <code>_supervisor</code> \u5f00\u5934\u5148\u8bbe\u7f6e <code>satp</code> \u5bc4\u5b58\u5668\u4e3a0\uff0c\u6682\u65f6\u5173\u95ed MMU</li> <li>\u8bbe\u7f6e <code>sp</code> \u7684\u503c\u4e3a <code>init_stack_top</code> \u7684\u7269\u7406\u5730\u5740</li> <li>\u8c03\u7528 <code>paging_init</code> \u51fd\u6570\u5efa\u7acb\u9875\u8868</li> <li>\u8bbe\u7f6e <code>satp</code> \u7684\u503c\u4ee5\u6253\u5f00 MMU\uff0c\u6ce8\u610f\u6211\u4eec\u662f\u4ece <code>&amp;_end</code> \u5f00\u59cb\u5206\u914d\u7684\u9875\u8868\uff0c\u6240\u4ee5\u6b64\u65f6\u6839\u9875\u8868\u7684\u5730\u5740\u4e3a <code>_end</code>\u3002\u6b64\u65f6\u53ef\u4ee5\u4e0d\u7528\u8003\u8651 <code>satp</code> \u7684 <code>asid</code> \u57df\uff0c\u4fdd\u6301 <code>asid=0</code> \u5373\u53ef\uff0c\u53ef\u4ee5\u60f3\u4e00\u4e0b\u4e3a\u4ec0\u4e48\uff1f</li> <li>\u6267\u884c <code>sfence.vma</code> \u6307\u4ee4\u540c\u6b65\u865a\u62df\u5185\u5b58\u76f8\u5173\u6620\u5c04\u3002\u8fd9\u6761\u547d\u4ee4\u7684\u4f5c\u7528\u4e3a\u5237\u65b0<code>TLB</code>\u3002</li> <li>\u8bbe\u7f6e <code>stvec</code> \u4e3a\u5f02\u5e38\u5904\u7406\u51fd\u6570 <code>trap_s</code> \u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740   \u63d0\u793a\uff1a<code>vmlinux.lds</code> \u4e2d\u89c4\u5b9a\u5c06\u5185\u6838\u653e\u5728\u7269\u7406\u5185\u5b58 <code>0x80000000</code>\u3001\u865a\u62df\u5185\u5b58 <code>0xffffffc000000000</code> \u7684\u4f4d\u7f6e\uff0c\u56e0\u6b64\u7269\u7406\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740 <code>x</code> \u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740\u4e3a <code>x - 0x80000000 + 0xffffffc00000000</code>\u3002</li> <li>\u8bb0\u5f55 <code>start_kernel</code> \u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740\uff0c\u52a0\u8f7d\u5230 s0 \u5bc4\u5b58\u5668\u4e2d</li> <li>\u8bbe\u7f6e <code>sp</code> \u7684\u503c\u4e3a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684 <code>init_stack_top</code></li> <li>\u8bbe\u7f6e <code>sstatus.spp = 0</code>\uff0c\u4f7f\u5f97\u8fdb\u5165\u7528\u6237\u7a0b\u5e8f\u65f6 CPU \u5904\u4e8eU\u6001</li> <li>\u4f7f\u7528 <code>jr</code> \u6307\u4ee4\u8df3\u8f6c\u5230 <code>start_kernel</code>\uff08\u8bfb\u53d6\u4e4b\u524d\u8bb0\u5f55\u5728\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\uff09</li> </ul> <p>\u8bf7\u6ce8\u610f\uff0c\u5728\u6267\u884c\u5b8c <code>jr</code> \u4ee5\u540e\uff0c\u6211\u4eec\u7684\u5185\u6838\u5c31\u5df2\u7ecf\u8fd0\u884c\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u4e86\uff0c\u5373 <code>0xffffffc000000000</code> \u7684\u4f4d\u7f6e\uff0c\u800c\u4e0d\u5e94\u8be5\u518d\u56de\u5230 <code>0x80000000</code> \u7684\u4f4d\u7f6e\u3002</p> <p>\u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</p> <pre><code>_supervisor:\n# 1. \u5728 _supervisor \u5f00\u5934\u5148\u8bbe\u7f6e satp \u5bc4\u5b58\u5668\u4e3a0\uff0c\u6682\u65f6\u5173\u95ed MMU\n    li t1, 0\n    csrw satp, t1\n\n    # 2. \u8bbe\u7f6e sp \u7684\u503c\u4e3a init_stack_top \u7684\u7269\u7406\u5730\u5740\n    la sp, init_stack_top\n\n    # 3. \u8c03\u7528 paging_init \u51fd\u6570\u5efa\u7acb\u9875\u8868\n    call paging_init\n\n    # 4. \u8bbe\u7f6e satp \u7684\u503c\u4ee5\u6253\u5f00 MMU  \n    la t1, _end\n    # \u83b7\u53d6\u6839\u9875\u8868\u7684\u7269\u7406\u5730\u5740(_end &gt;&gt; 12)\n    srli t1, t1, 12\n    csrw satp, t1\n    li t1, 0x8000000000000000\n    csrs satp, t1\n\n    # 5. \u6267\u884c sfence.vma \u6307\u4ee4\u540c\u6b65\u865a\u62df\u5185\u5b58\u76f8\u5173\u6620\u5c04\n    sfence.vma\n\n    # 6. \u8bbe\u7f6e stvec \u4e3a\u5f02\u5e38\u5904\u7406\u51fd\u6570 trap_s \u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740\n    li t1, 0xffffffc000000000\n    li t2, 0x80000000\n    la t3, trap_s\n    add t3, t3, t1\n    sub t3, t3, t2\n    csrw stvec, t3\n\n    # 7. \u8bb0\u5f55 start_kernel \u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u5730\u5740\uff0c\u52a0\u8f7d\u5230 s0 \u5bc4\u5b58\u5668\u4e2d\n    la s0, start_kernel\n    add s0, s0, t1\n    sub s0, s0, t2\n\n    # 8. \u8bbe\u7f6e sp \u7684\u503c\u4e3a\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e0b\u7684 init_stack_top\n    la sp, init_stack_top\n    add sp, sp, t1\n    sub sp, sp, t2\n\n    # 9. \u8bbe\u7f6esstatus.spp = 0, \u8868\u793a\u5904\u7406\u5668\u5728\u8fdb\u5165\u5f02\u5e38\u5904\u7406\u4e4b\u524d\u662f\u5728\u7528\u6237\u6a21\u5f0f\n    li t1, 0x100\n    csrc sstatus, t1\n\n    # 10. \u4f7f\u7528 jr \u6307\u4ee4\u8df3\u8f6c\u5230 start_kernel\uff08\u8bfb\u53d6\u4e4b\u524d\u8bb0\u5f55\u5728\u5bc4\u5b58\u5668\u4e2d\u7684\u503c\uff09\n    jr s0\n</code></pre> <p>\u6ce8\u610f\uff1a\u4f60\u4e5f\u8bb8\u4f7f\u7528 GDB \u6253\u5370\u51fa <code>&amp;_end</code> \u7684\u503c\u662f <code>0xffffffc00000X000</code> \uff0c\u8fd9\u662f\u56e0\u4e3a\u8c03\u8bd5\u7b26\u53f7\u7684\u5730\u5740\u662f\u5728\u7f16\u8bd1\u65f6\u786e\u5b9a\u7684\uff0c\u6240\u4ee5\u65e0\u8bba\u4ec0\u4e48\u65f6\u5019\uff0c\u7528 GDB \u67e5\u770b\u7b26\u53f7\u503c\uff0c\u90fd\u662f\u5728\u865a\u62df\u5730\u5740\u7a7a\u95f4\u4e2d\u7684\u503c\u3002\u4f46\u662f\u8fd9\u4e0d\u4e00\u5b9a\u662f\u5b83\u7684\u201c\u771f\u5b9e\u503c\u201d\uff01</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#372-m-_mtrap","title":"3.7.2 \u9605\u8bfb M \u6a21\u5f0f\u4e0b\u5f02\u5e38\u5904\u7406\u4ee3\u7801 <code>_mtrap</code>","text":"<p>\u8be5\u5c0f\u8282\u4ee3\u7801\u5df2\u63d0\u4f9b\uff0c\u4ec5\u9700\u7406\u89e3\u3002\u4e0b\u9762\u7b80\u4ecb M \u6a21\u5f0f\u7684\u6808\u7a7a\u95f4\u662f\u5982\u4f55\u5de5\u4f5c\u7684\u3002</p> <ul> <li>M \u6a21\u5f0f\u4e0b\u4f9d\u7136\u4f7f\u7528\u7269\u7406\u5730\u5740\uff0c\u4f7f\u7528\u865a\u62df\u5730\u5740\u5c06\u5bfc\u81f4\u5185\u5b58\u8bbf\u95ee\u9519\u8bef\u3002</li> <li><code>mscratch</code> \u5bc4\u5b58\u5668\u662f M \u6a21\u5f0f\u4e0b\u4e13\u7528\u7684\u4e34\u65f6\u5bc4\u5b58\u5668\u3002\u901a\u5e38\uff0c\u5b83\u5c31\u7528\u4e8e\u4fdd\u5b58 M mode \u4e0b\u4e0a\u4e0b\u6587\u7269\u7406\u7a7a\u95f4\u7684\u5730\u5740\u3002lds \u6587\u4ef6\u4e2d\u5206\u914d\u51fa\u4e86 1 \u4e2a page \u7684\u7a7a\u95f4\u7528\u4e8e\u50a8\u5b58\u8fdb\u7a0b\u4e0a\u4e0b\u6587\uff0c\u5176\u9876\u90e8\u6807\u8bb0\u4e3a <code>stack_top</code>\uff0c\u5728 head.S \u8fdb\u5165 S mode \u4e4b\u524d\u7684\u9002\u5f53\u4f4d\u7f6e\uff0c\u5c06 <code>mscratch</code> \u5bc4\u5b58\u5668\u8bbe\u7f6e\u4e3a <code>stack_top</code> \u7684\u7269\u7406\u5730\u5740\u3002</li> <li>\u5728 M \u6a21\u5f0f\u5f02\u5e38\u5904\u7406\u51fd\u6570 <code>trap_m</code> \u7684\u5f00\u5934\uff0c\u5c06 <code>mscratch</code> \u4e0e <code>sp</code> \u5bc4\u5b58\u5668\u7684\u503c\u4ea4\u6362\uff0c\u4f7f\u7528\u9884\u5148\u5206\u914d\u597d\u7684\u6808\u7a7a\u95f4\u4fdd\u5b58 <code>x1-x31</code> \u5bc4\u5b58\u5668\u3002</li> <li>\u5728 <code>trap_m</code> \u8fd4\u56de\u524d\uff0c\u6062\u590d\u4fdd\u5b58\u597d\u7684\u5bc4\u5b58\u5668\uff0c\u4e4b\u540e\u5c06 <code>mscratch</code> \u4e0e <code>sp</code> \u5bc4\u5b58\u5668\u7684\u503c\u91cd\u65b0\u4ea4\u6362\u56de\u6765\u3002</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#38-vmc40","title":"3.8 \u5b9e\u73b0\u6620\u5c04\u673a\u5236 <code>vm.c</code>\uff0840%\uff09","text":""},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#381-30","title":"3.8.1 \u521b\u5efa\u6620\u5c04\uff0830%\uff09","text":"<p>\u4e3a\u4e86\u589e\u52a0\u4e00\u4e2a\u865a\u62df\u5730\u5740\u5230\u7269\u7406\u5730\u5740\u7684\u6620\u5c04\uff0c\u6839\u636e Rv39 \u5206\u914d\u65b9\u6848\u4e2d\u7684\u5730\u5740\u7ffb\u8bd1\u89c4\u5219\uff0c\u9996\u5148\u9700\u8981\u6839\u636e\u6839\u9875\u8868\u57fa\u5730\u5740\u4ee5\u53ca\u865a\u62df\u5730\u5740\u627e\u5230\u76f8\u5e94\u9875\u8868\u9879\u7684\u5730\u5740\uff0c\u5e76\u5728\u8be5\u8fc7\u7a0b\u4e2d\u4e3a\u9875\u8868\u5206\u914d\u7269\u7406\u9875\u9762\uff0c\u968f\u540e\u6839\u636e\u7269\u7406\u5730\u5740\u53ca\u6620\u5c04\u7684\u6743\u9650\u8bbe\u7f6e\u9875\u8868\u9879\u5177\u4f53\u7684\u503c\uff0c\u4f7f\u5f97\u540e\u7eed MMU \u5de5\u4f5c\u65f6\u80fd\u591f\u6839\u636e\u6839\u9875\u8868\u57fa\u5730\u5740\u548c\u865a\u62df\u5730\u5740\u5f97\u5230\u6b63\u786e\u7684\u7269\u7406\u5730\u5740\u3002</p> <p>\u5728 <code>vm.c</code> \u4e2d\u7f16\u5199\u51fd\u6570 <code>create_mapping(uint64 *pgtbl, uint64 va, uint64 pa, uint64 sz, int perm)</code>\uff0c\u7528\u4f5c\u5efa\u7acb\u9875\u8868\u6620\u5c04\u7684\u7edf\u4e00\u63a5\u53e3\uff0c\u5176\u4e2d\u53c2\u6570\u4f5c\u7528\u5982\u4e0b\uff1a</p> <ul> <li><code>pgtbl</code> \u4e3a\u6839\u9875\u8868\u7684\u57fa\u5730\u5740</li> <li><code>va</code>\uff0c<code>pa</code> \u5206\u522b\u4e3a\u9700\u8981\u6620\u5c04\u7684\u865a\u62df\u3001\u7269\u7406\u5730\u5740\u7684\u57fa\u5730\u5740</li> <li><code>sz</code> \u4e3a\u6620\u5c04\u7684\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282</li> <li><code>perm</code> \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650</li> </ul> <p>\u6211\u4eec\u4ece\u6839\u9875\u8868\u51fa\u53d1\uff0c\u6bcf\u4e00\u6b21\u521b\u5efa\u6620\u5c04\u65f6\u8981\u4f9d\u6b21\u5efa\u7acb\u4e8c\u7ea7\u9875\u8868\u548c\u4e09\u7ea7\u9875\u8868\uff0c\u5982\u679c\u4e8c\u7ea7\u9875\u8868\u548c\u4e09\u7ea7\u9875\u8868\u4e0d\u5b58\u5728\uff0c\u90a3\u5c31\u5206\u914d\u4e00\u5757\u7a7a\u95f4\u7ed9\u4e8c\u7ea7\u9875\u8868\u548c\u4e09\u7ea7\u9875\u8868\u4f7f\u7528\u5373\u53ef\u3002\u672c\u5b9e\u9a8c\u4e2d\u53ef\u4ee5\u81ea\u7531\u7ba1\u7406\u5206\u914d <code>_end</code> \u5730\u5740\u4e4b\u540e\u7684\u7269\u7406\u5185\u5b58\u3002</p> <p>\u6211\u4eec\u5728\u4ee3\u7801\u4e2d\u63d0\u4f9b\u4e86\u76f8\u5173\u7684\u51fd\u6570\u548c\u5b8f\u4f9b\u5927\u5bb6\u4f7f\u7528\uff1a</p> <ol> <li><code>alloc_page()</code>\uff1a\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u5e27\u5e76\u8fd4\u56de\u8be5\u9875\u7684*\u7269\u7406\u5730\u5740*\u3002</li> <li><code>alloced_page_num()</code>\uff1a\u8fd4\u56de\u5df2\u7ecf\u5206\u914d\u7684\u7269\u7406\u9875\u5e27\u6570\u91cf\u3002</li> <li><code>PHYSICAL_ADDR(x)</code>\uff1a\u5c06 x \u8f6c\u6362\u4e3a\u7269\u7406\u5730\u5740\uff08\u5982\u679c\u5df2\u7ecf\u662f\u7269\u7406\u5730\u5740\uff0c\u5219\u4e0d\u53d8\uff09\u3002</li> <li><code>VIRTUAL_ADDR(x)</code>\uff1a\u5c06 x \u8f6c\u6362\u4e3a <code>0xffffffc000000000</code> \u5730\u5740\u7a7a\u95f4\u4e0b\u7684\u865a\u62df\u5730\u5740\u3002</li> <li><code>PAGE_SIZE</code>\uff1aunsigned long 4096\uff0c\u8868\u793a\u4e00\u4e2a\u9875\u7684\u5927\u5c0f\u3002</li> <li><code>PTE_V,PTE_R,PTE_W,PTE_X,PTE_U</code>\uff1aSv39 \u89c4\u8303\u4e0b\u9875\u8868\u9879\u7684\u63a7\u5236\u4f4d\uff0c\u53ef\u4ee5\u901a\u8fc7 <code>PTE | PTE_?</code> \u8bbe\u7f6e\u9875\u8868\u9879\u6743\u9650\u3002</li> </ol> <p>\u6ce8\u610f\uff1a\u9875\u8868\u4e2d\u7684\u9875\u8868\u9879\u6307\u5411\u7684\u5730\u5740\u59cb\u7ec8\u662f\u7269\u7406\u5730\u5740\u3002</p> <p>\u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</p> <pre><code>void create_mapping(uint64_t *pgtbl, uint64_t va, uint64_t pa, uint64_t sz, int perm){    \n  // pgtbl \u4e3a\u6839\u9875\u8868\u7684\u57fa\u5730\u5740\n  // va\uff0cpa \u5206\u522b\u4e3a\u9700\u8981\u6620\u5c04\u7684\u865a\u62df\u3001\u7269\u7406\u5730\u5740\u7684\u57fa\u5730\u5740\n  // sz \u4e3a\u6620\u5c04\u7684\u5927\u5c0f\uff0c\u5355\u4f4d\u4e3a\u5b57\u8282\n  // perm \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\n\n  // pgtbl \u662f\u6839\u9875\u8868\u7684\u9996\u5730\u5740\uff0c\u5b83\u5df2\u7ecf\u5360\u7528\u4e86\u4e00\u9875\u7684\u5927\u5c0f\uff0c\u4e0d\u9700\u8981\u518d\u5206\u914d\n  // \uff08\u8c03\u7528create_mapping\u524d\u9700\u8981\u5148\u5206\u914d\u597d\u6839\u9875\u8868\uff09\n\n  // 1. \u901a\u8fc7 va \u5f97\u5230\u4e00\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n  // 2. \u901a\u8fc7 va \u5f97\u5230\u4e8c\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n  // 3. \u901a\u8fc7 va \u5f97\u5230\u4e09\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n  // 4. \u5982\u679c\u4e00\u7ea7\u9875\u8868\u9879\u4e0d\u5b58\u5728\uff0c\u5206\u914d\u4e00\u4e2a\u4e8c\u7ea7\u9875\u8868\n  // 5. \u8bbe\u7f6e\u4e00\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n  // 6. \u5982\u679c\u4e8c\u7ea7\u9875\u8868\u9879\u4e0d\u5b58\u5728\uff0c\u5206\u914d\u4e00\u4e2a\u4e09\u7ea7\u9875\u8868\n  // 7. \u8bbe\u7f6e\u4e8c\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n  // 8. \u8bbe\u7f6e\u4e09\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n\n  // TODO:\n  int page_num = sz / 4096;\n  if(sz % 4096) page_num++;\n\n  for(int i = 0; i &lt; page_num; ++i) {\n\n    uint64_t va_i = va + i * PAGE_SIZE;\n    uint64_t pa_i = pa + i * PAGE_SIZE;\n\n    // \u901a\u8fc7 va \u5f97\u5230\u4e00\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n    uint64_t first_index = (va_i &gt;&gt; 30) &amp; 0x1ff;\n    // \u901a\u8fc7 va \u5f97\u5230\u4e8c\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n    uint64_t second_index = (va_i &gt;&gt; 21) &amp; 0x1ff;\n    // \u901a\u8fc7 va \u5f97\u5230\u4e09\u7ea7\u9875\u8868\u9879\u7684\u7d22\u5f15\n    uint64_t third_index = (va_i &gt;&gt; 12) &amp; 0x1ff;\n\n    // \u5982\u679c\u4e00\u7ea7\u9875\u8868\u9879\u4e0d\u5b58\u5728\uff0c\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u9762\n    if ((pgtbl[first_index] &amp; PTE_V) == 0) {\n      // \u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u9762\n      uint64_t *second_page = (uint64_t *)alloc_page();\n      // \u8bbe\u7f6e\u4e00\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n      pgtbl[first_index] = (((uint64_t)second_page &gt;&gt; 12) &lt;&lt; 10) | PTE_V /*| (perm &amp; (PTE_U | PTE_V))*/;\n    }\n    // \u901a\u8fc7\u4e00\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\u5f97\u5230\u4e8c\u7ea7\u9875\u8868\u7684\u9996\u5730\u5740\n    uint64_t *second_page = (uint64_t *)((pgtbl[first_index] &gt;&gt; 10) &lt;&lt; 12);\n    // \u5982\u679c\u4e8c\u7ea7\u9875\u8868\u9879\u4e0d\u5b58\u5728\uff0c\u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u9762\n    if ((second_page[second_index] &amp; PTE_V) == 0) {\n      // \u5206\u914d\u4e00\u4e2a\u7269\u7406\u9875\u9762\n      uint64_t *third_page = (uint64_t *)alloc_page();\n      // \u8bbe\u7f6e\u4e8c\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n      second_page[second_index] = (((uint64_t)third_page &gt;&gt; 12) &lt;&lt; 10) | (perm &amp; (PTE_U | PTE_V));\n    }\n    // \u901a\u8fc7\u4e8c\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\u5f97\u5230\u4e09\u7ea7\u9875\u8868\u7684\u9996\u5730\u5740\n    uint64_t *third_page = (uint64_t *)((second_page[second_index] &gt;&gt; 10) &lt;&lt; 12);\n    // \u8bbe\u7f6e\u4e09\u7ea7\u9875\u8868\u9879\u7684\u5185\u5bb9\n    third_page[third_index] = ((pa_i &gt;&gt; 12) &lt;&lt; 10) | perm;\n  }\n}\n</code></pre>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#382-10","title":"3.8.2 \u8bbe\u7f6e\u6620\u5c04\uff0810%\uff09","text":"<p>\u5728 <code>vm.c</code> \u4e2d\u7f16\u5199 <code>paging_init</code> \u51fd\u6570\u3002</p> <ul> <li>\u521b\u5efa\u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u8c03\u7528 <code>create_mapping</code> \u51fd\u6570\u5c06\u865a\u62df\u5730\u5740 <code>0xffffffc000000000</code> \u5f00\u59cb\u7684 <code>16 MB</code>\u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a <code>0x80000000</code> \u7684 <code>16MB</code> \u7a7a\u95f4\uff0c<code>PTE_V | PTE_R | PTE_W | PTE_X</code> \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650</li> <li>\u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 <code>0x80000000</code> \u7684<code>16MB</code>\u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 <code>0x80000000</code> \u5f00\u59cb\u7684 <code>16 MB</code> \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a <code>0x80000000</code> \u7684 <code>16MB</code> \u7a7a\u95f4\uff09\uff0c<code>PTE_V | PTE_R | PTE_W | PTE_X</code> \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\u3002</li> <li>\u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540c section \u7684\u4fdd\u62a4\uff0c\u5176\u4e2d <code>text</code> \u6bb5\u7684\u6743\u9650\u4e3a <code>r-x</code>, <code>rodata</code> \u6bb5\u4e3a <code>r--</code>, \u5176\u4ed6\u6bb5\u4e3a <code>rw-</code>\uff0c\u6ce8\u610f\u4e0a\u8ff0\u4e24\u4e2a\u6620\u5c04\u90fd\u9700\u8981\u505a\u4fdd\u62a4\u3002</li> <li>\u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\uff08\u5982 <code>0x10000000</code> \u4e3a\u8d77\u59cb\u5730\u5740\u7684 UART \uff09\u8fdb\u884c\u7b49\u503c\u6620\u5c04 ( \u53ef\u4ee5\u6620\u5c04\u8fde\u7eed 1MB \u5927\u5c0f )\uff0c\u65e0\u504f\u79fb\uff0c<code>PTE_V | PTE_R | PTE_W</code> \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650</li> </ul> <p>\u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</p> <pre><code>void paging_init()\n{\n  // \u5728 vm.c \u4e2d\u7f16\u5199 paging_init \u51fd\u6570\uff0c\u8be5\u51fd\u6570\u5b8c\u6210\u4ee5\u4e0b\u5de5\u4f5c\uff1a\n  // 1. \u521b\u5efa\u5185\u6838\u7684\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u8c03\u7528 create_mapping \u51fd\u6570\u5c06\u865a\u62df\u5730\u5740 0xffffffc000000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\uff0cPTE_V | PTE_R | PTE_W | PTE_X \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\u3002\n  // 2. \u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 0x80000000 \u768416MB\u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 0x80000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\uff09\uff0cPTE_V | PTE_R | PTE_W | PTE_X \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\u3002\n  // 3. \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\uff0c\u6ce8\u610f\u4e0a\u8ff0\u4e24\u4e2a\u6620\u5c04\u90fd\u9700\u8981\u505a\u4fdd\u62a4\u3002\n  // 4. \u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\uff08\u5982 0x10000000 \u4e3a\u8d77\u59cb\u5730\u5740\u7684 UART \uff09\u8fdb\u884c\u7b49\u503c\u6620\u5c04 ( \u53ef\u4ee5\u6620\u5c04\u8fde\u7eed 1MB \u5927\u5c0f )\uff0c\u65e0\u504f\u79fb\uff0cPTE_V | PTE_R | PTE_W \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\n\n  // \u6ce8\u610f\uff1apaging_init\u51fd\u6570\u521b\u5efa\u7684\u9875\u8868\u53ea\u7528\u4e8e\u5185\u6838\u5f00\u542f\u9875\u8868\u4e4b\u540e\uff0c\u8fdb\u5165\u7b2c\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u4e4b\u524d\u3002\u8fdb\u5165\u7b2c\u4e00\u4e2a\u7528\u6237\u8fdb\u7a0b\u4e4b\u540e\uff0c\u5c31\u4f1a\u4f7f\u7528\u8fdb\u7a0b\u9875\u8868\uff0c\u800c\u4e0d\u518d\u4f7f\u7528 paging_init \u521b\u5efa\u7684\u9875\u8868\u3002\n\n  uint64_t *pgtbl = alloc_page();\n  // TODO: \u8bf7\u5b8c\u6210\u4f60\u7684\u4ee3\u7801\n  // \u8c03\u7528 create_mapping \u51fd\u6570\u5c06\u865a\u62df\u5730\u5740 0xffffffc000000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\n  create_mapping(pgtbl, 0xffffffc000000000, 0x80000000, 16 * 1024 * 1024, PTE_V | PTE_R | PTE_W | PTE_X);\n  // \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\u3002\n  create_mapping(pgtbl, 0xffffffc000000000, 0x80000000, (uint64_t)&amp;rodata_start - 0x80000000, PTE_V | PTE_R | PTE_X);\n  create_mapping(pgtbl, (uint64_t)&amp;rodata_start-0x80000000+0xffffffc000000000, (uint64_t)&amp;rodata_start, (uint64_t)&amp;data_start - (uint64_t)&amp;rodata_start, PTE_V | PTE_R);\n  create_mapping(pgtbl, (uint64_t)&amp;data_start-0x80000000+0xffffffc000000000, (uint64_t)&amp;data_start, (uint64_t)&amp;_end - (uint64_t)&amp;data_start, PTE_V | PTE_R | PTE_W);\n  // \u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 0x80000000 \u768416MB\u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 0x80000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\uff09\n  create_mapping(pgtbl, 0x80000000, 0x80000000, 16 * 1024 * 1024, PTE_V | PTE_R | PTE_W | PTE_X);\n  // \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\u3002\n  create_mapping(pgtbl, 0x80000000, 0x80000000, (uint64_t)&amp;rodata_start - 0x80000000, PTE_V | PTE_R | PTE_X);\n  create_mapping(pgtbl, (uint64_t)&amp;rodata_start, (uint64_t)&amp;rodata_start, (uint64_t)&amp;data_start - (uint64_t)&amp;rodata_start, PTE_V | PTE_R);\n  create_mapping(pgtbl, (uint64_t)&amp;data_start, (uint64_t)&amp;data_start, (uint64_t)&amp;_end - (uint64_t)&amp;data_start, PTE_V | PTE_R | PTE_W);\n  // \u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\uff08\u5982 0x10000000 \u4e3a\u8d77\u59cb\u5730\u5740\u7684 UART \uff09\u8fdb\u884c\u7b49\u503c\u6620\u5c04 ( \u53ef\u4ee5\u6620\u5c04\u8fde\u7eed 1MB \u5927\u5c0f )\uff0c\u65e0\u504f\u79fb\uff0cPTE_V | PTE_R | PTE_W\u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\n  create_mapping(pgtbl, 0x10000000, 0x10000000, 1 * 1024 * 1024, PTE_V | PTE_R | PTE_W)\n}\n</code></pre>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#383","title":"3.8.3 \u6d4b\u8bd5","text":"<p>\u5982\u679c\u9700\u8981\u4f7f\u7528 gdb \u8c03\u8bd5\uff0c\u8bf7\u53c2\u8003\u9644\u5f55\u3010\u65ad\u70b9\u4e0d\u751f\u6548\u89e3\u51b3\u65b9\u6cd5\u3011\u4fee\u6539 <code>vmlinux.lds</code>\uff0c\u5b8c\u6210\u672c\u9636\u6bb5\u7684\u8c03\u8bd5\u3002\u6ce8\u610f\u5b8c\u6210\u8c03\u8bd5\u540e\u9700\u8981\u628a <code>vmlinux.lds</code> \u6539\u56de\u539f\u6765\u7684\u503c\u3002</p> <p>\u6b64\u65f6\u6211\u4eec\u7684 os \u5e94\u8be5\u53ef\u4ee5\u6267\u884c\u8fdb\u7a0b\u8c03\u5ea6\u524d\u7684\u4ee3\u7801\u4e86\uff0c\u6267\u884c <code>make run</code>\uff0c\u5982\u679c\u6b63\u786e\u8f93\u51fa\u4e86 <code>ZJU OSLAB 3 \u5b66\u53f7 \u59d3\u540d</code>\u3001\u8fdb\u7a0b\u521d\u59cb\u5316\u4fe1\u606f\u4ee5\u53ca\u7b2c\u4e00\u6b21\u8c03\u5ea6\u4fe1\u606f\uff0c\u5219\u8bf4\u660e\u9875\u8868\u5efa\u7acb\u6ca1\u6709\u95ee\u9898\u3002</p> <pre><code>ZJU OSLAB 3 \u5b66\u53f7 \u59d3\u540d\ntask init...\n[PID = 0] Process Create Successfully!\n[PID = 1] Process Create Successfully!\n[PID = 2] Process Create Successfully!\n[PID = 3] Process Create Successfully!\n[PID = 4] Process Create Successfully!\ntask[0]: counter = 1, priority = 4 &lt;-- next\ntask[1]: counter = 4, priority = 5\ntask[2]: counter = 3, priority = 2\ntask[3]: counter = 4, priority = 1\ntask[4]: counter = 5, priority = 4\nInstruction page fault! epc = 0x0000000001000000\n</code></pre>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#39-task_managerc10","title":"3.9 \u4fee\u6539\u8fdb\u7a0b\u521d\u59cb\u5316\u4ee3\u7801 <code>task_manager.c</code>\uff0810%\uff09","text":"<p>lab3 \u4e0e lab2 \u4e0d\u540c\u7684\u5730\u65b9\u5728\u4e8e\u6211\u4eec\u533a\u5206\u4e86\u7528\u6237\u6808\u548c\u5185\u6838\u6808\uff0c\u5e76\u5b9e\u73b0\u4e86\u865a\u62df\u5185\u5b58\u7ba1\u7406\u3002\u56e0\u6b64\u5728\u8fdb\u7a0b\u521d\u59cb\u5316\u65f6\uff0c\u6211\u4eec\u9700\u8981\u5b8c\u6210\u4e0b\u9762\u51e0\u4e2a\u6b65\u9aa4\uff1a</p> <ol> <li>\u4e3a\u8fdb\u7a0b\u5206\u914d\u5185\u6838\u6808\uff08\u5df2\u5b8c\u6210\uff09    \u5728lab2\u4e2d\u6211\u4eec\u901a\u8fc7 <code>Kernel_Page+Offset</code> \u7684\u65b9\u5f0f\u5f97\u5230\u4e86\u8fdb\u7a0b\u7684\u6808\u5730\u5740\uff0c\u73b0\u5728\u6211\u4eec\u53ef\u4ee5\u76f4\u63a5\u8c03\u7528<code>alloc_page()</code>\u3002</li> </ol> <pre><code>// task_manager.c\n26    struct task_struct* new_task =(struct task_struct*)(VIRTUAL_ADDR(alloc_page()));\n27    new_task-&gt;state = TASK_RUNNING;\n28    new_task-&gt;counter = 0;\n29    new_task-&gt;priority = 5;\n30    new_task-&gt;blocked = 0;\n31    new_task-&gt;pid = i;\n32    task[i] = new_task;\n33    task[i]-&gt;thread.sp = (uint64_t)task[i] + PAGE_SIZE; // \u5185\u6838\u6808\u7684\u6808\u5e95\n34    task[i]-&gt;thread.ra = (uint64_t)__init_sepc;\n</code></pre> <ol> <li>\u4e3a\u8fdb\u7a0b\u5206\u914d\u7528\u6237\u6808</li> <li> <p>\u4e3a\u8fdb\u7a0b\u5efa\u7acb\u9875\u8868</p> </li> <li> <p>\u5efa\u7acb\u7528\u6237\u6808\u6620\u5c04\uff1a\u4ece <code>0x1001000</code> \u6620\u5c04\u5230\u7528\u6237\u6808\u7684\u7269\u7406\u5730\u5740\uff0c\u5927\u5c0f\u4e3a<code>4KB</code>\u3002</p> </li> <li>\u5efa\u7acb\u4ee3\u7801\u6bb5\u6620\u5c04\uff1a\u4ece <code>0x1000000</code> \u6620\u5c04\u5230\u7528\u6237\u4ee3\u7801\u7684\u7269\u7406\u5730\u5740\uff0c\u5927\u5c0f\u4e3a<code>4KB</code>\u3002\u7528\u6237\u4ee3\u7801\u4f4d\u7f6e\u5df2\u7ecf\u7531<code>task_addr</code>\u8ba1\u7b97\u51fa\u6765\u3002</li> <li>\u5efa\u7acb\u5185\u6838\u6620\u5c04\u3002\u4e3a\u4ec0\u4e48\u8fd9\u91cc\u6211\u4eec\u8fd8\u9700\u8981\u5bf9\u5185\u6838\u8fdb\u884c\u7b49\u503c\u6620\u5c04\u5462\uff1f\u4e0e\u521d\u59cb\u5316\u5185\u6838\u65f6\u5efa\u7acb\u7b49\u503c\u6620\u5c04\u7684\u539f\u56e0\u76f8\u540c\u5417\uff1f\u5728\u521d\u59cb\u5316\u5185\u6838\u65f6\u5efa\u7acb\u7b49\u503c\u6620\u5c04\u662f\u4e3a\u4e86\u6267\u884c\u201c\u5f00\u542f\u9875\u8868\u540e\uff0c\u8fdb\u5165<code>0xffffffc000000000</code>\u5730\u5740\u7a7a\u95f4\u524d\u201d\u7684\u4ee3\u7801\uff1b\u4e3a\u7528\u6237\u8fdb\u7a0b\u9875\u8868\u5efa\u7acb\u5185\u6838\u7684\u7b49\u503c\u6620\u5c04\uff0c\u662f\u4e3a\u4e86\u65b9\u4fbf\u9875\u8868\u7684\u5efa\u7acb\u3002</li> </ol> <p>\u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</p> <pre><code>// TODO: \u5b8c\u6210\u7528\u6237\u6808\u7684\u5206\u914d\uff0c\u5e76\u521b\u5efa\u9875\u8868\u9879\uff0c\u5c06\u7528\u6237\u6808\u6620\u5c04\u5230\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740\n// 1. \u4e3a\u7528\u6237\u6808\u5206\u914d\u7269\u7406\u9875\u9762\uff0c\u4f7f\u7528alloc_page\u51fd\u6570\n// 2. \u4e3a\u7528\u6237\u8fdb\u7a0b\u5206\u914d\u6839\u9875\u8868\uff0c\u4f7f\u7528alloc_page\u51fd\u6570\n// 3. \u5c06task[i]-&gt;sscratch\u6307\u5b9a\u4e3a\u865a\u62df\u7a7a\u95f4\u4e0b\u7684\u6808\u5730\u5740\uff0c\u53730x1001000 + PAGE_SIZE\uff08\u6ce8\u610f\u6808\u662f\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\u4f7f\u7528\u7684\uff09\n// 4. \u6b63\u786e\u8bbe\u7f6etask[i]-&gt;satp\uff0c\u6ce8\u610f\u8bbe\u7f6eASID\n// 5. \u5c06\u7528\u6237\u6808\u6620\u5c04\u5230\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740\uff0c\u4f7f\u7528create_mapping\u51fd\u6570\n// 6. \u5c06\u7528\u6237\u7a0b\u5e8f\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f7f\u7528create_mapping\u51fd\u6570\n// 7. \u5c06\u5c06\u865a\u62df\u5730\u5740 0xffffffc000000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u5730\u5740\u7a7a\u95f4\uff0c\u6ce8\u610f\u6b64\u65f6 &amp;rodata_start\u3001... \u5f97\u5230\u7684\u662f\u865a\u62df\u5730\u5740\u8fd8\u662f\u7269\u7406\u5730\u5740\uff1f\u6211\u4eec\u9700\u8981\u7684\u662f\u4ec0\u4e48\u5730\u5740\uff1f\n// 8. \u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 0x80000000 \u768416MB\u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 0x80000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\uff09\uff0cPTE_V | PTE_R | PTE_W | PTE_X \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\u3002\n// 9. \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\uff0c\u6ce8\u610f\u4e0a\u8ff0\u4e24\u4e2a\u6620\u5c04\u90fd\u9700\u8981\u505a\u4fdd\u62a4\u3002\n// 10. \u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\uff08\u5982 0x10000000 \u4e3a\u8d77\u59cb\u5730\u5740\u7684 UART \uff09\u8fdb\u884c\u7b49\u503c\u6620\u5c04 ( \u53ef\u4ee5\u6620\u5c04\u8fde\u7eed 1MB \u5927\u5c0f )\uff0c\u65e0\u504f\u79fb\uff0cPTE_V | PTE_R | PTE_W \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\n\n        // 1. \u4e3a\u7528\u6237\u6808\u5206\u914d\u7269\u7406\u9875\u9762\uff0c\u4f7f\u7528alloc_page\u51fd\u6570\n    uint64_t physical_stack = alloc_page();\n    // 2. \u4e3a\u7528\u6237\u8fdb\u7a0b\u5206\u914d\u6839\u9875\u8868\uff0c\u4f7f\u7528alloc_page\u51fd\u6570\n    uint64_t root_page_table = alloc_page();\n    // 3. \u5c06task[i]-&gt;sscratch\u6307\u5b9a\u4e3a\u865a\u62df\u7a7a\u95f4\u4e0b\u7684\u6808\u5730\u5740\uff0c\u53730x1001000 + PAGE_SIZE\uff08\u6ce8\u610f\u6808\u662f\u4ece\u9ad8\u5730\u5740\u5230\u4f4e\u5730\u5740\u4f7f\u7528\u7684\uff09\n    task[i]-&gt;sscratch = (uint64_t)0x1001000 + PAGE_SIZE;\n    // 4. \u6b63\u786e\u8bbe\u7f6etask[i]-&gt;satp\uff0c\u6ce8\u610f\u8bbe\u7f6eASID\n    task[i]-&gt;satp = root_page_table &gt;&gt; 12 | 0x8000000000000000 | (((uint64_t) (new_task-&gt;pid))  &lt;&lt; 44);\n    // 5. \u5c06\u7528\u6237\u6808\u6620\u5c04\u5230\u5b9e\u9645\u7684\u7269\u7406\u5730\u5740\uff0c\u4f7f\u7528create_mapping\u51fd\u6570\n    create_mapping((uint64_t*)root_page_table, 0x1001000, physical_stack, PAGE_SIZE, PTE_V | PTE_R | PTE_W | PTE_U);\n    // 6. \u5c06\u7528\u6237\u7a0b\u5e8f\u6620\u5c04\u5230\u865a\u62df\u5730\u5740\u7a7a\u95f4\uff0c\u4f7f\u7528create_mapping\u51fd\u6570\n    create_mapping((uint64_t*)root_page_table, 0x1000000, task_addr, PAGE_SIZE, PTE_V | PTE_R | PTE_X | PTE_U);\n    // 7. \u8c03\u7528 create_mapping \u51fd\u6570\u5c06\u865a\u62df\u5730\u5740 0xffffffc000000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\n    create_mapping((uint64_t*)root_page_table, 0xffffffc000000000, 0x80000000, 16 * 1024 * 1024, PTE_V | PTE_R | PTE_W | PTE_X);\n    // \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\u3002\n    create_mapping((uint64_t*)root_page_table, 0xffffffc000000000, 0x80000000, PHYSICAL_ADDR((uint64_t)&amp;rodata_start) - 0x80000000, PTE_V | PTE_R | PTE_X);\n    create_mapping((uint64_t*)root_page_table, (uint64_t)&amp;rodata_start, PHYSICAL_ADDR((uint64_t)&amp;rodata_start), (uint64_t)&amp;data_start - (uint64_t)&amp;rodata_start, PTE_V | PTE_R);\n    create_mapping((uint64_t*)root_page_table, (uint64_t)&amp;data_start, PHYSICAL_ADDR((uint64_t)&amp;data_start), (uint64_t)&amp;_end - (uint64_t)&amp;data_start, PTE_V | PTE_R | PTE_W);\n    // 8. \u5bf9\u5185\u6838\u8d77\u59cb\u5730\u5740 0x80000000 \u768416MB\u7a7a\u95f4\u505a\u7b49\u503c\u6620\u5c04\uff08\u5c06\u865a\u62df\u5730\u5740 0x80000000 \u5f00\u59cb\u7684 16 MB \u7a7a\u95f4\u6620\u5c04\u5230\u8d77\u59cb\u7269\u7406\u5730\u5740\u4e3a 0x80000000 \u7684 16MB \u7a7a\u95f4\uff09\n    create_mapping((uint64_t*)root_page_table, 0x80000000, 0x80000000, 16 * 1024 * 1024, PTE_V | PTE_R | PTE_W | PTE_X);\n    // 9. \u4fee\u6539\u5bf9\u5185\u6838\u7a7a\u95f4\u4e0d\u540c section \u6240\u5728\u9875\u5c5e\u6027\u7684\u8bbe\u7f6e\uff0c\u5b8c\u6210\u5bf9\u4e0d\u540csection\u7684\u4fdd\u62a4\uff0c\u5176\u4e2dtext\u6bb5\u7684\u6743\u9650\u4e3a r-x, rodata \u6bb5\u4e3a r--, \u5176\u4ed6\u6bb5\u4e3a rw-\u3002\n    create_mapping((uint64_t*)root_page_table, 0x80000000, 0x80000000, PHYSICAL_ADDR((uint64_t)&amp;rodata_start) - 0x80000000, PTE_V | PTE_R | PTE_X);\n    create_mapping((uint64_t*)root_page_table, PHYSICAL_ADDR((uint64_t)&amp;rodata_start), PHYSICAL_ADDR((uint64_t)&amp;rodata_start), (uint64_t)&amp;data_start - (uint64_t)&amp;rodata_start, PTE_V | PTE_R);\n    create_mapping((uint64_t*)root_page_table, PHYSICAL_ADDR((uint64_t)&amp;data_start), PHYSICAL_ADDR((uint64_t)&amp;data_start), (uint64_t)&amp;_end - (uint64_t)&amp;data_start, PTE_V | PTE_R | PTE_W);\n    // 10. \u5c06\u5fc5\u8981\u7684\u786c\u4ef6\u5730\u5740\uff08\u5982 0x10000000 \u4e3a\u8d77\u59cb\u5730\u5740\u7684 UART \uff09\u8fdb\u884c\u7b49\u503c\u6620\u5c04 ( \u53ef\u4ee5\u6620\u5c04\u8fde\u7eed 1MB \u5927\u5c0f )\uff0c\u65e0\u504f\u79fb\uff0cPTE_V | PTE_R | PTE_W \u4e3a\u6620\u5c04\u7684\u8bfb\u5199\u6743\u9650\n    create_mapping((uint64_t*)root_page_table, 0x10000000, 0x10000000, 1 * 1024 * 1024, PTE_V | PTE_R | PTE_W);\n</code></pre> <p>\u4e4b\u524d\u5df2\u7ecf\u63d0\u5230\u8fc7\u4e00\u4e9b\u7b26\u53f7\u7684\u503c\u5728\u4e0d\u540c\u7684\u5730\u5740\u7a7a\u95f4\u7b97\u51fa\u6765\u662f\u4e0d\u4e00\u6837\u7684\uff0c\u4ec0\u4e48\u65f6\u5019\u9700\u8981\u4f7f\u7528PHYSICAL_ADDR\uff0c\u8bf7\u4ed4\u7ec6\u8003\u8651\uff01</p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#310-entrys","title":"3.10 \u4fee\u6539 <code>entry.S</code>","text":"<p>\u7ed3\u5408 3.5 \u8282\u5185\u5bb9\uff0c\u5b8c\u6210\u7528\u6237\u6808\u548c\u5185\u6838\u6808\u7684\u6362\u6808\u6c47\u7f16\u4ee3\u7801\u3002</p> <ol> <li>\u5728 <code>trap_s</code> \u4e2d\u52a0\u5165\u6362\u6808\u64cd\u4f5c    \u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</li> </ol> <pre><code>trap_s:\n    # TODO: swap sp and sscratch, now sp point to kernel stack, sscratch point to user stack\n    csrrw sp, sscratch, sp\n\n...\n\n    # TODO: swap sp and sscratch, now sp point to user stack, sscratch point to kernel stack\n    csrrw sp, sscratch, sp\n\n    sret\n</code></pre> <ol> <li>\u5728 <code>__switch_to</code> \u4e2d\u52a0\u5165\u5bf9 <code>sscratch</code> \u7684\u4fdd\u5b58\u548c\u6362\u9875\u8868\u64cd\u4f5c    \u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</li> </ol> <pre><code>.globl __switch_to\n__switch_to:\n\n...\n\n    # TODO: save sscratch into prev-&gt;sscratch\n    csrr s0, sscratch\n    sd s0, 14*reg_size(a3)\n\n    # TODO: save satp into prev-&gt;satp\n    csrr s0, satp\n        sd s0, 15*reg_size(a3)\n...\n\n    # TODO: load sscratch from next-&gt;sscratch\n        ld s0, 14*reg_size(a4)\n        csrw sscratch, s0\n\n    # TODO: load satp from next-&gt;satp\n    ld s0, 15*reg_size(a4)\n        csrw satp, s0\n        ld  s0, 2*reg_size(a4)\n\n    # return to ra\n    ret\n</code></pre> <ol> <li>\u5728 <code>__init_sepc</code> \u4e2d\u52a0\u5165\u6362\u6808\u64cd\u4f5c    \u8bf7\u5728\u4e0b\u65b9\u4ee3\u7801\u6846\u4e2d\u8865\u5145\u5b8c\u6574\u4f60\u7684\u4ee3\u7801\uff1a</li> </ol> <pre><code>.globl __init_sepc\n__init_sepc:\n  # DONE: Set sepc to test(in virtual memory)\n    li t0, 0x1000000\n    csrw sepc, t0\n    # TODO: swap sp and sscratch, now sp point to user stack, sscratch point to kernel stack\n    csrrw sp, sscratch, sp\n    sret\n</code></pre>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#311_1","title":"3.11 \u7f16\u8bd1\u53ca\u6d4b\u8bd5","text":"<p>\u6267\u884c <code>make run</code>\uff0c\u5bf9 <code>main.c</code> \u505a\u4fee\u6539\uff0c\u786e\u4fdd\u8f93\u51fa\u672c\u7ec4\u6210\u5458\u7684\u5b66\u53f7\u4e0e\u59d3\u540d\u3002\u672c\u6b21\u5b9e\u9a8c\u4f7f\u7528\u7684\u8c03\u5ea6\u7b97\u6cd5\u4e3a<code>SJF</code>\u3002</p> <p>\u8bf7\u5728\u6b64\u9644\u4e0a\u4f60\u7684\u4ee3\u7801\u6210\u529f\u8fd0\u884c\u7684\u8fd0\u884c\u7ed3\u679c\u622a\u56fe\uff0c\u53ef\u4ee5\u8d34\u591a\u5f20\u56fe</p> <p>\u7b54\uff1a</p> <p></p> <p></p> <p></p>"},{"location":"%E6%95%B0%E9%80%BB/Lab%203%20RV64%20%E8%99%9A%E6%8B%9F%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/#4","title":"4 \u8ba8\u8bba\u548c\u5fc3\u5f97","text":"<p>\u8fd9\u6b21\u865a\u62df\u5185\u5b58\u7ba1\u7406\u7684\u5b9e\u9a8c\u76f8\u5bf9\u4e8e\u524d\u51e0\u4e2a\u5b9e\u9a8c\u800c\u8a00\uff0c\u96be\u5ea6\u6709\u6240\u63d0\u5347\uff0c\u662f\u5728lab2\u7684\u57fa\u7840\u4e0a\u53c8\u8fdb\u884c\u4e86\u62d3\u5c55\u3002\u4e4b\u524d\u7684\u5b9e\u9a8c\u4e2d\uff0c\u6240\u6709\u7684\u8fdb\u7a0b\u548c\u5185\u6838\u90fd\u5171\u7528\u540c\u4e00\u4e2a\u6808\uff0c\u8fd9\u6837\u8fdb\u7a0b\u53ef\u4ee5\u76f4\u63a5\u8bbf\u95ee\u5230\u5185\u6838\u7684\u6570\u636e\uff0c\u8fd9\u662f\u5f88\u5371\u9669\u7684\u4e00\u4ef6\u4e8b\uff0c\u6240\u4ee5\u5728\u8fd9\u4e2a\u5b9e\u9a8c\u4e2d\uff0c\u6211\u4eec\u5c06\u5185\u6838\u6808\u4e0e\u8fdb\u7a0b\u6808\u8fdb\u884c\u4e86\u5206\u79bb\uff0c\u4ece\u800c\u5b9e\u73b0\u4e86\u66f4\u597d\u7684\u5b89\u5168\u6027\u3002\u7136\u800c\uff0c\u5728\u8fd9\u4e2a\u5b9e\u9a8c\u4e2d\u7406\u89e3\u6362\u6808\u7684\u903b\u8f91\u8fd8\u662f\u82b1\u8d39\u4e86\u6211\u4e0d\u5c11\u65f6\u95f4\uff0c\u6211\u4ed4\u7ec6\u68b3\u7406\u4e86\u4ec0\u4e48\u65f6\u5019\u4f1a\u5207\u6362\u5230\u5185\u6838\u6808\uff0c\u4ec0\u4e48\u65f6\u5019\u4f1a\u5207\u6362\u5230\u8fdb\u7a0b\u6808\uff0c\u8fd9\u4e24\u4e2a\u6808\u6709\u4ec0\u4e48\u533a\u522b\uff0c\u5185\u6838\u6808\u7a76\u7adf\u662f\u5171\u7528\u4e00\u4e2a\u8fd8\u662f\u6bcf\u4e2a\u8fdb\u7a0b\u5bf9\u5e94\u4e00\u4e2a\u3002\u5728\u68b3\u7406\u5b8c\u4ee5\u4e0a\u6240\u6709\u95ee\u9898\u540e\uff0c\u8fd9\u4e2a\u5b9e\u9a8c\u7684\u6d41\u7a0b\u5c31\u5341\u5206\u6e05\u6670\u4e86\u3002</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/","title":"Number Systems and Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#lcdf","title":"LCDF","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#week-1-number-systems-and-boolean-algebra","title":"Week 1: Number Systems and Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#part-1","title":"Part 1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#number-systems","title":"Number Systems","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#representation","title":"Representation","text":"<ul> <li> <p>A number with \\(radix\\ r\\) is represented by a string of digits:   $$   A_{n-1}A_{n-2}\\dots A_{1}A_{0}.A_{-1}A_{-2}\\dots A_{-m+1}A_{-m}   $$   where \\(0\\leq{A_i}&lt;r\\) and \\(.\\) is the radix point</p> </li> <li> <p>The string of digits represents the power series:   $$   Number_r=(\\Sigma_{i=0}^{i=n-1}A_i\\cdot{r^i}+\\Sigma_{j=-m}^{j=-1}A_j\\cdot{r^j})   $$</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#binary-arithmetic","title":"Binary Arithmetic","text":"<ul> <li>Single Bit Addition with Carry</li> <li>Mutiple Bit Addition</li> <li>Single Bit Subtraction with Borrow</li> <li>Mutiple Bit Subtraction</li> <li>Multiplication</li> <li>BCD Addition</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#single-bit-subtraction-with-borrow","title":"Single Bit Subtraction with Borrow","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#mutiple-bit-binary-subtraction","title":"Mutiple Bit Binary Subtraction","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#binary-multiplication","title":"Binary Multiplication","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#converting-decimal-to-binary","title":"Converting Decimal to Binary","text":"<ul> <li>Method 1</li> <li>Subtract the largest power of 2 not exceed the number</li> <li>Repeat, subtracting from the prior remainder and recording the power, until the remainder is zero</li> <li>Place 1's in the positions in the binary result corresponding to the powers recorded; in all other positions place 0's</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#method-1","title":"Method 1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#converting-decimal-to-binary-cont","title":"Converting Decimal to Binary (Cont.)","text":"<ul> <li>Method 2</li> <li>Convert the Integer Part</li> <li>Convert the Fraction Part</li> <li>Join the two results with a radix point</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#conversion-details","title":"Conversion Details","text":"<ul> <li>To Convert the Integral Part:</li> </ul> <p>Repeatedly divide the number by the new radix and save the remainders. The digits for the new radix are the remainders in reverse order of their computation. If the new radix is more than 10, then convert all remainders exceed 10 to digits A, B, ...</p> <ul> <li>To Convert the Fraction Part:</li> </ul> <p>Repeatedly multiply the fraction by the new radix and save the integer digits that result. The digits for the new radix are the Integer digits in order of their computation. If the new radix is more than 10, then convert all integers exceed 10 to digits A, B, ...</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#example-convert-466875_10-to-base-2","title":"Example: Convert \\(46.6875_{10}\\) To Base 2","text":"<ul> <li>Convert 46 to Base 2</li> </ul> <p>\\(46_{10}=101110_2\\)</p> <ul> <li>Convert 0.6875 to Base 2</li> </ul> <p>\\(0.6875_{10}=0.1011_2\\)</p> <ul> <li>Join the results together with the radix point:</li> </ul> <p>radix point:</p> <p>\\(46.6875_{10}=101110.1011_2\\)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q-what-if-the-fractional-part-cant-become-0-as-a-result-of-the-repeated-multiplications","title":"Q: What if the fractional part can't become 0 as a result of the repeated multiplications?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#solution-specify-number-of-bits-to-right-of-radix-point-and-round-or-truncate-to-this-number","title":"Solution: Specify number of bits to right of radix point and round or truncate to this number.","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#octal-hexadecimal-to-binary-and-back","title":"Octal (Hexadecimal) to Binary and Back","text":"<ul> <li>Example:</li> </ul> <p>\\((67.731)_8=110\\ 111.111\\ 011\\ 001_2\\)</p> <p>\\((312.64)_8=011\\ 001\\ 010.110\\ 100_2=11001010.1101_2\\)</p> <p>\\(11\\ 111\\ 101.010\\ 011\\ 11_2=(375.236)_8\\)</p> <p>\\(10\\ 110.11_2=(26.8)_8\\)</p> <p>\\((3\\rm{AB}4.1)_{16}=0011\\ 1010\\ 1011\\ 0100.0001_2\\)</p> <p>\\((21\\rm{A}.5)_{16}=0010\\ 0001\\ 1010.0101_2\\)</p> <p>\\(1001101.01101_2=0100\\ 1101.0110\\ 1000_2=(4\\rm{D}.68)_{16}\\)</p> <p>\\(110\\ 0101.101_2=(65.\\rm{A})_{16}\\)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q-how-many-bits-are-required-to-represent-decimal-digits-with-a-binary-code","title":"Q: How many bits are required to represent decimal digits with a binary code?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#solution-lceil-log_210-rceil4","title":"Solution: \\(\\lceil log_2{10} \\rceil=4\\)","text":"<ul> <li>Generally, Given M elements to be presented by a binary code, the minimum number of bits, \\(n\\), needed, satisfies the following relationships:   $$   2^n\\geq{M}&gt;2^{n-1}   $$   \\(n=\\lceil{log_2{M}}\\rceil\\), where \\(\\lceil x \\rceil\\) called the ceiling function, is the integer greater than of equal to x</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#more-binary-codes","title":"More Binary Codes","text":"<ul> <li> <p>You can represent 4 elements in \\(radix\\ r=2\\) with \\(n=2\\) digits: (00, 01, 10, 11).</p> </li> <li> <p>You can represent 4 elements in \\(radix\\ r=2\\) with \\(n=4\\) digits: (0001, 0010, 0100, 1000).</p> </li> <li> <p>This second code is called a \"One-hot code\".</p> </li> <li> <p>One-hot encoding consists in using one bit representing each state.</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#more-binary-codes-cont","title":"More Binary Codes (Cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#binary-coded-decimal-bcd","title":"Binary Coded Decimal (BCD)","text":"<ul> <li>The BCD code is the 8, 4, 2, 1 code.</li> <li>8, 4, 2, and 1 is weights</li> <li>BCD is a weighted code</li> <li>This code is the simplest, most intuitive binary code for decimal digits and uses the same powers of 2 as a binary number, but only encodes the first ten values from 0 to 9</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q-how-to-distinguish-between-conversion-and-coding","title":"Q: How to distinguish between Conversion and Coding?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#conversion-or-coding","title":"Conversion or Coding?","text":"<ul> <li>Conversion is to convert a decimal number into a binary number.</li> <li>Coding is to convert every decimal digit into a binary number.</li> <li>\\(13_{10}=1101_2\\) (This is Conversion)</li> <li>\\(13 \\Leftrightarrow 0001|0011\\) (This is Coding)</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#example-add-2905_rmbcd-to-1897_rmbcd","title":"Example: Add \\(2905_{\\rm{BCD}}\\) to \\(1897_{\\rm{BCD}}\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#error-detection-methods","title":"Error-Detection Methods","text":"<ul> <li>Parity Bit Error-Detection Codes</li> <li>Parity is an extra bit appended onto the code word to make the number of 1's odd or even.</li> <li>Even Parity: the number of 1's in the code word is even.</li> <li>Odd Parity: the number of 1's in the code word is odd.</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#gray-code","title":"Gray Code","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#conversion-from-binary-code-to-gray-code","title":"Conversion from Binary Code to Gray Code","text":"<ul> <li>Let Binary code be \\(b_3b_2b_1b_0\\). Then the Gray code can be obtained as follows:</li> </ul> <p>\\(g_3=b_3\\)</p> <p>\\(g_2=b_3 \\oplus b_2\\)</p> <p>\\(g_1=b_2 \\oplus b_1\\)</p> <p>\\(g_0=b_1 \\oplus b_0\\)</p> <p></p> Figure. Convert Binary code 11101 into Gray code"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#part-2","title":"Part 2","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#boolean-algebra","title":"Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#logical-operation","title":"Logical Operation","text":"<ul> <li>The three basic logical operations are:</li> <li>AND</li> <li>OR</li> <li>NOT</li> <li>AND is denoted by a dot ( \\(\\cdot\\) )</li> <li>OR is denoted by a plus ( + )</li> <li>NOT is denoted by an overbar ( $ \\overline{} $ ), a single quote mark ( ' ), or ( ~ ) before the variable</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#logic-gates","title":"Logic Gates","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#other-commonly-used-logic-gates","title":"Other Commonly Used Logic Gates","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#universal-gate","title":"Universal Gate","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#logic-diagrams-and-expressions","title":"Logic Diagrams and Expressions","text":"Truth tables and waveforms are unique, while equations and diagrams are not."},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#boolean-algebra_1","title":"Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#duality-rules","title":"Duality rules","text":"<ul> <li> <p>The dual of an algebraic expression is obtained by interchanging \\(+\\) and \\(\\cdot\\) and interchanging 0's and 1's, while variable don't be inverted</p> </li> <li> <p>Seek the dual of a function, the operation order keep as same as the origin function</p> </li> <li>The identities appear in dual pairs. When there is only one identity on a line the identity is self-dual. i.e., the dual expression = the original expression.</li> <li>Unless it happens to be self-dual, the dual of an expression does not equal to the expression itself.</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#duality-rules-cont","title":"Duality rules (Cont.)","text":"<ul> <li>Example: \\(F=(A+\\overline{C})\\cdot{B}+0\\)</li> </ul> <p>Dual: \\(F=(A\\cdot\\overline{C}+B)\\cdot{1}=A\\cdot\\overline{C}+B\\)</p> <ul> <li>Example: \\(G=X\\cdot{Y}+(\\overline{W+Z})\\)</li> </ul> <p>Dual: \\(G=((X+Y)\\cdot{\\overline{(W\\cdot{Z})}})=(X+Y)\\cdot{(\\overline{W}+\\overline{Z})}\\)</p> <ul> <li>Example: \\(H=A\\cdot{B}+A\\cdot{C}+B\\cdot{C}\\)</li> </ul> <p>Dual: \\(H=(A+B)\\cdot{(A+C)}\\cdot{(B+C)}\\)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#duality-rules-cont_1","title":"Duality rules (Cont.)","text":"<ul> <li> <p>If the function G is the dual of F, then F is also G of duality. G and F is mutually duality formula.</p> </li> <li> <p>If the two logical functions F and G are equal, then the duality formula F' and G' are the same.</p> </li> <li> <p>Example:</p> </li> </ul> <p>\\(X+XY=X \\Leftrightarrow X(X+Y)=X\\)   (Absorption)</p> <p>\\(X(Y+Z)=XY+XZ \\Leftrightarrow X+YZ=(X+Y)(X+Z)\\)   (Distributive)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#complementing-functions","title":"Complementing Functions","text":"<ul> <li> <p>For logic function F, interchange \\(+\\) and \\(\\cdot\\) operators and complement each constant value   and literal, then obtained the new function is the inverse function of the original function,   referred to as: \\(\\overline{F}\\)</p> </li> <li> <p>Example</p> </li> </ul> <p>\\(F=\\overline{A}B+C\\overline{D} \\Leftrightarrow \\overline{F}=(A+\\overline{B})(\\overline{C}+D)\\)</p> <p>\\(F=\\overline{X}Y\\overline{Z}+X\\bar{Y}\\bar{Z} \\Leftrightarrow \\overline{F}=(X+\\overline{Y}+Z)(\\overline{X}+Y+Z)\\)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q1-how-to-proof-aacdotba","title":"Q1: How to proof \\(A+A\\cdot{B}=A\\)?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q2-how-to-proof-aboverlineacbcaboverlineac","title":"Q2: How to proof \\(AB+\\overline{A}C+BC=AB+\\overline{A}C\\)?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#consensus-theorem","title":"(Consensus Theorem)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#q3-how-to-proof-overlinexyzxoverlineyoverlineyxz","title":"Q3: How to proof \\(\\overline{(X+Y)}Z+X\\overline{Y}=\\overline{Y}(X+Z)\\)?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#useful-theorems","title":"Useful Theorems","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#example1-simplify-expression","title":"Example1: Simplify Expression","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#faboverlineacdoverlineabdoverlineacoverlinedabcd","title":"\\(F=AB+\\overline{A}CD+\\overline{A}BD+\\overline{A}C\\overline{D}+ABCD\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#example2-simplify-expression","title":"Example2: Simplify Expression","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture1/#labaoverlinecoverlinebcoverlinecboverlinebdoverlinedbadefg","title":"\\(L=AB+A\\overline{C}+\\overline{B}C+\\overline{C}B+\\overline{B}D+\\overline{D}B+ADE(F+G)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/","title":"Number Systems and Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#lcdf","title":"LCDF","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#week-2-canonical-forms-and-circuit-optimization","title":"Week 2: Canonical Forms and Circuit Optimization","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#part-1","title":"Part 1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#canonical-forms","title":"Canonical Forms","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#difficulties-in-manipulating-boolean-functions","title":"Difficulties in Manipulating Boolean Functions","text":"<ul> <li> <p>For Boolean function have function proof</p> </li> <li> <p>Problem: a Boolean function has multiple expressions.</p> </li> <li> <p>For expression simplification</p> </li> <li> <p>Problem 1: too many identities and theorems of Boolean algebra to apply</p> </li> <li> <p>Problem 2: requires skills for simplification (e.g., \\(BC=(A+\\overline{A})\\cdot{BC}\\))</p> </li> <li> <p>Solutions \\(\\bar{B}\\bar{D}+CD+AD+A\\overline{B}+\\overline{B}C \\xrightarrow{\\substack{Algebraic \\\\ Transformation}} \\Sigma_m(0,2,3,7,8,9,10,11,13,15)\\)</p> <p>$ \\xrightarrow{\\substack{Minimization \\ Theorem}} \\bar{B}\\bar{D}+(A+C)D$</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#canonical-forms-for-comparison-of-equality","title":"Canonical Forms for Comparison of Equality","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#boolean-expressions-for-a-truth-table","title":"Boolean Expressions for a Truth Table","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#minterms","title":"Minterms","text":"<ul> <li> <p>Minterms are AND terms with every variable present in either true (e.g., \\(x\\)) or complemented form (e.g., \\(\\overline{x}\\))</p> </li> <li> <p>For n-input variables, there are \\(2^n\\) minterms or \\(2^n\\) total number of possible input combinations.</p> </li> <li> <p>Each minterm equals 1 at exactly one particular input combination and is equal to 0 at all other combinations.</p> </li> <li> <p>In general, minterms are designated \\(m_i\\), where \\(i\\) corresponds the input binary combination at which this midterm is equal to 1.</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#maxterms","title":"Maxterms","text":"<ul> <li> <p>Maxterms are OR terms with every variable present in either true (e.g., \\(x\\)) or complemented form (e.g., \\(\\overline{x}\\))</p> </li> <li> <p>For n-input variables, there are \\(2^n\\) minterms or \\(2^n\\) total number of possible input combinations.</p> </li> <li> <p>Each maxterm equals 0 at exactly one particular input combination and is equal to 1 at all other combinations.</p> </li> <li> <p>In general, minterms are designated \\(m_i\\), where \\(i\\) corresponds the input binary combination at which this midterm is equal to 1.</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#two-principles-of-minterms-and-maxterms","title":"Two Principles of Minterms and Maxterms","text":"<ul> <li> <p>All variables will be present in a minterm or maxterm and will be listed in the same order (usually alphabetically)</p> </li> <li> <p>Whether minterm or maxterm must contain all variables.</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#practice1-write-down-canonical-forms-for","title":"Practice1: Write down Canonical Forms for","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#fabcbarxbaryzxbarybarzxyz","title":"\\(F(A,B,C)=\\bar{x}\\bar{y}z+x\\bar{y}\\bar{z}+xyz\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#practice2-find-fabcdem_2m_9m_17m_23","title":"Practice2: Find \\(F(A,B,C,D,E)=m_{2}+m_{9}+m_{17}+m_{23}\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#q-how-to-implement-fabcaoverlinebc-as-a-sum-of-minterms-and-a-product-of-maxterms","title":"Q: How to implement \\(F(A,B,C)=A+\\overline{B}C\\) as a sum of minterms and a product of maxterms?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#transformation-to-canonical-sum-of-minterms","title":"Transformation to Canonical Sum of Minterms","text":"<ul> <li>Any Boolean Function can be expressed as a Sum of Minterms (SOM).</li> <li>For the function table, the minterms used are the forms corresponding to the 1's</li> <li> <p>For expressions, expand all terms first to explicitly list all minterms. Do this by \"ANDing\" any term missing a variable v with a term \\((v+\\overline{v})\\)</p> </li> <li> <p>Example: Implement \\(f=x+\\bar{x}\\bar{y}\\) as a sum of minterms.</p> </li> <li>First expand terms: \\(f=x(y+\\overline{y})+\\bar{x}\\bar{y}\\)</li> <li>Then distribute terms: \\(f=xy+x\\overline{y}+\\bar{x}\\bar{y}\\)</li> <li>Express as sum of minterms: \\(f=m_0+m_2+m_3\\)</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#transformation-to-canonical-product-of-maxterms","title":"Transformation to Canonical Product of Maxterms","text":"<ul> <li> <p>Any Boolean Function can be expressed as a Product of Maxterms (POM).</p> </li> <li> <p>For the function table, the maxterms used are the terms corresponding to the 0's</p> </li> <li> <p>For an expression, expand all terms first to explicitly list all maxterms. Do this by first applying the second distributive law, \"ORing\" terms missing variable v with a term equal to \\(v\\cdot\\overline{v}\\) and then applying the distributive law again.</p> </li> <li> <p>Example: Convert to product of maxterms: \\(f(x,y,z)=x+\\bar{x}\\bar{y}\\)</p> </li> <li> <p>Apply the distributive law:</p> <p>\\(x+\\bar{x}\\bar{y}=(x+\\bar{x})(x+\\bar{y})=1\\cdot(x+\\bar{y})=x+\\bar{y}\\)</p> </li> <li> <p>Add missing variable z:</p> <p>\\(x+\\overline{y}+z\\cdot{\\overline{z}}=(x+\\overline{y}+z)(x+\\overline{y}+\\overline{z})\\)</p> </li> <li> <p>Express as sum of minterms: \\(f=M_2\\cdot{M_3}\\)</p> </li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#conversion-between-forms","title":"Conversion Between Forms","text":"<ul> <li>To convert between sum-of-minterms and product-of-maxterms form (or vice-versa) we follow these steps:</li> <li>Find the function complement by swapping terms in the list with terms not in the list</li> <li> <p>Change from product to sums, or vice versa.</p> </li> <li> <p>Example: Given F as before: \\(F(x,y,z)=\\Sigma_m(1,3,5,7)\\)</p> </li> <li>Form the Complement: \\(\\overline{F}(x,y,z)=\\Sigma_m(0,2,4,6)\\)</li> <li>Then use the other form with the same indices - this forms the complement again, giving the other form of the origin function: \\(F(x,y,z)=\\Pi_M(0,2,4,6)\\)</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#minterms-to-maxterms-conversion","title":"Minterms to Maxterms Conversion","text":"<ul> <li>Example: Implement F1 as POM:</li> </ul> <p>\\(\\overline{F_1}=m_0+m_2+m_3+m_5+m_6\\)</p> <p>\\(F_1=\\overline{m_0}\\cdot\\overline{m_2}\\cdot\\overline{m_3}\\cdot\\overline{m_5}\\cdot\\overline{m_6}=M_0\\cdot{M_2}\\cdot{M_3}\\cdot{M_5}\\cdot{M_6}\\)</p>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#part-2","title":"Part 2","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#circuit-optimization","title":"Circuit Optimization","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#circuit-optimization_1","title":"Circuit Optimization","text":"<ul> <li>Goal: To obtain the simplest implementation for a given function</li> <li>Optimization is a more formal approach to simplification that is preformed using a specific procedure or algorithm</li> <li>Optimization requires a cost criterion to measure the simplicity of a circuit</li> <li>Distinct cost criteria we will use:</li> <li>Literal cost (L)</li> <li>Gate input cost (G)</li> <li>Gate input cost with NOTs (GN)</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#input-cost","title":"Input Cost","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#karnaugh-maps-k-map","title":"Karnaugh Maps (K-map)","text":"<ul> <li>A K-map is a collection of squares</li> <li>Each square represents a minterm or maxterm</li> <li>The Boolean results are transferred from a truth table onto a two-dimensional grid</li> <li>Adjacent squares differ in the value of one variable (each square is ordered in Gray Code)</li> <li>Alternative algebraic expressions for the same function are derived by recognizing patterns of squares</li> <li>The K-map can be viewed as</li> <li>A reorganized version of the truth table</li> <li>A clever way to rewrite truth tables to make it easier to figure out the logic</li> <li>A topologically-warped Venn diagram as used to visualize sets in algebra of sets</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#steps-to-minimize-expressions-using-k-map","title":"Steps to Minimize Expressions using K-map","text":"<ul> <li>Step 1: Identify minterms or maxterms</li> <li>Step 2: Fill the K-map with minterms or maxterms</li> <li>For SOM, put 1's in squares respective to the minterms</li> <li>For POM, put 0's in squares respective to the maxterms</li> <li>Step 3: Form the rectangular groups containing maximum number of terms in power of two</li> <li>Step 4: Obtain the simplified expression for groups</li> <li>For SOM, find the product terms and sum them up</li> <li>For POM, find the sum terms and take product of them</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#four-variable-maps","title":"Four Variable Maps","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#example-1-four-variable-map-simplification","title":"Example 1: Four Variable Map Simplification","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#fwxyzsigma_m0245678101315","title":"\\(F(W,X,Y,Z)=\\Sigma_{m}(0,2,4,5,6,7,8,10,13,15)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#example-2-four-variable-map-simplification","title":"Example 2: Four Variable Map Simplification","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#fwxyzsigma_m34579131415","title":"\\(F(W,X,Y,Z)=\\Sigma_m(3,4,5,7,9,13,14,15)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#dont-cares-in-k-maps","title":"Don't Cares in K-Maps","text":"<ul> <li>Sometimes a function table or map contains entries for which it is known:</li> <li>The input values for the minterm will never occur, or</li> <li> <p>The output value for minterm is not used</p> </li> <li> <p>In these cases, the output value need not be defined.</p> </li> <li>The output value is defined as a \"don't care\" that may on either a 0 or 1 value in resulting solutions</li> <li>By placing \"don't cares\" (an \"x\" entry) in the function or map, the cost of the logic circuit may be lowered.</li> <li>Example: A logic function having the binary codes for the BCD digits as its inputs. Only the codes for 0 through 9 are used. The six codes, 1010 through 1111 will never occur, so the output values for these codes are \"don't cares\".</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#product-of-sums-example","title":"Product of Sums Example","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#systematic-simplification","title":"Systematic Simplification","text":"<ul> <li>Implicant is a minterm/product term in SOP or maxterm/sumterm in POS of a Boolean function. For example:</li> </ul> <p>\\(F=AB+ABC+BC\\). Implicants are AB, ABC and BC.</p> <ul> <li> <p>The group of \"1's\" is called implicant. There are two types of implicants: Prime Implicant and Essential Prime Implicant.</p> </li> <li> <p>A Prime Implicant is a product term obtained by combining the maximum possible number of adjacent squares in the map into a rectangle with the number of squares a power of 2.</p> </li> <li>An Essential Prime Implicant is a prime implicant that covers one or more minterms that no combination of other prime implicants are able to include.</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#practice1-find-all-prime-implicants-for","title":"Practice1: Find all prime implicants for:","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#fabcdsigma_m02389101112131415","title":"\\(F(A,B,C,D)=\\Sigma_m(0,2,3,8,9,10,11,12,13,14,15)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#practice2-find-all-prime-implicants-for","title":"Practice2: Find all prime implicants for:","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#gabcdsigma_m0234712131415","title":"\\(G(A,B,C,D)=\\Sigma_m(0,2,3,4,7,12,13,14,15)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#quine-mccluskey-algorithm","title":"Quine-McCluskey Algorithm","text":"<ul> <li>Find all prime implicants</li> <li>Include all essential prime implicants in the solution</li> <li>Select a minimum cost set of non-essential prime implicants to cover all minterms not yet covered:</li> <li>Obtaining a good simplified solution: Use the Selection Rule</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#prime-implicant-selection-rule","title":"Prime Implicant Selection Rule","text":"<ul> <li>Minimize the overlap among prime implicants as much as possible. </li> <li>In particular, in the final solution, make sure that each prime implicant selected includes at least one midterm not included in any other prime implicant selected.</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#simplify-boolean-expression-f-through-k-map-given-by","title":"Simplify Boolean Expression \\(F\\) through K-map Given by:","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture2/#fabcdsigma_m346911sigma_d2571013","title":"\\(F(A,B,C,D)=\\Sigma_m(3,4,6,9,11)+\\Sigma_d(2,5,7,10,13)\\)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/","title":"Number Systems and Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#lcdf","title":"LCDF","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#week-3-verilog","title":"Week 3: Verilog","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#part-1","title":"Part 1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog","title":"\u4e3a\u4ec0\u4e48\u8981\u4f7f\u7528Verilog?","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_1","title":"\u8bbe\u8ba1\u786c\u4ef6\u7684\u4e24\u79cd\u65b9\u6cd5","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_2","title":"\u65b9\u6cd5\u4e00\uff1a\u539f\u7406\u56fe\u8bbe\u8ba1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#cont","title":"\u8bbe\u8ba1\u786c\u4ef6\u7684\u4e24\u79cd\u65b9\u6cd5 (cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_3","title":"\u65b9\u6cd5\u4e8c\uff1a\u786c\u4ef6\u63cf\u8ff0\u8bed\u8a00\u8bbe\u8ba1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#part-2","title":"Part 2","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog_1","title":"Verilog\u8bed\u6cd5","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog_2","title":"Verilog\u57fa\u672c\u4e66\u5199\u683c\u5f0f","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog_3","title":"Verilog\u4e2d\u7684\u6570\u503c\u8868\u793a","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog_4","title":"Verilog\u4e2d\u7684\u6570\u636e\u7c7b\u578b","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#wire-wire-wire-wire-assign","title":"\u7ebf\u7f51(wire): wire \u7c7b\u578b\u8868\u793a\u786c\u4ef6\u5355\u5143\u4e4b\u95f4\u7684\u7269\u7406\u8fde\u7ebf\uff0c\u5b83\u4e0d\u5b58\u50a8\u4efb\u4f55\u503c\uff0c\u53ea\u662f\u8868\u793a\u4fe1\u53f7\u4e4b\u95f4\u7684\u8fde\u7ebf\u3002wire \u7684\u503c\u7531\u5176\u8fde\u63a5\u7684\u5143\u4ef6\uff08\u5982\u95e8\u6216\u6a21\u5757\u8f93\u51fa\uff09\u9a71\u52a8\u3002\u4e0d\u80fd\u5728\u8fc7\u7a0b\u5757\u4e2d\u4e3a wire \u8d4b\u503c\uff0c\u4f46\u53ef\u4ee5\u901a\u8fc7\u8fde\u7eed\u8d4b\u503c (assign \u8bed\u53e5) \u6216\u5176\u5b83\u6a21\u5757\u7684\u8f93\u51fa\u6765\u4e3a\u5176\u8d4b\u503c\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog-cont","title":"Verilog\u4e2d\u7684\u6570\u636e\u7c7b\u578b (cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#reg-reg-verilog-reg-always-initial","title":"\u5bc4\u5b58\u5668(reg): reg \u7c7b\u578b\u7528\u6765\u8868\u793a\u5b58\u50a8\u5355\u5143\uff0c\u5b83\u4f1a\u4fdd\u6301\u6570\u636e\u539f\u6709\u7684\u503c\uff0c\u76f4\u5230\u88ab\u6539\u5199\u3002\u5728 Verilog \u4e2d\uff0creg \u7c7b\u578b\u7684\u53d8\u91cf\u53ef\u4ee5\u5728\u8fc7\u7a0b\u5757\uff08\u5982 always \u6216 initial \u5757\uff09\u4e2d\u88ab\u8d4b\u503c\u3002\u5b83\u4f1a\u4fdd\u5b58\u5176\u503c\uff0c\u76f4\u5230\u4e0b\u4e00\u6b21\u88ab\u8d4b\u65b0\u503c\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#reg-vs-wire","title":"reg vs. wire","text":"<ul> <li>\u9ed8\u8ba4\u503c:</li> <li>reg\uff1a\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u6ca1\u6709\u660e\u786e\u521d\u59cb\u5316\u7684 reg \u7c7b\u578b\u7684\u53d8\u91cf\u662f\u201cX\u201d\uff08\u672a\u77e5\uff09\u72b6\u6001\u3002</li> <li>wire\uff1a\u9664\u975e\u6709\u5176\u4ed6\u9a71\u52a8\uff0c\u5426\u5219\u9ed8\u8ba4\u4e3a\u201cz\u201d\uff08\u9ad8\u963b\u6297\uff09\u72b6\u6001\u3002</li> <li>\u8d4b\u503c\u65b9\u5f0f:</li> <li>reg\uff1a\u53ef\u4ee5\u4f7f\u7528\u975e\u963b\u585e\u8d4b\u503c (&lt;=) \u6216\u963b\u585e\u8d4b\u503c (=) \u5728\u8fc7\u7a0b\u5757\u5185\u90e8\u8d4b\u503c\u3002</li> <li>wire\uff1a\u53ea\u80fd\u901a\u8fc7\u8fde\u7eed\u8d4b\u503c (assign) \u6216\u5176\u4ed6\u6a21\u5757\u7684\u8f93\u51fa\u8d4b\u503c\u3002</li> <li>\u6269\u5c55\u529f\u80fd:</li> <li>reg \u53ef\u4ee5\u662f\u6807\u91cf\u3001\u77e2\u91cf\u3001\u591a\u7ef4\u6570\u7ec4\u6216\u662f\u4e00\u4e2a\u590d\u6742\u7684\u6570\u636e\u7ed3\u6784\uff08\u4f8b\u5982\u961f\u5217\u3001\u52a8\u6001\u6570\u7ec4\u7b49\uff09\u3002</li> <li>wire \u53ef\u4ee5\u662f\u6807\u91cf\u6216\u77e2\u91cf\uff0c\u4f46\u4e0d\u80fd\u662f\u591a\u7ef4\u6570\u7ec4\u6216\u590d\u6742\u6570\u636e\u7ed3\u6784\u3002</li> </ul>"},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog-cont_1","title":"Verilog\u4e2d\u7684\u6570\u636e\u7c7b\u578b (cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#vector-1-wire-reg","title":"\u5411\u91cf(vector): \u5f53\u4f4d\u5bbd\u5927\u4e8e 1 \u65f6\uff0cwire \u6216 reg \u5373\u53ef\u58f0\u660e\u4e3a\u5411\u91cf\u7684\u5f62\u5f0f\u3002\u4f8b\u5982\uff1a","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog-cont_2","title":"Verilog\u4e2d\u7684\u6570\u636e\u7c7b\u578b (cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#integer-integer-32-bitreg-integer","title":"\u6574\u6570\uff08integer): \u6574\u6570\u7c7b\u578b\u7528\u5173\u952e\u5b57 integer \u6765\u58f0\u660e\u3002\u58f0\u660e\u65f6\u4e0d\u7528\u6307\u660e\u4f4d\u5bbd\uff0c\u4f4d\u5bbd\u548c\u7f16\u8bd1\u5668\u6709\u5173\uff0c\u4e00\u822c\u4e3a32 bit\u3002reg \u578b\u53d8\u91cf\u4e3a\u65e0\u7b26\u53f7\u6570\uff0c\u800c integer \u578b\u53d8\u91cf\u4e3a\u6709\u7b26\u53f7\u6570\u3002\u4f8b\u5982\uff1a","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog-cont_3","title":"Verilog\u4e2d\u7684\u6570\u636e\u7c7b\u578b (cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#parameter-parameter","title":"\u53c2\u6570(parameter): \u53c2\u6570\u7528\u6765\u8868\u793a\u5e38\u91cf\uff0c\u7528\u5173\u952e\u5b57 parameter \u58f0\u660e\uff0c\u53ea\u80fd\u8d4b\u503c\u4e00\u6b21\u3002\u4f8b\u5982\uff1a","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#verilog_5","title":"Verilog\u4e2d\u7684\u8868\u8fbe\u5f0f","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_4","title":"\u7b97\u672f\u8fd0\u7b97\u7b26","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_5","title":"\u5173\u7cfb\u8fd0\u7b97\u7b26","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_6","title":"\u6309\u4f4d\u8fd0\u7b97\u7b26","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture3/#_7","title":"\u79fb\u4f4d\u8fd0\u7b97\u7b26","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/","title":"Number Systems and Boolean Algebra","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#lcdf","title":"LCDF","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#week-4-verilog","title":"Week 4: Verilog","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#part-1","title":"Part 1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog","title":"Verilog\u8bed\u6cd5","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_1","title":"Verilog\u4e2d\u7684\u5e38\u7528\u8bed\u53e5","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#assign-verilog","title":"\u8fde\u7eed\u8d4b\u503c\u8bed\u53e5(assign): \u5728 Verilog \u4e2d\uff0c\u8fde\u7eed\u8d4b\u503c\u8bed\u53e5\u662f\u4e00\u79cd\u7528\u4e8e\u63cf\u8ff0\u786c\u4ef6\u7535\u8def\u4e2d\u4fe1\u53f7\u95f4\u8fde\u7eed\u4f20\u9012\u5173\u7cfb\u7684\u91cd\u8981\u8bed\u53e5\u3002\u8fd9\u79cd\u8d4b\u503c\u8bed\u53e5\u901a\u5e38\u7528\u4e8e\u7ec4\u5408\u903b\u8f91\u8bbe\u8ba1\uff0c\u5b83\u80fd\u591f\u5b9e\u73b0\u4fe1\u53f7\u7684\u5373\u65f6\u66f4\u65b0\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#_1","title":"\u65f6\u5ef6\uff1a\u8fde\u7eed\u8d4b\u503c\u5ef6\u65f6\u8bed\u53e5\u4e2d\u7684\u5ef6\u65f6\uff0c\u7528\u4e8e\u63a7\u5236\u4efb\u610f\u64cd\u4f5c\u6570\u53d1\u751f\u53d8\u5316\u5230\u8bed\u53e5\u5de6\u7aef\u8d4b\u4e88\u65b0\u503c\u4e4b\u95f4\u7684\u65f6\u95f4\u5ef6\u65f6\u3002\u901a\u5e38\u7528#\u52a0\u4e0a\u6b63\u6574\u6570\u6765\u8868\u793a","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont_1","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#initialinitial-0-initial-initial-begin-end","title":"Initial\u8bed\u53e5\uff1ainitial \u8bed\u53e5\u4ece 0 \u65f6\u523b\u5f00\u59cb\u6267\u884c\uff0c\u53ea\u6267\u884c\u4e00\u6b21\uff0c\u591a\u4e2a initial \u5757\u4e4b\u95f4\u662f\u76f8\u4e92\u72ec\u7acb\u5e76\u884c\u7684\u3002\u5982\u679c initial \u5757\u5185\u5305\u542b\u591a\u4e2a\u8bed\u53e5\uff0c\u9700\u8981\u4f7f\u7528\u5173\u952e\u5b57 begin \u548c end \u7ec4\u6210\u4e00\u4e2a\u5757\u8bed\u53e5\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont_2","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#always-initial-always-always-0","title":"Always\u8bed\u53e5\uff1a\u4e0e initial \u8bed\u53e5\u76f8\u53cd\uff0calways \u8bed\u53e5\u662f\u91cd\u590d\u6267\u884c\u7684\u3002always \u8bed\u53e5\u5757\u4ece 0 \u65f6\u523b\u5f00\u59cb\u6267\u884c\u5176\u4e2d\u7684\u884c\u4e3a\u8bed\u53e5\uff1b\u5f53\u6267\u884c\u5b8c\u6700\u540e\u4e00\u6761\u8bed\u53e5\u540e\uff0c\u4fbf\u518d\u6b21\u6267\u884c\u8bed\u53e5\u5757\u4e2d\u7684\u7b2c\u4e00\u6761\u8bed\u53e5\uff0c\u5982\u6b64\u5faa\u73af\u53cd\u590d\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#always","title":"\u5e26\u6761\u4ef6\u7684always\u8bed\u53e5\u5757","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#alwaysalways","title":"always\u540e\u8ddf@(\u89e6\u53d1\u6761\u4ef6)\uff0c\u5373\u53ef\u4f7f\u5f97always\u5728\u89e6\u53d1\u6761\u4ef6\u53d1\u751f\u53d8\u5316\u65f6\uff0c\u6267\u884c\u5757\u4e2d\u7684\u5185\u5bb9","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont_3","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#if-if-else","title":"\u6761\u4ef6\u8bed\u53e5\uff1a\u6761\u4ef6\uff08if\uff09\u8bed\u53e5\u7528\u4e8e\u63a7\u5236\u6267\u884c\u8bed\u53e5\u8981\u6839\u636e\u6761\u4ef6\u5224\u65ad\u6765\u786e\u5b9a\u662f\u5426\u6267\u884c\u3002\u6761\u4ef6\u8bed\u53e5\u7528\u5173\u952e\u5b57 if \u548c else \u6765\u58f0\u660e\uff0c\u6761\u4ef6\u8868\u8fbe\u5f0f\u5fc5\u987b\u5728\u5706\u62ec\u53f7\u4e2d\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont_4","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#casecase-if","title":"\u591a\u8def\u5206\u652f\u8bed\u53e5(case)\uff1acase \u8bed\u53e5\u662f\u4e00\u79cd\u591a\u8def\u6761\u4ef6\u5206\u652f\u7684\u5f62\u5f0f\uff0c\u53ef\u4ee5\u89e3\u51b3 if \u8bed\u53e5\u4e2d\u6709\u591a\u4e2a\u6761\u4ef6\u9009\u9879\u65f6\u4f7f\u7528\u4e0d\u65b9\u4fbf\u7684\u95ee\u9898\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilogcont_5","title":"Verilog\u4e2d\u7684\u5e38\u89c1\u8bed\u53e5(cont.)","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog-4-whileforrepeat-forever-always-initial","title":"\u5faa\u73af\u8bed\u53e5\uff1aVerilog \u5faa\u73af\u8bed\u53e5\u6709 4 \u79cd\u7c7b\u578b\uff0c\u5206\u522b\u662f while\uff0cfor\uff0crepeat\uff0c\u548c forever \u5faa\u73af\u3002\u5faa\u73af\u8bed\u53e5\u53ea\u80fd\u5728 always \u6216 initial \u5757\u4e2d\u4f7f\u7528\uff0c\u4f46\u53ef\u4ee5\u5305\u542b\u5ef6\u8fdf\u8868\u8fbe\u5f0f\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#part-2","title":"Part 2","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_2","title":"Verilog\u9876\u5c42\u8bbe\u8ba1","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_3","title":"Verilog\u6a21\u5757\u4e0e\u7aef\u53e3","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_4","title":"Verilog\u6a21\u5757\u4f8b\u5316\uff1a\u5728\u4e00\u4e2a\u6a21\u5757\u4e2d\u5f15\u7528\u53e6\u4e00\u4e2a\u6a21\u5757\uff0c\u5bf9\u5176\u7aef\u53e3\u8fdb\u884c\u76f8\u5173\u8fde\u63a5\uff0c\u53eb\u505a\u6a21\u5757\u4f8b\u5316\u3002\u6a21\u5757\u4f8b\u5316\u5efa\u7acb\u4e86\u63cf\u8ff0\u7684\u5c42\u6b21\u3002\u4fe1\u53f7\u7aef\u53e3\u53ef\u4ee5\u901a\u8fc7\u4f4d\u7f6e\u6216\u540d\u79f0\u5173\u8054\uff0c\u7aef\u53e3\u8fde\u63a5\u4e5f\u5fc5\u987b\u9075\u5faa\u4e00\u4e9b\u89c4\u5219\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_5","title":"Verilog\u6a21\u5757\u4e0e\u7aef\u53e3","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#input-output","title":"\u5982\u679c\u67d0\u4e9b\u8f93\u51fa\u7aef\u53e3\u5e76\u4e0d\u9700\u8981\u5728\u5916\u90e8\u8fde\u63a5\uff0c\u4f8b\u5316\u65f6\u53ef\u4ee5\u60ac\u7a7a\u4e0d\u8fde\u63a5\uff0c\u751a\u81f3\u5220\u9664\u3002\u4e00\u822c\u6765\u8bf4\uff0cinput \u7aef\u53e3\u5728\u4f8b\u5316\u65f6\u4e0d\u80fd\u5220\u9664\uff0c\u5426\u5219\u7f16\u8bd1\u62a5\u9519\uff0coutput \u7aef\u53e3\u5728\u4f8b\u5316\u65f6\u53ef\u4ee5\u5220\u9664\u3002","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#verilog_6","title":"Verilog\u6a21\u5757\u4e0e\u7aef\u53e3","text":""},{"location":"%E6%95%B0%E9%80%BB/Lecture4/#alu","title":"\u5177\u4f53\u4f8b\u5b50\uff1a\u8bbe\u8ba1\u4e00\u4e2a\u516b\u79cd\u64cd\u4f5c\u7684ALU","text":""}]}